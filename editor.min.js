function update_indicator(e,a){if(e<8){indicator[e]=a,keymaps[2][0][0]=indicator[0]|indicator[1]<<8,keymaps[3][0][0]=indicator[2]|indicator[3]<<8,keymaps[4][0][0]=indicator[4]|indicator[5]<<8,keymaps[5][0][0]=indicator[6]|indicator[7]<<8;var o=$("#indicator_dropdown_menu li[value="+indicator[e]+"]");o&&$("#indicator_dropdown-btn_"+e).text(o.text()).attr({"data-tooltip":o.attr("data-tooltip"),value:indicator[e]});var s=$("#indicator_dropdown-name_"+e).text()+" : "+$("#indicator_dropdown-btn_"+e).text();$("#keyboard-outline").find(".kbd-led.led"+e).attr("data-tooltip",s)}else{for(var t=new Array,n=0;n<4;n++){var d=keymaps[n+2][0][0];t[2*n]=255&d,t[2*n+1]=d>>8}for(n=0;n<8;n++)update_indicator(n,t[n])}7==e&&console.log(keymaps[2][0][0].toString(16),keymaps[3][0][0].toString(16),keymaps[4][0][0].toString(16),keymaps[5][0][0].toString(16))}function update_indicator_color(e,a){if(console.log("Set LED"+e+": #"+a),e<8){if("block"==$("#indicator-color-btn_"+e).css("display")){indicator_color[e]=a;var o=parseInt(a.substring(0,2),16),s=parseInt(a.substring(2,4),16),t=parseInt(a.substring(4,6),16);keymaps[e][0][1]=o|s<<8,keymaps[e][0][2]=t,$("#indicator-color-btn_"+e)[0].jscolor.fromString(a),$("#indicator-color-btn_"+e).attr("value",a),$("#mykbd").find(".kbd-led.led"+e).each(function(){$(this).css("background-color","#"+a);var e=M.Tooltip.getInstance(this);e&&$(e.tooltipEl).find(".aug")[0].style.setProperty("--aug-border-bg","#"+a)}),$("#keyboard-ledmap").find("#indicator_dropdown-btn_"+e).each(function(){var e=M.Tooltip.getInstance(this);e&&$(e.tooltipEl).find(".aug")[0].style.setProperty("--aug-border-bg","#"+a)})}}else for(var n=0;n<8;n++){var d=(255&keymaps[n][0][1])<<16|65280&keymaps[n][0][1]|255&keymaps[n][0][2];update_indicator_color(n,d=(d="000000"+d.toString(16)).substring(d.length-6))}}function update_keycap_color(e){$.cookie?void 0==e&&$.cookie("ck_keycap_color")?e=$.cookie("ck_keycap_color").match(/#(.{6})/g):e&&6==e.length&&$.cookie("ck_keycap_color",e,{expires:365,path:"/"}):void 0==e&&now_keycap_color&&(e=now_keycap_color),e&&6==e.length&&($("#mykeycap_css").remove(),$('<style id="mykeycap_css" type="text/css">.mykeycap1{color:'+e[0]+";background-color:"+e[1]+"}.mykeycap2{color:"+e[2]+";background-color:"+e[3]+"}.mykeycap3{color:"+e[4]+";background-color:"+e[5]+"}</style>").appendTo("head"),now_keycap_color=e,$("#keycap_color-user").find('[onchange^="update_keycap_color_single("]').each(function(){var a=$(this).attr("onchange").slice(27,28),o=e[a].slice(1,7);console.log(o),$(this)[0].jscolor.fromString(o),$(this).attr("value",o)}),$("#keycap_color-userset-on").find(".key-main").css({color:e[0],background:e[1]}),$("#keycap_color-userset-on").find(".key-mod").css({color:e[2],background:e[3]}),$("#keycap_color-userset-on").find(".key-enter").css({color:e[4],background:e[5]}))}function update_keycap_color_single(e,a){console.log("set color "+e+" to "+a),console.log(now_keycap_color),now_keycap_color[e]="#"+a,update_keycap_color(now_keycap_color),$("#user-keycap-colors").val(now_keycap_color)}function update_case_color(e){e&&6==e.length&&(e="#"+e),$.cookie?void 0==e?e=$.cookie("ck_case_color"):$.cookie("ck_case_color",e,{expires:365,path:"/"}):now_case_color&&(e=now_case_color),e&&($("#case_color_css").remove(),$('<style id="case_color_css" type="text/css">.mycase{background-color: {0}!important}</style>'.format(e)).appendTo("head"),now_case_color=e)}function update_plate_color_user(e){6==e.length&&(e="#"+e,$("#plate_color_css").remove(),$('<style id="plate_color_css" type="text/css">.plate{background-color: {0}!important}</style>'.format(e)).appendTo("head"),now_case_color=e)}function jsdef_init(){$(".jsdef").each(function(){var e=$(this).attr("class"),a=e.match(/(.*?)ml-(\d+)(.*?)/),o=e.match(/(.*?)pl-(\d+)(.*?)/),s=e.match(/(.*?)ht-(\d+)(.*?)/),t=e.match(/(.*?)wd-(\d+)(.*?)/),n=e.match(/(.*?)lh-(\d+)(.*?)/);a&&$(this).css({"margin-left":a[2]+"px"}),o&&$(this).css({"padding-left":o[2]+"px"}),s&&$(this).css({height:s[2]+"px"}),t&&$(this).css({width:t[2]+"px"}),n&&$(this).css({"line-height":n[2]+"px"})})}function onLangChange(e){language=e,window.lang.change(e);var a=".lang-en",o=".lang-zh_sc";"zh_sc"==e&&([a,o]=[o,a]),$(a).show(),$(o).hide(),"zh_sc"!=e&&$.getJSON("lang/en.json",function(e){$("#keyboard-outline").find(".kbd-led").each(function(){var a=$(this).attr("class").match(/.*led(\d)/);if(a&&a[1]>7){var o=e.token[$(this).attr("data-tooltip")];o&&$(this).attr("data-tooltip",o)}}),$("#fn-set").find("a").each(function(){if(this.id.match(/_dropdown-btn/)){var a=e.token[$(this).attr("data-tooltip")];a&&$(this).attr("data-tooltip",a)}})}),setTimeout(function(){tooltip_init(),update_logo_desc(),$("#key-set-tabs").tabs("updateTabIndicator")},500)}function LangChange(e){language!=e&&($("#layer_set").tabs("select","layer_0"),onLangChange(e))}function tooltip_init(){$(".tooltipped").tooltip({delay:50}),update_indicator_color(10)}function update_logo_desc(){var e=$("#firmware-dropdown-btn").attr("value"),a=$("#firmware-dropdown").find("[value="+e+"]").attr("data-tooltip");$("#logo_desc").text(a)}function display_label(e,a){var o=new Action(e),s=new Action(255&e),t={name:o.name,desc:o.desc};if(e>49151&&e<65536){var n=$("#code-0x"+e.toString(16));n.length>0?(t.name=n.html(),t.desc=n.attr("title")):62464==(62718&e)?((t=display_label(64511&e,a)).name+="<sub>F4</sub>",t.desc+=", 如果和<kt>左Alt</kt>一起时则执行<kt>Alt+F4</kt>"):console4jslang&&(t.name="u"+e.toString(16))}if(e>=18176&&e<18432){var d=(255&e).toString(16);d<10&&(d="0"+d),t.name="SC"+d,t.desc="Launch shortcut "+d}if(t.name.match(/.*?BS.*?/)&&$(".key.k"+a+":visible").each(function(){$(this).parents(".border")[0].offsetWidth>86.4&&(t.name=t.name.replace("BS","Backspace"))}),$("#keycap_style_gmk.nowdsa")[0]&&(s.name_dsa?t.name=" "+o.name_dsa:t.name=t.name.match(/\<i(.*?)\>/)?t.name:t.name.toUpperCase()),is_mac&&!$("#keycap_style_gmk.nowdsa")[0]){if(t.name.match(/.*?Ctrl.*?/)&&$(".key.k"+a+":visible").each(function(){$(this).parents(".border")[0].offsetWidth<=54&&(t.name=t.name.replace("Ctrl","short_ctl"))}),t.name.match("kb kb-"))return t;t=keylabel_mac(t),"alpha_key"==code_type(e)||"numpad_key"==code_type(e)?t.name=' <i class="bigfont"><div style="height:15px"></div><I>{0}</I></i>'.format(t.name.replace(/<br>.*/g,"")):"symbol_key"==code_type(e)||"function_key"==code_type(e)||e>=70&&e<=72?t.name=' <i class="midfont">{0}<I>{1}<I></i>'.format(e<57?"":'<div style="height:15px"></div>',t.name):t.name=" {0}<I>{1}<I></i>".format(t.name.match(/.*( |<br>).*/)?"":"<br>",t.name.toLowerCase())}else"alpha_key"!=code_type(e)&&"numpad_key"!=code_type(e)||(t.name=' <i class="bigfont">'+t.name+"</i>"),"symbol_key"!=code_type(e)&&"function_key"!=code_type(e)||(t.name=' <i class="midfont">'+t.name+"</i>");return"en"==language&&(t.desc=window.lang.translate(t.desc,"en")),$(".key.k"+a+":visible").each(function(){$(this).parent().parent().parent().hasClass("round")&&(t.name=t.name.replace(/<br>/g," "))}),t}function code_type(e){return e>3&&e<30?"alpha_key":e>83&&e<100&&88!=e||176==e?"numpad_key":e>=58&&e<=69||e>=104&&e<=115?"function_key":e>=30&&e<=39||e>=45&&e<=56?"symbol_key":void 0}function kbd_name_filter(e){var a=e.toLowerCase();$("#firmware-dropdown").find("li:not(.optgroup)").each(function(e){-1!=($(this).text()+$(this).attr("data-tooltip")).toLowerCase().indexOf(a)?$(this).show():$(this).hide()})}function user_keycap_colors(e){console.log(e)}function gernerate_kbd_list(e,a,o){return'<li value="{0}" class="tooltipped tip_kbdlist" data-position="right" deta-delay="80" data-tooltip="{1}" lang="zh_sc"> <a lang="zh_sc">{2}<i class="material-icons fav-kbd" lang="zh_sc" title="加入或取消收藏">favorite_border</i>'.format(e,a,o)}function fav_kbd_list_refresh(){$.cookie&&($("#fav-kbd-list").find(".tooltipped").each(function(){var e=M.Tooltip.getInstance(this);e&&e.destroy(),$(this).remove()}),$("#firmware-dropdown").find(".myfav").each(function(){var e=$(this).parent().parent().attr("value");$("#fav-kbd-list").append(gernerate_kbd_list(e,CONFIG.kbd[e].desc,CONFIG.kbd[e].name)),$("#fav-kbd-list").find("[value={0}]".format(e)).each(function(){$(this).find(".fav-kbd").addClass("myfav").text("favorite");if(!M.Tooltip.getInstance(this))M.Tooltip.init(this)})}))}function process_html_page(){$("#fn-set").find("a").each(function(){if(this.id.match(/_dropdown-btn/)){var e=this.id.replace("-btn","");$(this).addClass("col dropdown-trigger btn-flat select tooltipped uicolor").attr("data-target",e).attr("data-tooltip",$(this).text()),$(this).next("ul").addClass("dropdown-content")}}),$(".waves-effect").addClass("waves-light");for(var e in CONFIG.kbd)e.match(/optgroup.*/)?$("#firmware-dropdown").append('<li class="disabled optgroup uicolor-text"><span>{0}'.format(CONFIG.kbd[e].name)):e.match(/.*hidden/)||$("#firmware-dropdown").append(gernerate_kbd_list(e,CONFIG.kbd[e].desc,CONFIG.kbd[e].name));if($.cookie&&$.cookie("fav_list"))for(var a=$.cookie("fav_list").split(" "),o=0;o<a.length-1;o++)0!=a[o].length&&$("#firmware-dropdown").find("[value={0}]".format(a[o])).find(".fav-kbd").addClass("myfav").text("favorite");fav_kbd_list_refresh(),$("#setting-pane .keyboard-set").find("li").each(function(e){if(this.id&&-1!=this.id.indexOf("code-")){var a=[{attr:"L",class:"low"},{attr:"S",class:"s1"},{attr:"R",class:"rowstart"},{attr:"A",class:"t1a"},{attr:"T",class:"t1"},{attr:"W",class:"name_win"},{attr:"M",class:"name_mac"}];for(o in a)void 0!=$(this).attr(a[o].attr)&&$(this).addClass(a[o].class).removeAttr(a[o].attr);void 0==$(this).attr("class")&&-1==$(this).html().indexOf("<br>")&&$(this).addClass("t1"),$(this).addClass("key-set"),-1!=this.id.indexOf("-0x")&&$(this).attr("lang","zh_sc")}}),$("#setting-pane").find(".keys-category").attr("lang","zh_sc"),$("#indicator_dropdown_menu").find("li").attr("lang","zh_sc").addClass("tooltipped").attr("data-position","right").find("a").attr("lang","zh_sc"),$("#keyboard-ledmap").find(".dropdown-trigger").addClass("tooltipped").attr("data-position","right"),$("#keyboard-ledmap").find('[id^="indicator_dropdown-name_"]').addClass("tooltipped").attr("data-position","left");var s=new Lang;Lang.prototype.attrList.push("data-tooltip"),s.dynamic("en","lang/en.json"),s.init({defaultLang:"zh_sc"}),$(".key-set_shift_off, .key-set_shift_on").find("li").each(function(e){var a=$(this).html().match(/(.*)\<br\>(.*)/);a&&$(this).html('<span class="t2_s">'+a[1]+'</span><br><span class="t2_l">'+a[2]+"</span>")})}function first_visit(){if($.cookie&&!$.cookie("ck_select_kbd")){var e=document.querySelector("#firmware-dropdown-btn");M.Tooltip.getInstance(e).open()}}function keyCode2tmkCode(e){return{8:42,9:43,13:40,272:225,528:229,273:224,529:228,274:226,530:230,19:72,20:57,27:41,32:44,33:75,34:78,35:77,36:74,37:80,38:82,39:79,40:81,44:70,45:73,46:76,48:39,49:30,50:31,51:32,52:33,53:34,54:35,55:36,56:37,57:38,65:4,66:5,67:6,68:7,69:8,70:9,71:10,72:11,73:12,74:13,75:14,76:15,77:16,78:17,79:18,80:19,81:20,82:21,83:22,84:23,85:24,86:25,87:26,88:27,89:28,90:29,347:227,604:231,605:231,93:101,781:88,864:98,813:98,865:89,803:89,866:90,808:90,867:91,802:91,868:92,805:92,869:93,780:93,870:94,807:94,871:95,804:95,872:96,806:96,873:97,801:97,874:85,875:87,877:86,878:99,814:99,879:84,112:58,113:59,114:60,115:61,116:62,117:63,118:64,119:65,120:66,121:67,122:68,123:69,144:83,145:71,186:51,187:46,188:54,189:45,190:55,191:56,192:53,219:47,220:49,221:48,222:52,124:104,173:16610,174:16618,175:16617,183:16786,226:100}[e]}function keyName2tmkCode(e){return keyUnimap={KANA:"00",VOLDN:"40EA",VOLUP:"40E9",MUTE:"40E2",CALC:"4192",A:"04",B:"05",C:"06",D:"07",E:"08",F:"09",G:"0A",H:"0B",I:"0C",J:"0D",K:"0E",L:"0F",M:"10",N:"11",O:"12",P:"13",Q:"14",R:"15",S:"16",T:"17",U:"18",V:"19",W:"1A",X:"1B",Y:"1C",Z:"1D",1:"1E",2:"1F",3:"20",4:"21",5:"22",6:"23",7:"24",8:"25",9:"26",0:"27",ENTER:"28",ESC:"29",BS:"2A",BACKSPACE:"2A",TAB:"2B",SPACE:"2C","-":"2D","=":"2E","[":"2F","]":"30","\\":"31","ISO#":"32",";":"33","'":"34","`":"35",",":"36",".":"37","/":"38",CAPSLOCK:"39","CAPS LOCK":"39",F1:"3A",F2:"3B",F3:"3C",F4:"3D",F5:"3E",F6:"3F",F7:"40",F8:"41",F9:"42",F10:"43",F11:"44",F12:"45",PRTSCR:"46","PRINT SCREEN":"46",SCRLK:"47","SCROLL LOCK":"47",PAUSE:"48","PAUSE BREAK":"48",INS:"49",INSERT:"49",HOME:"4A",PGUP:"4B","PAGE UP":"4B",DEL:"4C",DELETE:"4C",END:"4D",PGDN:"4E","PAGE DOWN":"4E",RIGHT:"4F",LEFT:"50",DOWN:"51",UP:"52","NUM LOCK":"53",NUMLK:"53",NUMLOCK:"53","P/":"54","P*":"55","P-":"56","P+":"57",PENTER:"58",P1:"59",P2:"5A",P3:"5B",P4:"5C",P5:"5D",P6:"5E",P7:"5F",P8:"60",P9:"61",P0:"62","P.":"63","ISO\\":"64",MENU:"65","P,":"66","P=":"67",F13:"68",F14:"69",F15:"6A",F16:"6B",F17:"6C",F18:"6D",F19:"6E",F20:"6F",F21:"70",F22:"71",F23:"72",F24:"73",JYEN:"74",RO:"75",HENK:"76",MHEN:"77",CTRL:"78",SHIFT:"79",ALT:"7A",WIN:"7B",RCTRL:"7C",RSHIFT:"7D",RALT:"7E",RWIN:"7F",NO:"80"},keyUnimap[e]}function tmkCode2keyName(e){return keyName={0:"Kana",1:" ",2:" ",3:" ",4:"A",5:"B",6:"C",7:"D",8:"E",9:"F",10:"G",11:"H",12:"I",13:"J",14:"K",15:"L",16:"M",17:"N",18:"O",19:"P",20:"Q",21:"R",22:"S",23:"T",24:"U",25:"V",26:"W",27:"X",28:"Y",29:"Z",30:"1",31:"2",32:"3",33:"4",34:"5",35:"6",36:"7",37:"8",38:"9",39:"0",40:"Enter",41:"Esc",42:"Backspace",43:"Tab",44:"Space",45:"Minus",46:"Equal",47:"LeftBracket",48:"RightBracket",49:"BackSlash",50:"iso#",51:"Semicolon",52:"Quote",53:"Grave",54:"Comma",55:"Dot",56:"Slash",57:"Capslock",58:"F1",59:"F2",60:"F3",61:"F4",62:"F5",63:"F6",64:"F7",65:"F8",66:"F9",67:"F10",68:"F11",69:"F12",70:"PrtScr",71:"ScrLk",72:"Pause",73:"Insert",74:"Home",75:"PgUp",76:"Delete",77:"End",78:"PgDn",79:"Right",80:"Left",81:"Down",82:"Up",83:"Numlock",84:"PSlash",85:"PAster",86:"PMinus",87:"PPlus",88:"PEnter",89:"P1",90:"P2",91:"P3",92:"P4",93:"P5",94:"P6",95:"P7",96:"P8",97:"P9",98:"P0",99:"PDot",100:"iso\\",101:"Menu",102:"P,",103:"P=",104:"F13",105:"F14",106:"F15",107:"F16",108:"F17",109:"F18",110:"F19",111:"F20",112:"F21",113:"F22",114:"F23",115:"F24",116:"Jyen",117:"Ro",118:"Henk",119:"Mhen",120:"Ctrl",121:"Shift",122:"Alt",123:"Win",124:"RCtrl",125:"RShift",126:"RAlt",127:"RWin",128:"No",224:"Ctrl",225:"Shift",226:"Alt",227:"Win",228:"RCtrl",229:"RShift",230:"RAlt",231:"RWin",16618:"Voldn",16617:"VolUp",16610:"Mute",16786:"Calc"},keyName[e]}function shorten_date(e){var a=parseInt(e,10);return a<10?""+a:String.fromCharCode(a+55)}function keylabel_mac(e){return e.desc=e.desc.replace("Alt","Option").replace(/Windows|Win|Gui/g,"Command").replace("Backspace","Delete").replace("Keypad Enter","PENT").replace("Enter","Return").replace("PENT","Keypad Enter").replace("Num Lock","Clear").replace("Insert","help").replace("Print Screen","F13(Mac)").replace("Scroll Lock","F14(Mac)").replace("Pause Break","F15(Mac)"),e.name=e.name.replace(/backspace|bs/i,"delete").replace(/caps lock/i,"caps<br>lock").replace(/enter/i,"return").replace(/ctr/i,"control").replace(/short_ctl/i,"ctrl").replace(/alt/i,"option").replace(/win/i,"cmd⌘").replace(/print<br>scrn/i,"F13").replace(/scrll<br>lock/i,"F14").replace(/pause/i,"F15").replace(/ins/i,"help").replace(/p↩/i,"enter").replace(/p=/i,"=").replace(/num<br>lock/i,"clear"),e}function source_output(e){var a="";a+='#include "action.h"\n',a+='#include "action_code.h"\n',a+='#include "actionmap.h"\n',a+="\n",a+="const action_t actionmaps[][",a+=e[0].length,a+="][",a+=e[0][0].length,a+='] __attribute__ ((section (".keymap.keymaps"))) = {\n';for(var o in e){a+="    {\n";for(var s in e[o]){a+="        { ";for(var t in e[o][s])a+="0x"+("000"+e[o][s][t].toString(16)).substr(-4),a+=",";a+=" },\n"}a+="    },\n"}return a+="};\n"}function hex_line(e,a,o){var s=function(e){return("0"+e.toString(16)).substr(-2).toUpperCase()},t=0;t+=o.length,t+=e>>8,t+=255&e,t+=a;var n="";n+=":",n+=s(o.length),n+=s(e>>8),n+=s(255&e),n+=s(a);for(var d=0;d<o.length;d++)t+=o[d],n+=s(o[d]);return n+=s(1+~t&255)}function hex_eof(){return":00000001FF"}function hex_output(e,a){var o=[],s=[];return[].concat.apply([],[].concat.apply([],a)).forEach(function(a){s.push(a),16==s.length&&(o.push(hex_line(e,0,s)),e+=16,s.length=0)}),s.length>0&&(o+=hex_line(e,0,s)),o}function hex_keymaps(e){var a=[];return a=[].concat.apply([],[].concat.apply([],keymaps)),a=a.map(function(e){return[255&e,(65280&e)>>8]}),a=[].concat.apply([],a),hex_output(e,a)}function get_fw_date_from_hex(e){for(var a=convert_hex2bin([].concat(e),0,KEYMAP_START_ADDRESS),o=new Array(0,0,0),s=0;s<a.length;s++)if(85==a[s]&&0==a[++s]&&83==a[++s]&&0==a[++s]&&66==a[++s]&&0==a[++s]&&95==a[++s]&&0==a[++s]&&68==a[++s]){console.log("find USB_D"),o[0]=a[s+2]-55,month_day_to_num=function(e){return e<=57?e-48:e>=65?e-55:void 0},o[1]=month_day_to_num(a[s+4]),o[2]=month_day_to_num(a[s+6]);break}return o[0]>=19&&o[1]>0&&o[1]<=12&&o[2]>0&&o[2]<=31?o:0}function hex_split_firmware(e,a,o){for(var s=[],t=[],n=[],d=s,i=0,c=e.split("\n"),r=0;r<c.length;r++){var l=c[r].trim();if(":020000040800F2"!=l){if(":"!=l.substring(0,1))break;var _=parseInt(l.substring(1,3),16),m=parseInt(l.substring(3,7),16),u=l.substring(7,9);if("00"==u)if(m+i<a)s.push(l),d=s;else if(m+i>=a+o)t.push(l),d=t;else for(var p=0,f=0;f<_;f++)f%2==1?n.push(parseInt(l.substring(9+2*f,11+2*f),16)<<8|p):p=parseInt(l.substring(9+2*f,11+2*f),16);else"04"==u?(0==s.length?d=s:(i=65536*parseInt(l.substring(9,13),16))>=a+o&&(d=t),d.push(l)):"01"==u?t.push(l):d.push(l)}}for(var y=[],k=[];n.length>0;)k.push(n.splice(0,16)),8==k.length&&(y.push(k),k=[]);return{before:s,after:t,keymaps:y,date:get_fw_date_from_hex(s)}}function bin_split_firmware(e,a,o,s){var t=[],n=[],d=[];void 0!=s&&(a-=s),console.log(a);var i=new Uint8Array(e.length);i.fill(255);for(c=0;c<e.length;c++)i[c]=parseInt(e[c].charCodeAt(0),10);for(c=a;c<a+o;c++)d.push(i[c]|i[c+1]<<8),c++;for(var c=a+o;c<e.length;c++)n[c-a-o]=i[c];for(var r=[],l=[];d.length>0;)l.push(d.splice(0,16)),8==l.length&&(r.push(l),l=[]);return{before:t,after:n,keymaps:r}}function url_encode_keymap(e){return"undefined"!=typeof LZString&&"undefined"!=typeof Base64?Base64.encode(LZString.compress(JSON.stringify(e))):window.btoa(JSON.stringify(e))}function url_decode_keymap(e){if(null==e||"string"!=typeof e||e.length<30)return null;var a=unzip(e);if(null!=a)return console.log("zip"),JSON.parse(a);try{return"undefined"!=typeof LZString&&"undefined"!=typeof Base64?(console.log("lz"),JSON.parse(LZString.decompress(Base64.decode(e))).keymaps):JSON.parse(window.atob(e)).keymaps}catch(e){return null}}function unzip(e){var a=atob(e),o=a.split("").map(function(e){return e.charCodeAt(0)}),s=new Uint8Array(o),t=new pako.Inflate;if(t.push(s,!0),t.err)return null;var n=t.result;return a=String.fromCharCode.apply(null,new Uint16Array(n))}function zip(e){var a=pako.gzip(e,{to:"string"});return btoa(a)}function bin_to_uf2(e,a,o){for(var s=e.length+255>>8,t=[],n=0;n<e.length;n+=256){for(var d=new ArrayBuffer(512),i=new DataView(d),c=0;c<512;c++)i[c]=0;i.setUint32(0,171066965,!0),i.setUint32(4,2656915799,!0),i.setUint32(8,8192,!0),i.setUint32(12,a+n,!0),i.setUint32(16,256,!0),i.setUint32(20,t.length/512,!0),i.setUint32(24,s,!0),i.setUint32(28,o,!0);for(c=0;c<256;++c)i.setUint8(c+32,e[n+c]);i.setUint32(508,179400496,!0);for(c=0;c<512;c++)t.push(i.getUint8(c))}return new Uint8Array(t)}function uf2_to_bin(e){for(var a="",o=parseInt(e[13].charCodeAt(0),10)<<8|parseInt(e[12].charCodeAt(0),10),s=0;s<e.length;s+=512)for(var t=0;t<512;t++)t>=32&&t<288&&(a+=e[t+s]);return{binstr:a,bin_start_addr:o}}function Action(e){this.code=e,Object.defineProperty(this,"kind",{set:function(e){this.code|=(15&e)<<12},get:function(){return(61440&this.code)>>12}}),Object.defineProperty(this,"key_mods",{set:function(e){this.code|=(31&e)<<8},get:function(){return(7936&this.code)>>8}}),Object.defineProperty(this,"key_code",{set:function(e){this.code|=255&e},get:function(){return 255&this.code}}),Object.defineProperty(this,"usage_page",{set:function(e){this.code|=(3&e)<<10},get:function(){return(3072&this.code)>>10}}),Object.defineProperty(this,"usage_code",{set:function(e){this.code|=1023&e},get:function(){return 1023&this.code}}),Object.defineProperty(this,"layer_tap_val",{set:function(e){this.code|=(31&e)<<8},get:function(){return(7936&this.code)>>8}}),Object.defineProperty(this,"layer_tap_code",{set:function(e){this.code|=255&e},get:function(){return 255&this.code}}),Object.defineProperty(this,"layer_bitop_op",{set:function(e){this.code|=(3&e)<<10},get:function(){return(3072&this.code)>>10}}),Object.defineProperty(this,"layer_bitop_on",{set:function(e){this.code|=(3&e)<<8},get:function(){return(768&this.code)>>8}}),Object.defineProperty(this,"layer_bitop_part",{set:function(e){this.code|=(7&e)<<5},get:function(){return(224&this.code)>>5}}),Object.defineProperty(this,"layer_bitop_xbit",{set:function(e){this.code|=(1&e)<<4},get:function(){return(16&this.code)>>4}}),Object.defineProperty(this,"layer_bitop_bits",{set:function(e){this.code|=15&e},get:function(){return 15&this.code}}),Object.defineProperty(this,"mousekey_code",{set:function(e){this.code|=255&e},get:function(){return 255&this.code}}),Object.defineProperty(this,"am_code",{set:function(e){this.code|=15&e},get:function(){return 4095&this.code}}),Object.defineProperty(this,"af_code",{set:function(e){this.code|=15&e},get:function(){return 4095&this.code}});var a=function(e){var a="",o=[];return 1&e&&(a+="⌃",o.push("Control")),2&e&&(a+="⇧",o.push("Shift")),4&e&&(a+="⌥",o.push("Alt")),8&e&&(a+="⌘",o.push("Gui")),o=o.join(" + "),16&e&&(a="r"+a,o="Right "+o),{name:a,desc:o}};this.get_action=function(){switch((61440&this.code)>>12){case ACT_LMODS:case ACT_RMODS:if(0==this.key_mods){if(keycodes[this.key_code])return $.extend({},action_kinds.KEY,{name_dsa:keycodes[this.key_code].name_dsa,name:keycodes[this.key_code].name,desc:keycodes[this.key_code].desc})}else{if(keycodes[this.code])return $.extend({},action_kinds.KEY,{name_dsa:keycodes[this.code].name_dsa,name:keycodes[this.code].name,desc:keycodes[this.code].desc});if(keycodes[this.key_code]){i=a(this.key_mods);if(2==this.key_mods&&(this.key_code>=30&&this.key_code<=39||this.key_code>=45&&this.key_code<=56||100==this.key_code))var e='<i class="midfont">'+keycodes[this.key_code].name.substring(0,1)+"</i>",o='<i class="midfont">'+keycodes[this.key_code].name.substring(0,1)+"</i>",s="直接输出标点 <kt>{0}</kt>, 等效于 <kt>{1}</kt> + <kt>{2}</kt>".format(keycodes[this.key_code].name.substring(0,1),i.desc,keycodes[this.key_code].desc);else{e=i.name+"+<br>"+keycodes[this.key_code].name_dsa;keycodes[this.key_code].name_dsa&&(e=i.name+"+<br>"+keycodes[this.key_code].name_dsa.replace("<br>"," "));var o=i.name+"+<br>"+keycodes[this.key_code].name.replace("<br>"," "),s="<kt>{0}</kt> + <kt>{1}</kt>".format(i.desc,keycodes[this.key_code].desc)}return $.extend({},action_kinds.MODS_KEY,{name_dsa:e,name:o,desc:s})}}break;case ACT_LMODS_TAP:case ACT_RMODS_TAP:i=a(this.key_mods);switch(this.key_code){case MODS_ONESHOT:return $.extend({},action_kinds.MODS_ONESHOT,{name:i.name+" OneShot",desc:i.desc+" OneShot"});case MODS_TAP_TOGGLE:return $.extend({},action_kinds.MODS_TAP_TOGGLE,{name:i.name+" TapToggle",desc:i.desc+" TapToggle"})}if(void 0==keycodes[this.key_code])break;(c=keycodes[this.key_code].name_dsa)&&(c=c.replace("<br>"," "));r=keycodes[this.key_code].name.replace("<br>"," ");return $.extend({},action_kinds.MODS_TAP_KEY,{name_dsa:i.name+"|<br>"+c,name:i.name+"|<br>"+r,desc:"长按及与其他键组合时：<kt>{0}</kt> ；<br>快速单击时为 <kt>{1}</kt>".format(i.desc,keycodes[this.key_code].desc)});case ACT_LAYER:var t=1==this.layer_bitop_bits||2==this.layer_bitop_bits||4==this.layer_bitop_bits||8==this.layer_bitop_bits;switch(this.layer_bitop_op){case OP_BIT_AND:return action_kinds.LAYER_BIT_AND;case OP_BIT_OR:return action_kinds.LAYER_BIT_OR;case OP_BIT_XOR:if(this.layer_bitop_on==ON_RELEASE&&0==this.layer_bitop_xbit&&t){for(var n=4*this.layer_bitop_part,d=this.layer_bitop_bits;d>>1;d>>=1)n++;return $.extend({},action_kinds.LAYER_TOGGLE,{name:"T"+n,desc:"点击打开或关闭 层<kt>{0}</kt>".format(n)})}return action_kinds.LAYER_BIT_XOR;case OP_BIT_SET:if(this.layer_bitop_on==ON_SPECIAL_USE&&0==this.layer_bitop_xbit&&t){for(var n=4*this.layer_bitop_part,d=this.layer_bitop_bits;d>>1;d>>=1)n++;return $.extend({},action_kinds.DEFAULT_LAYER_SET,{name:"默认 层"+n,desc:"设置默认层 层"+n})}if(this.layer_bitop_on==ON_PRESS&&0==this.layer_bitop_xbit&&t){for(var n=4*this.layer_bitop_part,d=this.layer_bitop_bits;d>>1;d>>=1)n++;return $.extend({},action_kinds.UNKNOWN,{name:"T->"+n,desc:"跳转到 层<kt>{0}</kt>".format(n)})}return action_kinds.UNKNOWN}break;case ACT_LAYER_EXT:break;case ACT_LAYER_TAP:case ACT_LAYER_TAP_EXT:switch(this.layer_tap_code){case OP_TAP_TOGGLE:return $.extend({},action_kinds.LAYER_TAP_TOGGLE,{name:"LT"+this.layer_tap_val,desc:"Switch Layer "+this.layer_tap_val+" with Tap toggle"});case OP_ON_OFF:r="L"+this.layer_tap_val;return 1==this.layer_tap_val&&(r="Fn/"+r),$.extend({},action_kinds.LAYER_MOMENTARY,{name:r,desc:"瞬时开启（按下开启，松开关闭） 层<kt>{0}</kt>".format(this.layer_tap_val)});case OP_OFF_ON:return action_kinds.LAYER_OFF_ON;case OP_SET_CLEAR:return action_kinds.LAYER_SET_CLEAR;default:if(224==(240&this.layer_tap_code)){var i=a(15&this.layer_tap_code);return $.extend({},action_kinds.LAYER_MODS,{name:"LM"+this.layer_tap_val+" "+i.name,desc:"瞬时开启 层<kt>{0}</kt>, 同时按住 <kt>{1}</kt>".format(this.layer_tap_val,i.desc)})}if(void 0==keycodes[this.key_code])break;this.layer_tap_val<8?layer_tap_s=this.layer_tap_val:layer_tap_s=this.layer_tap_val-8+"(S)";var c=keycodes[this.key_code].name_dsa;c&&(c=c.replace("<br>"," "));var r=keycodes[this.key_code].name.replace("<br>"," ");return $.extend({},action_kinds.LAYER_TAP_KEY,{name_dsa:"LT"+layer_tap_s+"<br>"+c,name:"LT"+layer_tap_s+"<br>"+r,desc:"长按及与其他键组合时，瞬时开启 层<kt>{0}</kt> ；<br>快速单击时为 <kt>{1}</kt>".format(layer_tap_s,keycodes[this.layer_tap_code].desc)})}break;case ACT_USAGE:switch(this.usage_page){case PAGE_SYSTEM:if(system_codes[this.usage_code])return $.extend({},action_kinds.USAGE_SYSTEM,{name:system_codes[this.usage_code].name,desc:system_codes[this.usage_code].desc});case PAGE_CONSUMER:if(consumer_codes[this.usage_code])return $.extend({},action_kinds.USAGE_CONSUMER,{name:consumer_codes[this.usage_code].name,desc:consumer_codes[this.usage_code].desc})}break;case ACT_MOUSEKEY:if(mousekey_codes[this.mousekey_code])return $.extend({},action_kinds.MOUSEKEY,{name:mousekey_codes[this.mousekey_code].name,desc:mousekey_codes[this.mousekey_code].desc});break;case ACT_MACRO:if(am_codes[this.am_code])return $.extend({},action_kinds.MACRO,{name:am_codes[this.af_code].name,desc:am_codes[this.af_code].desc});break;case ACT_FUNCTION:if(af_codes[this.af_code])return $.extend({},action_kinds.FUNCTION,{name:af_codes[this.af_code].name,desc:af_codes[this.af_code].desc})}return action_kinds.UNKNOWN},Object.defineProperty(this,"id",{get:function(){return this.get_action().id}}),Object.defineProperty(this,"name",{get:function(){var e=this.get_action();return void 0!=e?e.name:""}}),Object.defineProperty(this,"name_dsa",{get:function(){var e=this.get_action();if(void 0!=e)return e.name_dsa}}),Object.defineProperty(this,"desc",{get:function(){var e=this.get_action();return void 0!=e?e.desc:""}})}function action_editor_get_code(){var e=$("#kind_dropdown-btn").attr("value"),a=parseInt($("#keycodes_dropdown-btn").attr("value")),o=parseInt($("#keycodes4tap_dropdown-btn").attr("value")),s=parseInt($("#key_mods_dropdown-btn").attr("value")),t=parseInt($("#layer_dropdown-btn").attr("value")),n=parseInt($("#layer_tap_dropdown-btn").attr("value")),d=parseInt($("#layer_mods_dropdown-btn").attr("value")),i=parseInt($("#layer_on_dropdown-btn").attr("value")),c=parseInt($("#launch_shortcut_dropdown-btn").attr("value"));switch(e){case"KEY":return kind_codes[e]|a;case"MODS_KEY":return kind_codes[e]|s<<8|a;case"MODS_TAP_KEY":return kind_codes[e]|s<<8|o;case"MODS_ONESHOT":case"MODS_TAP_TOGGLE":return kind_codes[e]|s<<8;case"USAGE_SYSTEM":return kind_codes[e]|system_code;case"USAGE_CONSUMER":return kind_codes[e]|consumer_code;case"MOUSEKEY":return kind_codes[e]|mousekey_code;case"LAYER_MOMENTARY":case"LAYER_ON_OFF":case"LAYER_OFF_ON":case"LAYER_SET_CLEAR":case"LAYER_TAP_TOGGLE":return kind_codes[e]|t<<8;case"LAYER_TAP_KEY":return kind_codes[e]|n<<8|o;case"LAYER_MODS":return kind_codes[e]|t<<8|d;case"LAYER_INVERT":case"LAYER_ON":case"LAYER_OFF":case"LAYER_SET":return kind_codes[e]|i<<8|t/4<<5|1<<t%4;case"LAYER_TOGGLE":return kind_codes[e]|t/4<<5|1<<t%4;case"LAYER_CLEAR":return 0|(kind_codes[e]|i<<8);case"DEFAULT_LAYER_SET":return 0|kind_codes[e]|t/4<<5|1<<t%4;case"LAUNCH_SHORTCUT":return c}return 0}function fetchHeader(e,a){try{var o=new XMLHttpRequest;return o.open("HEAD",e,!1),o.send(null),200==o.status&&o.getResponseHeader(a)}catch(e){return e.message}}function format_date(e){dateDigitToString=function(e){return e<10?"0"+e:e};var a=dateDigitToString(e.getFullYear()),o=dateDigitToString(e.getMonth()+1),s=dateDigitToString(e.getDate()),t=a+"-"+o+"-"+s+" "+dateDigitToString(e.getHours())+":"+dateDigitToString(e.getMinutes())+":"+dateDigitToString(e.getSeconds());return last_modified_date_short=shorten_date(a%100)+shorten_date(o)+shorten_date(s),console.log("Latest firmware: "+last_modified_date_short+" "+t),{short:last_modified_date_short,long:t}}function update_share_url_panel(){if($("#share-dialog").hasClass("url-long")){(e=parseInt($("#share-dialog")[0].style.getPropertyValue("--aug-r")))<80&&(e++,$("#share-dialog")[0].style.setProperty("--aug-r",e+"px"),setTimeout("update_share_url_panel()",10))}else{var e=parseInt($("#share-dialog")[0].style.getPropertyValue("--aug-r"));e>60&&(e=60),e>12&&(e--,$("#share-dialog")[0].style.setProperty("--aug-r",e+"px"),setTimeout("update_share_url_panel()",10))}}CONFIG={kbd:{optgroup0:{name:"YDKB ( High-end )"},yd1800mini:{name:"1800mini",desc:"1800mini 双模RGB热插拔键盘 by YANG",firmware_url:"./config/1800mini.hex",layout:"./config/layout-1800mini.html",size:{AutoCase:1,X:16,Y:5.25,M:-24,BR:16},checksum:{value:6145,addr:65280}},ben30_hidden:{name:"BEN30",desc:"BEN30 双模RGB热插拔键盘(玩具) by YANG & Xikii",firmware_url:"./config/chicory.hex",layout:"./config/layout-ben30.html"},ben40_hidden:{name:"BEN40",desc:"BEN40 双模RGB热插拔键盘 by YANG & Xikii",firmware_url:"./config/chicory.hex",layout:"./config/layout-ben40.html"},master98:{name:"Master98 Pro",desc:"Master98 Pro 双模RGB热插拔键盘 by YANG & Xikii",size:{AutoCase:1,X:19.5,Y:6.5,MU:-18,MR:-18,MD:-12,ML:-18},checksum:{value:6552,addr:65280}},sairo64:{name:"Sairo64",desc:"Sairo64(赛罗64) 60%双模RGB热插拔PCB by YANG",size:{AutoCase:1,X:15,Y:5,MU:-24}},taichi:{name:"TAICHI PAD",desc:"黑白双色PCB，8颗RGB底灯组成太极八卦图，16个按键，独立灯控的RGB轴灯实现千万种颜色",size:{AutoCase:1,X:4,Y:4,M:-24,BR:16}},x8086k:{name:"X-8086K",desc:"X-8086K(80%尺寸86键) 双模RGB热插拔键盘",firmware_url:"./config/X-8086K.hex",size:{AutoCase:1,X:18.25,Y:6.25,M:-24,BR:16}},optgroup1:{name:"YDKB (BLE系列键盘)"},ble40:{name:"BLE40",desc:"USB/BLE双模40% RGB无线键盘 by YANG",firmware_url:"./config/ble40_blup.hex",size:{AutoCase:1,X:12,Y:4}},blup:{name:"BLUP",desc:"USB/BLE双模40% RGB无线键盘 by YANG",firmware_url:"./config/ble40_blup.hex",size:{AutoCase:1,X:12,Y:4}},cad66:{name:"CAD66",desc:"CAD66 USB/BLE双模PCB，此固件不适合CA66原配单模PCB",size:{AutoCase:1,X:16.5,Y:5.25,MU:-24,MR:-16,MD:-16,ML:-16}},duang60:{name:"Duang60",desc:"专为无钢或半钢设计的60%蓝牙双模PCB by YANG",size:{AutoCase:1,X:15,Y:5,MU:-24},checksum:{value:8288,addr:26368}},chicory:{name:"Chicory",desc:"Chicory 40%双模键盘",size:{AutoCase:1,X:12,Y:4}},fmini:{name:"Fmini",desc:"一个类似Kmini布局的PCB by YANG",size:{AutoCase:1,X:18.5,Y:5,MU:-32,MR:-16,MD:-16,ML:-16,BR:6}},hello_v1:{name:"Hello_v1",desc:"Hello Keyborad v1，支持多个键盘，包括HHKB改装，MX轴，ALPS轴等",size:{AutoCase:1,X:15,Y:5,MU:-24,MR:-18,MD:-18,ML:-18}},just60:{name:"Just60",desc:"60%蓝牙双模机械键盘 by YANG",firmware_url:"./config/just60_yd60ble.hex",size:{AutoCase:1,X:15,Y:5,MU:-24}},just66:{name:"Just66",desc:"USB/BLE 双模多配列PCB，仅v1.x支持CA66外壳。珈蓝PCJR的双模默认是此PCB。",firmware_url:"./config/just68.hex",size:{AutoCase:1,X:16.5,Y:5.25,MU:-24,MR:-16,MD:-16,ML:-16}},just660:{name:"Just660",desc:"USB/BLE 双模多配列PCB for Leopold FC660M",firmware_url:"./config/just68.hex",size:{AutoCase:1,X:16.5,Y:5,M:-18,BR:6}},just68:{name:"Just68",desc:"USB/BLE 双模多配列键盘（兼容Tada68外壳和小门牙）",size:{AutoCase:1,X:16,Y:5}},minira:{name:"Minira",desc:"60%蓝牙双模机械键盘 配列同Filco Minila",size:{AutoCase:1,X:15,Y:5,MU:-24}},pearly:{name:"Pearly",desc:"40%蓝牙双模机械键盘PCB, 兼容Pearl",firmware_url:"./config/pearly.hex",size:{AutoCase:1,X:13,Y:4,M:-24},checksum:{value:8256,addr:26368}},yd43sw_hidden:{name:"YD43sw",desc:"YD43sw 还没有做的，计划中",firmware_url:"./config/yd40w.hex",layout:"./config/layout-yd43sw.html"},yd60ble:{name:"YD60BLE",desc:"60%蓝牙双模机械键盘 by YANG",firmware_url:"./config/just60_yd60ble.hex",size:{AutoCase:1,X:15,Y:5,MU:-24}},yd81_hidden:{name:"YD81",desc:"Get more than 80%. 支持有线蓝牙双模",firmware_url:"./config/yd81.hex",layout:"./config/layout-yd81.html"},ydp50:{name:"YDP50",desc:"USB/BLE双模50% 无线键盘 by YANG",size:{AutoCase:1,X:12,Y:5}},ydpm40ble:{name:"YDPM40BLE",desc:"YDPM40 双模版",size:{AutoCase:1,X:12,Y:4}},optgroup2:{name:"YDKB (其他键盘)"},akb48:{name:"AKB48",desc:"Atreus Keyboard 48 by YANG",size:{MaskHeight:320}},cod67:{name:"COD67",desc:"COD67 PCB by YANG",size:{MaskHeight:370}},ergoplus_hidden:{name:"ErgoPlus",desc:"An ErgoDox layout keyboard with full RGB and hotswap",firmware_url:"./config/ergodone.hex",layout:"./config/layout-ergoplus.html"},eswn:{name:"ESWN",desc:"ESWN四键RGB小键盘"},gamer87_hidden:{name:"Gamer87",desc:"功能等针对游戏玩家优化设计的87键键盘，Gamer系列的第一款产品",firmware_url:"./config/gamer87.hex",layout:"./config/layout-gamer87.html"},hskb:{name:"HSKB",desc:"HSKB原型机一，分体有线带屏幕键盘",size:{AutoCase:1,X:16,Y:5,MU:-78,MR:-18,MD:-18,ML:-18}},ns60:{name:"NS60",desc:"60%蓝牙双模机械键盘，同时支持上下灯位",size:{AutoCase:1,X:15,Y:5,MU:-24}},simpo40:{name:"Simpo40",desc:"40% Keyboard.",firmware_url:"./config/simpo_uf2.hex",size:{AutoCase:1,X:12,Y:4}},simpo66:{name:"Simpo66",desc:"单模有线版PCB，支持CA66旧版外壳。珈蓝PCJR的单模默认是此PCB",firmware_url:"./config/simpo_uf2.hex",size:{AutoCase:1,X:16.5,Y:5.25,MU:-24,MR:-16,MD:-16,ML:-16}},simpo68:{name:"Simpo68",desc:"65% Keyboard. Just68的单模有线版本",firmware_url:"./config/simpo_uf2.hex",size:{AutoCase:1,X:16,Y:5}},stm60:{name:"STM60",desc:"60% Keyboard that uses STM32F103",size:{AutoCase:1,X:15,Y:5,MU:-24}},stm60c:{name:"STM60.C",desc:"60% Keyboard that uses STM32F103",firmware_url:"./config/stm60.hex",size:{AutoCase:1,X:15,Y:5,MU:-24}},thx30:{name:"THX30",desc:"THX30 30% RGB小键盘，支持BLE模块，非卖品",size:{AutoCase:1,X:10,Y:3}},uukb:{name:"UUKB",desc:"USB/优联 双模键盘",firmware_url:"./config/uukb_uf2.hex"},yd68:{name:"YD68",desc:"YD68双空格键盘，v2为单空格但支持蓝牙双模",size:{AutoCase:1,X:16,Y:5}},ydkb_u2u:{name:"YDKB优联",desc:"YDKB的优联键盘集合",size:{MaskHeight:310}},ydp60:{name:"YDP60",desc:"YDP60",size:{AutoCase:1,X:15,Y:5,MU:-24}},ydpm40:{name:"YDPM40",desc:"YDP40 双空格类Planck and YDM40 by YANG",size:{AutoCase:1,X:12,Y:4}},yxpad:{name:"YXPAD",desc:"Y(有)X(线)Pad，全灯RGB",size:{AutoCase:1,X:4,Y:6}},optgroup3:{name:"YDKB Mod"},apple_adb:{name:"Apple_ADB",desc:"Apple ADB Keyboard to USB",size:{MaskHeight:416}},ble660c:{name:"BLE660C",desc:"USB/BLE Controller for Leopold FC660C",firmware_url:"./config/ble660c_980c.hex",size:{AutoCase:1,X:16.5,Y:5,M:-18,BR:6}},ble980c:{name:"BLE980C",desc:"USB/BLE Controller for Leopold FC980C",firmware_url:"./config/ble660c_980c.hex",size:{AutoCase:1,X:19.5,Y:6.75,BR:6}},ble980m:{name:"BLE980M",desc:"Leopold FC980M USB/蓝牙4.0双模改装",size:{MaskHeight:451}},filco104:{name:"FILCO104",desc:"FILCO104 YDKB Conroller",size:{MaskHeight:416}},hhkb_ble:{name:"HHKB BLE",desc:"USB/BLE Controller for HHKB Professional / Professional 2 / Professional JP",size:{AutoCase:1,X:15,Y:5,MU:-24},checksum:{value:6499,addr:26368}},hhkb_ble_s:{name:"HHKB BLE S",desc:"USB/BLE Controller for HHKB，这一个是提速了按键响应速度的固件，如有兼容问题请使用非S的",layout:"./config/layout-hhkb_ble_s.html",size:{AutoCase:1,X:15,Y:5,MU:-24},checksum:{value:6499,addr:26368}},yd_ap2u_hidden:{name:"YD-AP2U",desc:"AT和PS/2接口转USB转换器，以下是支持的一些布局",firmware_url:"./config/yd3000c.hex",layout:"./config/layout-yd_ap2u.html"},yd3000c:{name:"YD3000c",desc:"G80-3000系列的转换器，支持多种自定义功能，G80-3494支持USB下全键无冲",size:{MaskHeight:540}},optgroup4:{name:"K.T.E.C."},chili:{name:"Chili3000",desc:"K.T.E.C.成员 !#&*^$)~$#`^(%#$Gacathon 作品，G80-3000外壳可用PCB",firmware_url:"./config/lm_chili.hex",layout:"./config/layout-lm_chili.html",size:{AutoCase:1,X:23,Y:7,EY:-.5,MU:-70,MR:-40,MD:-54,ML:-40,BR:18}},cw40:{name:"CW40",desc:"K.T.E.C.出品，国外设计，国内制造",size:{AutoCase:1,X:12,Y:4}},daisy:{name:"Daisy",desc:"K.T.E.C.出品，国外设计，国内制造",size:{AutoCase:1,X:12,Y:4}},ergodone:{name:"Ergodone",desc:"K.T.E.C.出品，国外设计，国内制造",size:{MaskHeight:460}},grape:{name:"Grape11900",desc:"K.T.E.C.成员 !#&*^$)~$#`^(%#$Gacathon 作品，G80-11900/11800外壳可用PCB",firmware_url:"./config/lm_grape.hex",layout:"./config/layout-lm_grape.html",size:{AutoCase:1,X:20,Y:8,MU:-48,MR:-48,MD:-60,ML:-48,BR:18}},leechee:{name:"Leechee1800",desc:"K.T.E.C.成员 !#&*^$)~$#`^(%#$Gacathon 作品，G80-1800外壳可用PCB",firmware_url:"./config/lm_leechee.hex",layout:"./config/layout-lm_leechee.html",size:{AutoCase:1,X:19.5,Y:7,MU:-54,MR:-40,MD:-54,ML:-40,BR:18}},staryu:{name:"Staryu",desc:"K.T.E.C.出品，国外设计，国内制造",size:{AutoCase:1,X:3,Y:2}},optgroup5:{name:"Others(第三方)"},ca66:{name:"CA66",desc:"CA66有线版，适用于2020年之前的有线版CA66。2020及之后的，使用若遇软件或硬件问题，自行解决。",size:{MaskHeight:480}},diyer72:{name:"Diyer72",desc:"YDKB's firmware for Diyer72 / Xikii72 Keyboard",size:{MaskHeight:385.5}},exe:{name:"EXE",desc:"E神作品，国内客制化先驱"},gh60:{name:"GH60_ABC",desc:"该固件主要给添加了UART2BT蓝牙模块的使用， 完整支持XD60，其他ABC版本自测。",size:{AutoCase:1,X:15,Y:5,MU:-24}},u2u_pro:{name:"U2U PRO",desc:"USB2USB Converter with AT90USB1286",size:{MaskHeight:440}},udock:{name:"UDock",desc:"UDock by Yock and Bobnaive",size:{MaskHeight:514}}}},KEYCAP_COLORS=[{name:"Hana",color:["#a598c5","#efefea"],case_color:"#ebc3f0"},{name:"HHKB",color:["#222222","#eae6e7","#cbcdda"],order:[0,1,0,2,0,2]},{name:"RF 10th",color:["#222222","#989793","#6688aa"],order:[0,1,0,2,0,2],case_color:"#333333"},{name:"Raindrop",color:["#0073a2","#e5e4df"]},{name:"Carbon",color:["#575d5e","#e3d9c6","#ed6b21"],order:[0,1,2,0,0,2],case_color:"#424848"},{name:"Honeywell",color:["#212224","#efefea","#575757","#b01c11"],order:[0,1,1,2,1,3]},{name:"Hyperfuse",color:["#6c3b7b","#c4c4c0","#5dceba","#63696a"],order:[0,1,2,3,2,3]},{name:"Granite",color:["#525554","#e6e8e3","#222222","#a0a4a7"],order:[0,1,2,3,2,3]},{name:"Jukebox",color:["#a51b1b","#d9c9a8","#69d0a5"],order:[0,1,0,2,1,0]},{name:"Valentine",color:["#dc90bc","#efefea"],case_color:"#eaa0ca"},{name:"EVA 01",color:["#93c247","#592254"]},{name:"Pulse",color:["#00a6b4","#212224"]},{name:"Royal Navy",color:["#2f3d6f","#f0f0f0","#a92f0d"],order:[0,1,1,0,1,2]},{name:"Dolch",color:["#e4dedd","#5f5c52","#333430","#00a4a9"],order:[0,1,0,2,0,3]},{name:"Classic Olivetti",color:["#0965ed","#f5f5f5","#cfcdc2"],order:[0,1,0,2,1,0]},{name:"Lime",color:["#93c247","#e5e4df","#7c878e"],order:[0,1,1,2,1,0]},{name:"Eve",color:["#333333","#d4d0c7","#2785db"],order:[0,1,2,0,1,2]},{name:"Godspeed",color:["#666666","#d3cdc1","#6a94b1","#f9eb74"],order:[0,1,1,2,0,3]},{name:"Bentō",color:["#487992","#fff4f0","#f8767e"],order:[0,1,2,0,1,2]},{name:"Jamón",color:["#f2ebd7","#8c303a","#b2343c","#424446"],order:[0,1,0,2,3,0]},{name:"White on Black",color:["#efefea","#222222"],order:[0,1,0,1,0,1]},{name:"βeta",color:["#333333","#dcd6c4","#727473","#dd7632"],order:[0,1,0,2,0,3]},{name:"DMG",color:["#1d1770","#d1cdca","#7f8389","#722158"],order:[0,1,0,2,1,3]},{name:"Shiko",color:["#7a99ac","#dde5ed","#a1d1ee"],order:[0,1,1,0,1,2]},{name:"Olivia++",color:["#222222","#deded6","#373634","#e0b19f"],order:[0,1,3,2,0,3]},{name:"Oblivion",color:["#dedeca","#6b7273","#474946","#297fa9"],order:[0,1,0,2,0,3]},{name:"Oblivion W",color:["#dedeca","#e7e8e5","#474946","#297fa9"],order:[2,1,0,2,0,3]},{name:"Symbiosis",color:["#e5e4df","#747b7b","#0073a2","#ffac00"],order:[0,1,0,2,2,3],case_color:"c4d0d0"},{name:"Posh Blue",color:["#222d5a","#e1dbd1","#d8a0a6"],order:[0,1,2,0,0,2]},{name:"Posh Pink",color:["#222d5a","#e1dbd1","#d8a0a6"],order:[0,1,0,2,2,0]}],UI_THEME=[{name:"默认主题",color:"#0288d1"},{name:"红色主题",color:"#e57373"},{name:"粉色主题",color:"#f06292"},{name:"紫色主题",color:"#7e57c2"},{name:"青色主题",color:"#00acc1"},{name:"绿色主题",color:"#4caf50"},{name:"暗黑模式",color:"#242424"}],$(function(){function e(e){if(CONFIG.kbd[e]){$("#firmware-dropdown-btn").html('<i class="material-icons fl">keyboard</i>'+CONFIG.kbd[e].name).attr({value:e}),$("#logo_name, #kbdinfo_tab_name").text(CONFIG.kbd[e].name),update_logo_desc(),CONFIG.kbd[e].layout||(CONFIG.kbd[e].layout="./config/layout-{0}.html".format(e)),CONFIG.kbd[e].firmware_url||(CONFIG.kbd[e].firmware_url="./config/{0}.hex".format(e)),$("#keyboard-outline").css("display",""),$("#keyboard-ledmap").css("display","none"),$("#firmware-dropdown").find("li").removeClass("uicolor"),$("#firmware-dropdown").find("[value="+e+"]").addClass("uicolor"),$("#layouts-set-div, #layouts-set-on2").hide(),$("#layouts-set-on").addClass("scale-out");var a=CONFIG.kbd[e].size;if(a){var o=a.M?a.M:a.MU?a.MU:-12,s=a.M?a.M:a.MD?a.MD:-12,t=54*a.Y-o-s+24;a.EY&&(t+=54*a.EY),a.MaskHeight&&(t=a.MaskHeight),$("#keyboard-outline").html('<div class="keyboard-mask page-wd" style="height: {0}px;"></div><div style="height:{1}px;"</div>'.format(t,t-30));var n=54*a.Y/128,d=t/2-30,i=640;a.MaskHeight&&(i=640-1/(n=(a.MaskHeight-60)/128)*64),$("#loading").css({top:d+"px",left:i+"px",transform:"scale("+n+")"}),$("#loading").show()}if(CONFIG.kbd[e].layout&&j(CONFIG.kbd[e].layout),CONFIG.kbd[e].firmware_url){var c=fetchHeader(CONFIG.kbd[e].firmware_url,"Last-Modified"),r=format_date(new Date(c));$("#latest_firmware_date").hide(),$("#latest_firmware_date_short").hide(),$("#latest_firmware_date").text(r.long),$("#latest_firmware_date_short").text(r.short)}"stm60"==f||"stm60c"==f?$.ajax({method:"GET",url:"./config/stm60_uf2.hex"}).done(function(e){var a=hex_split_firmware(e,63488,KEYMAP_SIZE);g=a.before}):"uukb"==f?$.ajax({method:"GET",url:"./config/uukb_uf2.hex"}).done(function(e){var a=hex_split_firmware(e,63488,KEYMAP_SIZE);g=a.before}):-1!=f.indexOf("simpo")&&(console.log("SimpoKBD"),$.ajax({method:"GET",url:"./config/simpo_uf2.hex"}).done(function(e){var a=hex_split_firmware(e,63488,KEYMAP_SIZE);g=a.before}))}}function a(){$("#keyboard-outline").css("display","none"),$("#keyboard-ledmap").css("display","block"),$("#keyboard-outline").find(".key").empty()}function o(e,a){o=M.Tooltip.getInstance(e);if((e.parentElement.parentElement.parentElement.classList.contains("round")||100==a||a>255)&&u){if(void 0==o)var o=M.Tooltip.init(e)}else o&&o.destroy()}function s(e){var a;if(keycodes[e]&&!(e>255))return e<101?(a=keycodes[e].desc,e<2&&(a=keycodes[e].id)):a=keycodes[e].name,is_mac&&keycodes[e].name_mac&&(a=keycodes[e].name_mac),a}function t(e){var a=$("#keyboard-outline")[0].offsetHeight;$("#kbd-layout").empty(),$("#kbd-layout").append(e),$("#kbd-layout").find("[class^=mykeycap]").each(function(){var e=keyName2tmkCode($(this).text().toUpperCase()).toLowerCase();$(this).empty(),$(this).append('<div class="plate"></div><div class="border"><div class="top"><div class="key k{0}">'.format(e))}),L(keymaps[y]);var o=$("#keyboard-outline")[0].offsetHeight,s=$("#keyboard-outline").find(".keyboard-mask");s.css("height",parseInt(s.css("height"))+o-a+"px")}function n(e,a,o){return'<li value="'+e+'" title="'+a+'" lang="zh_sc"> <a lang="zh_sc">'+o}function d(e){$.cookie&&(void 0==e?e=$.cookie("uicolor"):$.cookie("uicolor",e,{expires:365,path:"/"})),e&&($("#uicolor_css").remove(),$('<style id="uicolor_css" type="text/css"> ::-webkit-scrollbar-thumb {background-color:{0}} .uicolor{background-color:{1}!important; border-color:{2}!important} .uicolor-text{color:{3}!important}</style>'.format(e,e,e,e)).appendTo("head"),"rgb(36, 36, 36)"==e.toString()?(console.log("dark mode"),$("html").addClass("dark-mode")):$("html").removeClass("dark-mode"))}function i(e){$.cookie?void 0==e?e=$.cookie("ck_case_style"):$.cookie("ck_case_style",e,{expires:365,path:"/"}):void 0==e&&m&&(e=m),e&&($("#case_style_css").remove(),$('<style id="case_style_css" type="text/css">.mycase{background-image:{0} }</style>'.format(e)).appendTo("head"),m=e)}function c(e){if($.cookie?void 0==e?(e=$.cookie("ck_keycap_style"),b=e):$.cookie("ck_keycap_style",e,{expires:365,path:"/"}):void 0==e&&m&&(e=b),e&&void 0!=e){$("#keycap_style_gmk").remove(),$("#keycap_style_flat").remove();var a='<link id="keycap_style_flat" href="flat.css" rel="stylesheet">',o='<link id="keycap_style_gmk" href="gmk.css" rel="stylesheet">';"gmk"==e?($(a).appendTo("head"),$(o).appendTo("head")):"flat"==e?($(o).appendTo("head"),$(a).appendTo("head")):"dsa"==e&&($('<link id="keycap_style_gmk" class="nowdsa" href="gmk.css" rel="stylesheet">').prependTo("head"),$(a).prependTo("head")),L(keymaps[y])}}function r(e){$("#keyboard-outline").find(".key:visible").removeClass("fade-in-down fade-in-up").addClass("fade-in-"+(e?"down":"up")),setTimeout(function(){$("#keyboard-outline").find(".key").removeClass("fade-in-down fade-in-up")},400),L(keymaps[y]);var a=e?"none":"block",o=e?"block":"none";$("#tabs-main").find(".name_win").each(function(){$(this).css("display",a)}),$("#tabs-main").find(".name_mac").each(function(){$(this).css("display",o)}),$("#mykeycap_system_change button").removeClass("using"),e?$("#system_mac").addClass("using"):$("#system_win").addClass("using");for(var t in keycodes)keycodes[t].desc_mac&&$("#keycodes_dropdown, #keycodes4tap_dropdown").find("[value="+t+"]").attr("title",e?keycodes[t].desc_mac:keycodes[t].desc).find("a").text(s(t));$("#key_mods_dropdown, #layer_mods_dropdown").empty();for(var t in mods_codes){function d(a){return e?a.replace("Alt","Option").replace("Win","Cmd"):a}$("[id$=_mods_dropdown]").append(n(t,d(mods_codes[t].desc),d(mods_codes[t].name)))}$(".key-set").each(function(e){var a=display_label(parseInt($(this).attr("id").match(/code-((0x){0,1}[0-9a-fA-F]+)/)[1]),0);$(this).attr({title:a.desc}),$(this).attr("key")&&$(this).html(a.name)})}var l,_,m,u=!0,p=0,f="yd1800mini",y=0,k=!1,h=255,b="gmk";now_keycap_color=[],iscasejscolor=0,is_mac=0,layouts_save="",is_dev=0,is_xikiicom=0;var g,v=0,A="",C=transparent_map();indicator=new Array(0,0,0,0,0,0,0,0),indicator_color=new Array(0,0,0,0,0,0,0);var E=document.location.search.substring(1),w=E.match(/(.*)-(\d+)/);if(w?(variant=w[1],layouts_save=w[2]):variant=E,lang=new Lang,Lang.prototype.attrList.push("data-tooltip"),lang.dynamic("en","lang/en.json"),lang.init({defaultLang:"zh_sc"}),console4jslang=!0,2020!=window.location.port&&8080!=window.location.port&&"console"!=document.location.hash.substring(1)?(console.log=(()=>{}),console4jslang=!1):$("#c-output").show(),-1!=window.location.href.indexOf("dev")){is_dev=1;var S=$(".brand-logo").html();$(".brand-logo").html(S.replace("Builder","Builder (DEV)")),$("nav").removeClass("uicolor").addClass("red")}console.log(layouts_save);var T=0,O=url_decode_keymap(document.location.hash.substring(1).replace(/YDKB/g,"+"));switch(null!=O&&(keymaps=O,T=1),language=navigator.userLanguage||navigator.language||navigator.bowserLanguage,language.toLowerCase()){case"zh-cn":language="zh_sc";break;case"en-us":default:language="en"}-1!=navigator.platform.indexOf("Mac")&&(is_mac=1),window.onfocus=function(){},window.onblur=function(){$("#tabs-main").find(".keydown").removeClass("keydown"),v=0},$("#kbd-name-filter").bind("input propertychange",function(){kbd_name_filter($(this).val())}),$("#user-keycap-colors").bind("input propertychange",function(){user_keycap_colors($(this).val())}),$("#key-set-tabs").on("click","li a",function(){var e=$(this).attr("href");"#tabs-kbdinfo"==e?($("#keyboard-outline").find(".keyboard-mask").removeClass("hidef"),$("#keyboard-outline").find(".key-editing").removeClass("key-editing"),$("#keyboard-outline").find(".bl-key").css("z-index","12").find(".plate").css("background","red")):($("#keyboard-outline").find(".keyboard-mask").addClass("fade-out"),setTimeout(function(){$("#keyboard-outline").find(".keyboard-mask").removeClass("fade-out").addClass("hidef")},50),$("#keyboard-outline").find(".bl-key").css("z-index","").find(".plate").css("background","")),e.match(/#tabs-readme|#tabs-kbdinfo|#tabs-keycap/g)?($("#fn-set").hide(),$("#keycode_tabs").css("height","397px")):($("#fn-set").show(),$("#keycode_tabs").css("height","336px"))}),$("#firmware-dropdown").on("click","li",function(){var a=$(":hover");if(0==a[a.length-1].outerHTML.indexOf("<a ")){var o=$(this).attr("value");CONFIG.kbd[o]&&f!=o&&(f=o,layouts_save="",e(f),$.cookie&&$.cookie("ck_select_kbd",f,{expires:365,path:"/"}))}else if(-1!=a[a.length-1].outerHTML.indexOf("fav-kbd")&&$.cookie){var s=$.cookie("fav_list"),t=$(this).attr("value"),n=t+" ";if(void 0!=s&&" "!=s||(s=""),$(this).find(".fav-kbd").hasClass("myfav")){$("#firmware-dropdown").find("[value="+t+"]").find(".fav-kbd").each(function(){0==$(this).closest("#fav-kbd-list").length&&$(this).removeClass("myfav").text("favorite_border")});var d=new RegExp(n,"g");s=s.replace(d,"").replace(/undefined/g,"").replace(/  /g,"")}else $(this).find(".fav-kbd").addClass("myfav").text("favorite"),s+=n;fav_kbd_list_refresh(),$.cookie("fav_list",s,{expires:365,path:"/"})}}),$("#layouts-set-border, #keycap_color-userset-border").drags(),$("#layouts-set-on, #layouts-set-off, #layouts-set-on2").click(function(){$("#layouts-set-border").fadeToggle(300)}),$("#keycap_color-userset-on, #keycap_color-userset-off").click(function(){$("#keycap_color-userset-border").fadeToggle(300)}),$("input.jscolor, textarea.not_drag").on("mousemove",function(e){$(this).addClass("no_drag")}),$("input.jscolor, textarea.not_drag").on("mouseout",function(e){$(this).removeClass("no_drag")}),$(document).ready(function(){process_html_page(),$(".sidenav").sidenav(),$(".collapsible").collapsible(),$(".modal").modal(),$(".dropdown-trigger").dropdown({coverTrigger:!1}),$("#keymap-load-dropdown-btn, #download-share-dropdown-btn").dropdown({constrainWidth:!1,coverTrigger:!1}),$("#fn-set .dropdown-trigger").dropdown({closeOnClick:!1}),$(".fixed-action-btn.toolbar").floatingActionButton({toolbarEnabled:!0}),$(".fixed-action-btn.tips").floatingActionButton({hoverEnabled:!1,direction:"right"}),$(".fixed-action-btn.tips").find(".scale-transition").removeClass("scale-out");for(t=0;t<KEYCAP_COLORS.length;t++){KEYCAP_COLORS[t].order||(KEYCAP_COLORS[t].order=[0,1,1,0,1,0]);for(var e=new Array(0,0,0,0,0),a=0;a<6;a++)e[a]=KEYCAP_COLORS[t].color[KEYCAP_COLORS[t].order[a]];var o="";KEYCAP_COLORS[t].case_color&&(o='case-color="{0}"'.format(KEYCAP_COLORS[t].case_color));var s='<div class="keycap-color-block" {7}><li class="key-color key-main"  style="color:{0}; background:{1}">key</li><li class="key-color key-enter" style="color:{4}; background:{5}">enter</li><li class="key-color key-mod" style="color:{2}; background:{3}">{6}</li></div>';$("#keycap-color-list").append(s.format(e[0],e[1],e[2],e[3],e[4],e[5],KEYCAP_COLORS[t].name,o))}for(var t=0;t<UI_THEME.length;t++)$("#ui-theme").append('<li style="color:#fefefe; background-color:{0};"><a lang="zh_sc">{1}'.format(UI_THEME[t].color,UI_THEME[t].name));$.ajax({url:"./common/case_list.txt",success:function(e){for(var a=e.split("\r\n"),o=0;o<a.length-1;o++)$("#mycase-style ul").append('<li style="background-image: url(./common/case/{0}"><a>'.format(a[o]))}}),jsdef_init(),r(is_mac),U(0),d(),update_keycap_color(),c(),update_case_color(),i(),$("#setting-pane").show(),$(".tabs").tabs()}),$(".fixed-action-btn.tips").on("mousedown","ul li",function(e){u=!!$(this).children().hasClass("green"),$("#layer_set").tabs("select","layer_0")}),$("#keycap-color-list").on("click",".keycap-color-block",function(){now_keycap_color[0]=$(this).find(".key-main").css("color"),now_keycap_color[1]=$(this).find(".key-main").css("background"),now_keycap_color[2]=$(this).find(".key-mod").css("color"),now_keycap_color[3]=$(this).find(".key-mod").css("background"),now_keycap_color[4]=$(this).find(".key-enter").css("color"),now_keycap_color[5]=$(this).find(".key-enter").css("background");for(var e=0;e<6;e++){var a=now_keycap_color[e].match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(a){function o(e){return("0"+parseInt(e).toString(16)).slice(-2)}now_keycap_color[e]="#"+o(a[1])+o(a[2])+o(a[3])}}update_keycap_color(now_keycap_color),iscasejscolor||(_=$(this).attr("case-color")?$(this).attr("case-color"):now_keycap_color[1],$.cookie&&$.cookie("ck_case_color",_,{expires:365,path:"/"}),update_case_color(_))}),$("#casejscolor-toggle").click(function(){var e=$(this).prop("checked");iscasejscolor=e?1:0,$("#casejscolor-btn")[0].type=e?"show":"hidden"}),$("#ui-theme").on("click","li",function(){d($(this).css("background-color"))}),led_setting=20,$("[id^='indicator_dropdown-btn_']").click(function(){led_setting=this.id.replace("indicator_dropdown-btn_","");for(var e=[{class_name:"can_disable",led_action_id:255},{class_name:"conn_mode",led_action_id:22},{class_name:"io_bt",led_action_id:20},{class_name:"io_ws2812",led_action_id:30}],a=0;a<e.length;a++){var o=$("#kb_ledmap-"+led_setting).hasClass(e[a].class_name)?"block":"none";$("#indicator_dropdown_menu").find("[value="+e[a].led_action_id+"]").css({display:o})}}),$("[id^='indicator_dropdown_']").on("click","li",function(){update_indicator(led_setting,this.value)}),$("[id^='layouts-']").on("click","[class^='layouts-']",function(){var e=this.id.match(/layouts-(\d)(\d)/);if($("#kblayouts-00").length>0){for(o=0;o<$("div[id^='kblayouts-"+e[1]+"']").length;o++)$("#keyboard-outline").find(".akblayouts-"+e[1]+o).each(function(){$(this).hide()}),$("#kblayouts-"+e[1]+o).hide();$("#keyboard-outline").find(".akblayouts-"+e[1]+e[2]).each(function(){$(this).show()}),$("#kblayouts-"+e[1]+e[2]).show()}var a=layouts_save.match(/(\d)/g);layouts_save="",$("div[id^='kblayouts-']").each(function(){if("block"==$(this).css("display")){var e=this.id.match(/kblayouts-(\d)(\d)/),o=e[1],s=e[2];a[o]=s}});for(var o=0;o<a.length;o++)layouts_save+=a[o];keymaps[1][0][0]="1"+layouts_save>>16,keymaps[0][0][0]="1"+layouts_save&65535,$("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),L(keymaps[y])}),$("#mykeycap_change li a").click(function(){c(b=$(this).attr("value"))}),$("#lock_shift").click(function(){$(this).hasClass("fa-unlock")?($(this).removeClass("fa-unlock").addClass("fa-lock"),$("#code-225").addClass("shift_locked"),$(".key-set_shift_on").css("display","block"),$(".key-set_shift_off").css("display","none")):($(this).removeClass("fa-lock").addClass("fa-unlock"),$("#code-225").removeClass("shift_locked"),$(".key-set_shift_on").css("display","none"),$(".key-set_shift_off").css("display","block"))}),$("#mykeycap_system_change").click(function(){"gmk"!=b&&c(b="gmk"),is_mac^=1,r(is_mac)}),$("#case-style-set").click(function(){$(".sidenav").sideNav("show")}),$("#mycase-style ul").on("click","li",function(){i($(this).css("background-image"))}),$(".layer").click(function(e,a){$("#keyboard-outline").css("display",""),$("#keyboard-ledmap").css("display","none");var o=parseInt($(this).attr("id").match(/layer-(\d+)/)[1]),s=o<y?"up":"down";y=o,$("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),$("#keyboard-outline").find(".key").each(function(){$(this).removeClass("fade-in-down fade-in-up").addClass("fade-out-"+s).removeAttr("length stabilizer")}),setTimeout(function(){$("#keyboard-outline").find(".key").each(function(){$(this).removeClass("fade-out-down fade-out-up").addClass("fade-in-"+s)}),setTimeout(function(){$("#keyboard-outline").find(".key").removeClass("fade-in-down fade-in-up")},400),L(keymaps[o])},350),$("#keymap-layer-clear").hasClass("recovery")&&$("#keymap-layer-clear").removeClass("recovery").text("清空当前层设置")}),$("#ledmap-tab").click(function(e,o){a()}),$("#keyboard-outline").on("click",".kbd-led",function(e){var o=$(this).attr("class").match(/.*led(\d).*/);o&&o[1]<8&&(a(),$("#layer_set").tabs("select","ledmap_tab"))});var L=function(e){$("#this_layout_keys").text("0"),$("#layout-info-pane").hasClass("showf")&&$("#layout-info-pane").removeClass("showf").addClass("hidef");for(var a in e)for(var s in e[a]){var t=e[a][s],n=parseInt(a).toString(32)+parseInt(s).toString(32),d=display_label(t,n);$(".key.k"+n).each(function(){var e=$(this).closest(".round");if(1==e.length){var a;e.hasClass("cw")?a="zh_sc"==language?"顺时针旋: ":"Clockwise: ":e.hasClass("ccw")?a="zh_sc"==language?"逆时针旋: ":"Anticlockwise: ":e.hasClass("sw")&&(a="zh_sc"==language?"按下旋钮: ":"Button: "),d.desc=a+d.desc}$(this).html(d.name).attr("data-tooltip",d.desc),o($(this)[0],t)})}};$("#keyboard-outline").on("mouseover mouseout","[class^=mykeycap]",function(e){var a=$(this).find(".key"),o=a.attr("class").match(/k([0-9a-v][0-9a-v])/i),s=parseInt("0x"+o[1]);if(128!=s){var t=keymaps[y][s>>4][15&s];"mouseover"==e.type&&(t>255||t<2)?(u||$("#keyfunction-display").html(a.attr("data-tooltip").replace("<br>","")).removeClass("hidef"),e.altKey&&$("#keyfunction-display").html($("#keyfunction-display").html()+"  Code:0x"+t.toString(16).toUpperCase())):"mouseout"==e.type&&$("#keyfunction-display").addClass("hidef")}}),$("#keycode_tabs").on("mouseover mouseout",".key-set",function(e){var a=$(this),o=a.attr("id").match(/code-((0x){0,1}[0-9a-fA-F]+)/)[1];"mouseover"==e.type&&(o>255||o<2)?$("#keyfunction-display").html(a.attr("title")).removeClass("hidef"):"mouseout"==e.type&&$("#keyfunction-display").addClass("hidef")}),$("#layer_set").on("mouseover mouseout",".layer",function(e){var a=parseInt($(this).attr("id").match(/layer-(\d+)/)[1]);a!=y&&"gmk"==b&&(h=a,"mouseover"==e.type?$("#keyboard-outline").find(".key:visible").each(function(){var e,o=this.className.match(/k([0-9a-v])([0-9a-v])/i);o[1]<8&&(e=keymaps[a][parseInt(o[1],32)][parseInt(o[2],32)]);var s=display_label(e,o[0]);s.name=s.name.replace(/fs(\d+)/g,"fs10").replace(/midfont/g,"bottomfont").replace(/bigfont/g,"bottomfont").replace(/<br>/g," ").replace("font-size","nofont"),$(this).find(".bottom_content").remove();var t=this.title;$(this).append('<span class="bottom_content">'+s.name+"</span>"),$(this).attr("title",t)}):"mouseout"==e.type&&(e.shiftKey?console.log("keep layer "+a):(h=255,$("#keyboard-outline").find(".bottom_content").remove())))}),$("#layouts-set").on("mouseover mouseout","label span",function(e){var a=$(this).attr("for");console.log(a);var o=$("#keyboard-outline").find("#kb"+a);o&&("mouseover"!=e.type||$("#layouts-set").find("#"+a).prop("checked")?"mouseout"==e.type&&($("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),o.find("[class^=mykeycap]").each(function(e){$(this).css("z-index","")}),$("#layouts-set").find("#"+a).prop("checked")||o.hide()):($("#keyboard-outline").find(".keyboard-mask").removeClass("hidef"),o.show(),o.find("[class^=mykeycap]").each(function(e){$(this).css("z-index","12")})))}),$("#keycode_tabs").on("click",".key-set",function(e,a){var o=parseInt($(this).attr("id").match(/code-((0x){0,1}[0-9a-fA-F]+)/)[1]);v&&o<152&&(o|=(15&v)<<8),4==v&&61440==(61694&o)&&o>=61952&&(o|=v<<8),U(o),o<=255&&($("#tabs-main").find("[id=code-"+o+"]").each(function(e){$(this).removeClass("keydown")}),o>=224&&o<=229&&(v&=~(1<<o-224))),l?($(this).blur(),N(o)):"zh_sc"==language?M.toast({html:"请先在上方选择要修改的按键!",classes:"rounded",displayLength:"1000"}):M.toast({html:"Please select the key you want to modify at first!",classes:"rounded",displayLength:"1000"})});var P=0,R=0,Y=0;document.addEventListener("keydown",function(e){var a=e.keyCode,o=keyCode2tmkCode(256*e.location+a);230==o&&(P&&(R=1),15!=v&&23!=v||(P=1));if(R)o>=224&&o<=229&&(v|=1<<o-224),e.returnValue=!1;else if(console.log(`KeyDN:js keycode: 0x${(256*e.location+a).toString(16)}. Key:${[tmkCode2keyName(o)]}`),$("#tabs-main").find("[id=code-"+o+"]").each(function(e){$(this).addClass("keydown")}),o>=224&&o<=229&&(v|=1<<o-224),$(":hover").length>4&&"keyboard-outline"==$(":hover")[4].id){if(e.returnValue=!1,!l)return;(o<224||o>=228)&&!v&&N(o)}}),document.addEventListener("keyup",function(e){var a=e.keyCode,o=keyCode2tmkCode(256*e.location+a),s=v;if(230==o&&R){R=0,v=0;var t,n,d,i=parseInt(Y/4);if(t=parseInt(i/128),n=parseInt(i/16)%8,d=i%16,0==Y&&(z=[no_map(),no_map(),no_map(),no_map(),no_map(),no_map(),no_map(),no_map()]),Y%4==0?5==s?(Y+=3,z[t][n][d]=1):6==s?(Y++,z[t][n][d]=0):z[t][n][d]|=s:Y%4==1?z[t][n][d]|=s<<2:Y%4==2?6==s?B++:z[t][n][d]|=s<<8:Y%4==3&&(z[t][n][d]|=s<<10),Y%4==3){var c=("0000000000000000"+z[t][n][d].toString(2)).slice(-16),r=("0"+parseInt(Y/40.95)).slice(-2);$("#keyfunction-display").removeClass("hidef").html(`接收完成前请勿操作电脑，接收按键设置 <span style='font-family:"Consolas", Sans-serif'> ${r}%  KEY[${t}][${n}][${("0"+d).slice(-2)}]: ${c}</span>`)}4096==++Y&&($("#keyfunction-display").html("接收按键完成"),$("#keyfunction-display").addClass("hidef"),Y=0,P=0,W()),e.returnValue=!1}else if(0==Y&&(console.log(`KeyUP:js keycode: 0x${(256*e.location+a).toString(16)}. Key:${tmkCode2keyName(o)}`),$("#tabs-main").find("[id=code-"+o+"]").each(function(e){$(this).removeClass("keydown")}),o>=224&&o<=229&&(v&=~(1<<o-224)),$(":hover").length>4&&"keyboard-outline"==$(":hover")[4].id)){if(e.returnValue=!1,!l)return;s&&o<224&&N(v<<8|o),!v&&(70==o||o>=224)&&N(o)}}),document.oncontextmenu=function(e){var a=$(":hover");if(event.shiftKey&&a.length>6)for(var o=6;o<a.length-1;o++){var s=a[o].className.match(/mykeycap(\d)/);if(s){var t=$('[class="'+a[o].className+'"]'),n=parseInt(s[1])+1;return n>3&&(n=1),t.removeClass(s[0]),t.addClass("mykeycap"+n),!1}}};var F=function(e){var a=l.match(/k([0-9a-v])([0-9a-v])/i);if(!a)throw"invalid id";return{row:parseInt(a[1],32),col:parseInt(a[2],32)}},N=function(e){var a=$("#keyboard-outline").find(".key-editing");if(a&&l){v&&e>=2&&e<=255&&(e|=v<<8);var s=F(),t=parseInt(s.row).toString(32)+parseInt(s.col).toString(32);keymaps[y][s.row][s.col]=e,k=!0;new Action(e);var n=display_label(e,t),d=n.name,i=n.desc;if($("."+l).each(function(){var e=$(this);e.removeClass("fade-in-down fade-in-up").addClass("fade-out-down"),setTimeout(function(){e.removeClass("fade-out-down fade-out-up").addClass("fade-in-down").html(d),setTimeout(function(){e.removeClass("fade-in-down fade-in-up")},350)},300)}),h<8&&h!=y){var c=display_label(keymaps[h][s.row][s.col],t);c.name=c.name.replace(/fs(\d+)/g,"fs10").replace(/midfont/g,"bottomfont").replace(/bigfont/g,"bottomfont").replace(/<br>/g," ").replace("font-size","nofont"),$("."+l).find(".bottom_content").remove(),$("."+l).append('<span class="bottom_content">'+c.name+"</span>")}$("."+l).attr("data-tooltip",i);o(a.find(".key")[0],e),$("."+l).focus(),$("#keyboard-outline").find(".key-editing").removeClass("key-editing"),l=null}};$("#advanced-mode-toggle").click(function(){$(this).prop("checked")?$("#advanced-mode-layer").show():$("#advanced-mode-layer").hide()}),$("#keymap-layer-copy").click(function(){for(var e=0;e<8;e++)for(var a=0;a<16;a++)C[e][a]=keymaps[y][e][a];$("#copied-layer_1, #copied-layer_2").text(y)}),$("#keymap-layer-paste").click(function(){for(var e=0;e<8;e++)for(var a=0;a<16;a++)keymaps[y][e][a]=C[e][a];L(keymaps[y])}),$("#keymap-layer-clear").click(function(){if($(this).hasClass("recovery")){$(this).removeClass("recovery").text("清空当前层设置");for(e=0;e<8;e++)for(a=0;a<16;a++)keymaps[y][e][a]=C[e][a]}else{$(this).addClass("recovery").text("恢复当前层设置");for(var e=0;e<8;e++)for(var a=0;a<16;a++)C[e][a]=keymaps[y][e][a],keymaps[y][e][a]=1}L(keymaps[y])}),$("#keymap-layer-exchange").click(function(){var e,a=$("#copied-layer_1").text();e=keymaps[y],keymaps[y]=keymaps[a],keymaps[a]=e,L(keymaps[y])}),$("#preset-keymap-list").on("click","li",function(){var e=url_decode_keymap($("#keyboard-outline").find("[id^='kb-preset_keymap-"+this.value+"']").attr("value-keymap").replace(/YDKB/g,"+"));null!=e&&(z=e,console.log(z)),W(),L(keymaps[y])}),$(".editor_dropdown").hide();for(var D in action_kinds)$("#kind_dropdown").append('<li value="{0}" class="tooltipped" data-tooltip="{1}" data-position="right" lang="zh_sc"> <a lang="zh_sc"> {2}'.format(action_kinds[D].id,action_kinds[D].desc,action_kinds[D].name));$("#kind_dropdown").find('[value^="OPT_GROUP"]').addClass("disabled optgroup uicolor-text").removeClass("tooltipped"),$("#kind_dropdown").find('[value="UNKNOWN"]').addClass("hide");for(var x in keycodes)2!=x&&3!=x&&x<255&&($("#keycodes_dropdown").append(n(x,keycodes[x].desc,s(x))),x<176&&$("#keycodes4tap_dropdown").append(n(x,keycodes[x].desc,s(x))));for(B=0;B<8;B++)$("#layer_dropdown").append(n(B,"Layer "+B,"Layer "+B));for(B=0;B<8;B++)$("#layer_tap_dropdown").append(n(B,"Layer "+B,"Layer "+B));for(B=0;B<8;B++)$("#layer_tap_dropdown").append(n(B+8,"Layer "+B+"(S)","Layer "+B+"(S)"));for(var x in on_codes)$("#layer_on_dropdown").append(n(x,on_codes[x].desc,on_codes[x].name));for(var B=0;B<100;B++){if(B<10)I="0"+B;else var I=""+B;$("#launch_shortcut_dropdown").append(n("0x47"+I,"Launch Shortcut "+I,"Shortcut "+I))}var U=function(e){var a=new Action(e),o=(new Action(255&e),$("#kind_dropdown").find("[value="+a.id+"]").text());$("#kind_dropdown-btn").html(o).attr({value:a.id}),$("#fn-set").find("ul li").removeClass("uicolor").removeAttr("style"),$("#kind_dropdown").find("[value="+a.id+"]").addClass("uicolor"),$("#kind_dropdown").trigger("change");var t=s(e);e>255&&e<53248&&(t=s(255&e)),$("#keycodes_dropdown-btn").html(t).attr({value:a.key_code}),$("#keycodes_dropdown").find("[value="+a.key_code+"]").addClass("uicolor"),(255&e)<176&&($("#keycodes4tap_dropdown-btn").html(t).attr({value:a.key_code}),$("#keycodes4tap_dropdown").find("[value="+a.key_code+"]").addClass("uicolor"));var n=a.id&&a.id.match(/(.*?)MOD(.*?)/)?mods_codes[e>>8&31].name:"";$("#key_mods_dropdown-btn").html(n).attr({value:a.key_mods}),$("#key_mods_dropdown").find("[value="+a.key_mods+"]").addClass("uicolor");var d=a.layer_tap_val<16?a.layer_tap_val:0;if("LAYER_TOGGLE"==a.id||"DEFAULT_LAYER_SET"==a.id){for(var i=15&e;i>>1;i>>=1)d++;d+=4*((224&e)>>5)}"LAYER_TOGGLE"==a.id?d-=10:"DEFAULT_LAYER_SET"==a.id&&(d-=12),$("#layer_dropdown-btn").html("Layer "+d).attr({value:d}),$("#layer_dropdown").find("[value="+d+"]").addClass("uicolor"),d<8?$("#layer_tap_dropdown-btn").html("Layer "+d).attr({value:d}):$("#layer_tap_dropdown-btn").html("Layer "+(d-8)+"(S)").attr({value:d}),$("#layer_tap_dropdown").find("[value="+d+"]").addClass("uicolor"),$("#layer_mods_dropdown-btn").html(n).attr({value:15&a.layer_tap_code}),$("#layer_mods_dropdown").find("[value="+a.layer_tap_code&"15]").addClass("uicolor"),$("#layer_on_dropdown-btn").html("Layer "+a.layer_bitop_op).attr({value:a.layer_bitop_op}),$.cookie("uicolor")&&$("#fn-set").find("ul li.uicolor").css({"background-color":$.cookie("uicolor")})};$("[id$=dropdown-btn]").on("click",function(){var e=this.id.replace("-btn","");$("[id$=dropdown]").hide(),$("#"+e).show()}),$("#fn-set").find("[id$=_dropdown]").on("click","li",function(){var e=$(this).offsetParent().attr("id"),a=$(this).attr("value");$("#fn-set").find("#"+e+"-btn").text($(this).text()).attr({value:a}),$("#"+e).find("li").removeClass("uicolor").removeAttr("style"),$("#"+e).find("[value="+a+"]").addClass("uicolor"),$.cookie("uicolor")&&$("#fn-set #"+e).find("[value="+a+"]").css({"background-color":$.cookie("uicolor")}),$("#kind_dropdown").trigger("change");var o=$("#"+e+"-btn");if(o){M.Dropdown.getInstance(o[0]).close()}}),$("#fn-set").find("button.action-apply").click(function(e){if(l){var a=action_editor_get_code();N(a)}});var G=[],K=[],z=[],H=function(e){return $.ajax({method:"GET",url:e}).done(function(e){var a=hex_split_firmware(e,KEYMAP_START_ADDRESS,KEYMAP_SIZE);if(G=a.before,K=a.after,!T&&$("#kb-preset_keymap-0").length>0){console.log("load keymap0");null!=(s=url_decode_keymap((o=$("#kb-preset_keymap-0").attr("value-keymap")).replace(/YDKB/g,"+")))&&(z=s)}else z=T?keymaps:a.keymaps,W();if(console4jslang&&!T&&$("#yang_keymap").length>0){var o=$("#yang_keymap").attr("value-keymap"),s=url_decode_keymap(o.replace(/YDKB/g,"+"));null!=s&&(z=s),$("#yang_keymap").remove()}if(0!=a.date){var t={};t.short=shorten_date(a.date[0])+shorten_date(a.date[1])+shorten_date(a.date[2]),t.long="20"+a.date[0]+"-"+a.date[1]+"-"+a.date[2]+$("#latest_firmware_date").text().slice(10),$("#latest_firmware_date").text(t.long),$("#latest_firmware_date_short").text(t.short),console.log(a.date)}$("#latest_firmware_date").show(),$("#latest_firmware_date_short").show()})};$("#firmwareFile").change(function(e){var a=e.target.files[0];if(a){var o=new FileReader;o.onloadend=function(e){var o,s=a.name.toLowerCase();if(s.match(/.hex/g)){var n=convert_hex2bin(this.result,0,0);console.log(n.length),o=31744==n.length?hex_split_firmware(this.result,29696,2048):hex_split_firmware(this.result,KEYMAP_START_ADDRESS,KEYMAP_SIZE)}else if(s.match(/.uf2/g)){var d=uf2_to_bin(this.result);o=bin_split_firmware(d.binstr,KEYMAP_START_ADDRESS,KEYMAP_SIZE,d.bin_start_addr)}else s.match(/.bin/g)&&(o=bin_split_firmware(this.result,KEYMAP_START_ADDRESS,KEYMAP_SIZE));if(z=o.keymaps,console.log(z),"udock"==f){var i=o.after;if(i.length>0&&205==i[0]){for(var c=i[1]|i[2]<<8,r="",l=0;l<c;l++)r+=String.fromCharCode(i[l+3]);t(A=unzip(r))}}$("#keymap-load").prop("disabled",!1),$("#keymap-load-div").show(),W(),L(keymaps[y])},o.readAsBinaryString(a),$("#firmwareFile").val("")}else $("#keymap-load").prop("disabled",!0)}),$("#keymap-load").prop("disabled",!0),$("#keymap-load").click(function(e,a){W()});var W=function(){for(keymaps=$.extend(!0,[],z);keymaps.length<KEYMAP_LAYERS;)keymaps.push(transparent_map());var e=""+parseInt(keymaps[1][0][0]<<16|keymaps[0][0][0]);if(console.log(parseInt(p)+1+" layouts:"+e),"1"==e.slice(0,1)&&e.length-2==p){var a=e.slice(1).match(/(\d)/g);0==layouts_save&&(layouts_save=e.slice(1));for(var o=0;o<p+1;o++){for(var s=0;s<$("div[id^='kblayouts-"+o+"']").length+1;s++)$("#kblayouts-"+o+s).hide(),$("#layouts-"+o+s).prop({checked:"false"}),$("#keyboard-outline").find(".akblayouts-"+o+s).hide();$("#kblayouts-"+o+a[o]).show(),$("#layouts-"+o+a[o]).prop({checked:"checked"}),$("#keyboard-outline").find(".akblayouts-"+o+a[o]).show()}}update_indicator(10),update_indicator_color(10)};$("#keyboard-outline").on("change","#layoutFile",function(e,a){var o=e.target.files[0];if(o){var s=new FileReader;s.onloadend=function(e){if(o.name.match(/.html/g)){if(!this.result.match(/(mykeycap.*)/))return void alert(window.lang.translate("不是布局文件"));t(A=this.result)}},s.readAsBinaryString(o),$("#layoutFile").val("")}}),$("#hex-download").prop("disabled",!0),$("#hex-download, #bin-download, #uf2-download").click(function(e,a){$("#firmwareFile")[0].files[0]&&$("#firmwareFile")[0].files[0].name.match(/\.hex/)&&console.log("hex file");var o,s=".hex";if("uf2-download"==this.id){var t=[].concat(g).concat(hex_keymaps(KEYMAP_START_ADDRESS)),n=convert_hex2bin(t,16384,KEYMAP_START_ADDRESS+KEYMAP_SIZE);console.log(n);var d=1591873650,i=$("#kbd-firmware");i.attr("value-family-id")&&(d=parseInt(i.attr("value-family-id"),16)),console.log("0x"+d.toString(16));var c=bin_to_uf2(n,134234112,d);o=new Blob([c],{type:"application/octet-stream"}),s=".uf2"}else if("bin-download"==this.id){var t=[].concat(G).concat(hex_keymaps(KEYMAP_START_ADDRESS)),r=0;"yd1800mini"!=f&&"master98"!=f&&"sairo64"!=f&&"x8086k"!=f&&"u2u_pro"!=f&&"udock"!=f||(r=57344);n=convert_hex2bin(t,0,KEYMAP_START_ADDRESS+KEYMAP_SIZE+r);if("udock"==f&&A.length>0){var l=zip(A);console.log(A.length+" to "+l.length),n[65536]=205,n[65537]=255&l.length,n[65538]=l.length>>8;for(var _=0;_<l.length;_++)n[65539+_]=l[_].charCodeAt()}var m=CONFIG.kbd[f].checksum;if(m){var u=0;for(B=0;B<n.length;B++){var p=n[B];word=1&B?p<<8:p,u+=word}var y=n[m.addr]|n[m.addr+1]<<8;u-=y,y=m.value-u&65535,n[m.addr]=255&y,n[m.addr+1]=y>>8}if(o=new Blob([n],{type:"application/octet-stream"}),s=".BIN",n[0]==n[1]&&n[1]==n[2])return void alert(window.lang.translate("下载文件有错，Ctrl+F5刷新页面后重试"))}else{var k=[].concat(G).concat(hex_keymaps(KEYMAP_START_ADDRESS)).concat(K).join("\r\n").concat("\r\n");o=new Blob([k],{type:"application/octet-stream"})}var h=$("#kbd-firmware").attr("value-filename");void 0==h&&(h=f,"bin-download"==this.id&&(h=h.toUpperCase())),saveAs(o,h+s)}),$("#share-dialog-btn").click(function(){update_share_url_panel()}),$("#keymap-share, #shorten-url").click(function(e,a){var o=zip(JSON.stringify(keymaps)),s=document.location.origin+document.location.pathname+"?"+(f+($("#kblayouts-00").length>0?"-"+layouts_save:""))+"#"+o;if("shorten-url"==this.id){var t="http://api.suowo.cn/api.htm?format=jsonp&url=urlencode("+s.replace(/\&/g,"%26").replace(/\#/g,"%23").replace(/\+/g,"YDKB")+")&callback=data&key=5f44e5d0b1b63c19739624a8@588c8ec49f482d6299e8d1b4a9f68a2f&expireDate=2030-03-31&domain=0";$.ajax({url:t,type:"GET",cache:!1,dataType:"jsonp",jsonpCallback:"data",success:function(e,a){console.log(e),$("#share-url").val(e.url),M.textareaAutoResize($("#share-url"))}}),$("#share-dialog").removeClass("url-long")}else $("#share-url").val(s),M.textareaAutoResize($("#share-url")),$("#share-dialog").addClass("url-long");update_share_url_panel()}),$("#output-c").click(function(e,a){$("#keymap-c").text().length>0?$("#keymap-c").text(""):$("#keymap-c").text(source_output(keymaps)),M.textareaAutoResize($("#keymap-c"))}),$(window).bind("beforeunload",function(){return"CAUTION: You will lost your change."}),$("#show-tabs-kbdinfo").click(function(e,a){$("#key-set-tabs").tabs("select","tabs-kbdinfo")});var X=$.Deferred().resolve();CONFIG.kbd[variant]&&CONFIG.kbd[variant].firmware_url&&($("#firmware-dropdown").val(variant),X=H(CONFIG.kbd[variant].firmware_url).done(function(e){if(!document.location.hash)for(keymaps=$.extend(!0,[],z);keymaps.length<KEYMAP_LAYERS;)keymaps.push(transparent_map());$("#hex-download").prop("disabled",!1),$("#keymap-load").prop("disabled",!1)}).fail(function(e){$("#hex-download").prop("disabled",!0),$("#keymap-load").prop("disabled",!0)}).always(function(){}));var j=function(e){var a=CONFIG.kbd[f].size;if(a){var o,s,t,d,i;a.M?o=s=t=d=a.M:(o=a.MU?a.MU:-12,s=a.MR?a.MR:-12,t=a.MD?a.MD:-12,d=a.ML?a.ML:-12),i=a.BR?a.BR:-d-6;var c=54*a.X-d-s,r=54*a.Y-o-t}var l=$(".keyboard-mask")[0],_=l?l.offsetHeight:0;$("#keyboard-outline").load(e,function(){if(a&&($("#keyboard-outline").prepend(l),a.AutoCase)){var e="height: {0}px; width: 54px; padding: {1}px 0 0 {2}px;".format(_-30,-o-8,640-27*a.X);$("#mykbd").attr("style",e);var m='<div class="{7}" style="margin: {0}px {1}px {2}px {3}px; height: {4}px; width: {5}px; border-radius: {6}px">'.format(o,s,t,d,r,c,i,"{0}");$("#mycase").prepend(m.format("kbdbg-mask")).prepend(m.format("kbdbg-border"))}var u=$("#kbd-firmware");if(u.attr("value-keymapaddr")?KEYMAP_START_ADDRESS=parseInt(u.attr("value-keymapaddr"),16):KEYMAP_START_ADDRESS=26624,console.log("KEYMAP_ADDR: 0x"+KEYMAP_START_ADDRESS.toString(16)),H(CONFIG.kbd[f].firmware_url).done(function(e){T||(W(),$("#advanced-mode-toggle").prop("checked")&&(T=1)),$("#layer_set").tabs("select","layer_0"),$("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),setTimeout(function(){$("#loading").hide()},600),setTimeout(function(){first_visit()},800)}),$("#tool-download").parent().show(),$("#hex-download").parent().show(),$("#bin-download").parent().hide(),$("#uf2-download").parent().hide(),u.attr("value-format")){$("#tool-download").parent().hide();var y=u.attr("value-format");console.log("Firmware format: "+y),y.match(/bin/g)&&($("#bin-download").parent().show(),console4jslang||$("#hex-download").parent().hide()),y.match(/uf2/g)&&($("#uf2-download").parent().show(),console4jslang||$("#hex-download").parent().hide()),y.match(/hex/g)&&($("#hex-download").parent().show(),$("#tool-download").parent().show())}$("#keyboard-outline").find("[class^=mykeycap]").each(function(){var e=keyName2tmkCode($(this).text().toUpperCase()).toLowerCase();$(this).empty(),$(this).append('<div class="plate"></div><div class="border"><div class="top"><div class="key k{0}">'.format(e));var a=$(this).attr("class").match(/.*(led(\d)).*/);if(a&&($(this).removeClass(a[1]).find(".border").prepend('<div class="kbd-led {0}">'.format(a[1])),$(this).hasClass("suden")&&$(this).removeClass("suden").find(".kbd-led").addClass("suden"),a[2]>7)){var o=$(this).attr("data-tooltip"),s=$(this).attr("led-color");s||(s="red"),$(this).removeAttr("data-tooltip led-color").find(".kbd-led").attr("data-tooltip",o).css("background-color",s)}}),$("#keyboard-outline").find(".kbd-led").each(function(){$(this).attr("class").match(/.*(led(\d)).*/)&&$(this).addClass("tooltipped").attr("data-position","left")});var k,h=$("#kbd-info").attr("value-type");if(h){var b=$("#kbd-firmware").attr("value-filename");if(void 0==b){b=CONFIG.kbd[f].name;var g=$("#kbd-firmware").attr("value-filename");g&&(b=g),"lufa_msd_ble"==h&&(b=b.toUpperCase())}!function(e,a){$.get("config/templates_bootloader.html",function(o,s){if("success"==s){var t=$(o),n=$(t).find("#"+a).html();n=n.replace(/KBD_NAME/g,e),$("#kbdinfo_detail").html(n),onLangChange(language)}})}(b,h)}else k=$("#kbd-info").html(),$("#kbd-info").remove(),$("#kbdinfo_detail").empty(),k?(is_xikiicom&&(k=k.replace("help.ydkb.io","ydkb.xikii.com/help")),$("#kbdinfo_detail").append(k)):$("#kbdinfo_detail").append("暂无其他说明");$("#purchase-link").empty(),$("#purchase-link").append('<li class="waves-effect waves-light"><a href="#!">尊重劳动成果，远离山寨。右侧为'+CONFIG.kbd[f].name+"正规购买渠道和介绍。");var v=$("[id^='kbd-purchase_link_']");if(v.length>0?(v.each(function(){$("#purchase-link").append('<li class="waves-effect waves-light"><a href="'+$(this).attr("value")+'" target="_blank">'+$(this).text()),$(this).remove()}),$(".fixed-action-btn.toolbar").find(".scale-transition").removeClass("scale-out")):($("#purchase-link").append('<li class="waves-effect waves-light"><a href="#!">暂无链接'),$(".fixed-action-btn.toolbar").find(".scale-transition").addClass("scale-out")),$("#macrofn").empty(),$("#macrofn").html($("#kbd-macrofn").html().replace(/\(R\)/g,"<SUB> (R)</SUB>").replace(/\(L\)/g,"<SUB> (L)</SUB>")),$("#macrofn").find('[id^="code-"]').addClass("key-set").attr("lang","zh_sc"),$("#kbd-macrofn").remove(),$("#kblayouts-00").length>0){if($("#layouts-set-div, #layouts-set-on2").show(),$("#layouts-set-on").removeClass("scale-out"),$("#layouts-set").empty(),layouts_save)var A=layouts_save.match(/(\d)/g);p=0,$("div[id^='kblayouts-']").each(function(){var e=this.id.match(/kblayouts-(\d)(\d)/),a=e[1],o=e[2];p<a&&(p=a),0==o&&($("#layouts-set").append('<div class="rowstart">[ '+$(this).attr("value-desc")+" ]"),$("#layouts-set").append('<div id="layouts-'+a+'">'),A&&A[a]||(layouts_save+="0")),$("#layouts-"+a).append('<label><input type="radio" id="layouts-'+a+o+'" class="layouts-'+a+' with-gap" name="layouts-'+a+'"/><span for="layouts-'+a+o+'">'+$(this).attr("value-name")),A&&A[a]&&($("#kblayouts-"+a+"0").hide(),$("#kblayouts-"+a+A[a]).show()),"block"==$(this).css("display")&&$("#layouts-"+a+o).prop({checked:"checked"})})}if($("#ledmap-tab,[id^='indicator_dropdown-'], [id^='indicator-color-']").each(function(){$(this).hide()}),$("#kb_ledmap-0").length>0&&($("#ledmap-tab").show(),$("[id^='kb_ledmap-']").each(function(){var e=this.id.replace("kb_ledmap-","");$("#indicator_dropdown-name_"+e).show().text($(this).text()).attr({"data-tooltip":$(this).attr("title")}),$("#indicator_dropdown-btn_"+e).show(),$(this).hasClass("rgb_color")&&$("#indicator-color-btn_"+e).show(),T||update_indicator(e,this.value)})),$("#preset-keymap-group").hide(),$("#preset-keymap-list").empty(),$("#kb-preset_keymap").length>0&&($("#preset-keymap-group").show(),$("[id^='kb-preset_keymap-']").each(function(){var e=this.id.replace("kb-preset_keymap-","");$("#preset-keymap-list").append(n(e,this.title,'<i class="material-icons mr5">cloud_download</i>'+$(this).text()))})),$("#kb-changelog-url").length>0){var C,E=$("#kb-changelog-url").attr("href"),w=E.match(/.*?changelog:(.*)/),S="help/#/changelog/"+(C=w&&w.length>1?w[1]:E);$("#latest_firmware_changelog").attr("href",S).attr("target","_blank").show()}else $("#latest_firmware_changelog").removeAttr("href target").hide();onLangChange(language),function(e){$.get(e,function(e,a){if("success"==a){var o=$(e),s=["#backlight_control_keys","#ble51_control_keys","#ble51_control_keys_v2","#ble51_control_keys_v3","#rgb_control_keys"];for(B in s)$(s[B]).each(function(){var e=$(o).find(s[B]).html();$(this).html(e)})}})}("/config/templates_led_fn.html")})};$.when(X).then(function(){variant?f=variant:$.cookie&&$.cookie("ck_select_kbd")&&(f=$.cookie("ck_select_kbd")),e(f)}),$("#keyboard-outline").on("mousedown","[class^='mykeycap']",function(e){if(2!=e.button&&!$("#kbdinfo_tab").hasClass("active")){var a=$(":hover");if(!a[a.length-1].className.match("kbd-led")&&"k80"!=(l=$(this).find(".key")[0].classList[1])){if($(this).hasClass("key-editing"))$(this).removeClass("key-editing"),l=null;else{$("#keyboard-outline").find(".key-editing").removeClass("key-editing"),$("[id$=dropdown]").hide(),$(this).addClass("key-editing");var o=F(),s=keymaps[y][o.row][o.col];U(s)}1==e.button&&(e.preventDefault(),N(e.shiftKey?0:1)),$(this).blur()}}}),$("#import-user-keycap-colors").click(function(e,a){console.log($("#user-keycap-colors").val());var o=$("#user-keycap-colors").val().split(",");o instanceof Array&&6==o.length&&update_keycap_color(o)})});var action_kinds={KEY:{id:"KEY",name:"常规按键",desc:"常规按键"},MODS_KEY:{id:"MODS_KEY",name:"修饰键（组合键）",desc:"修饰键，指ctrl shift alt(option) win(command)这些"},LAYER_MOMENTARY:{id:"LAYER_MOMENTARY",name:"瞬时开启层",desc:"按下按键时瞬时开启层，放开按键时层会关闭"},LAYER_TOGGLE:{id:"LAYER_TOGGLE",name:"层开关",desc:"切换层开关"},LAYER_MODS:{id:"LAYER_MODS",name:"修饰键 & 瞬时开启层",desc:"瞬时开启层的同时按下修饰键(目前仅支持左修饰键)"},DEFAULT_LAYER_SET:{id:"DEFAULT_LAYER_SET",name:"设置默认层",desc:"设置一个层为默认层"},LAUNCH_SHORTCUT:{id:"LAUNCH_SHORTCUT",name:"启动快捷方式",desc:"启动一个快捷方式(仅支持windows，使用方法见帮助)"},OPT_GROUP2:{id:"OPT_GROUP2",name:"Tap二合一功能按键 ▼",desc:"Tap二合一功能按键"},MODS_TAP_KEY:{id:"MODS_TAP_KEY",name:"按键 | 修饰键",desc:"单击时是按键，长按及和其他键组合时是修饰键"},LAYER_TAP_KEY:{id:"LAYER_TAP_KEY",name:"按键 | 瞬时开启层",desc:"单击是按键，长按及和其他键组合时是瞬时开启层"},LAYER_TAP_TOGGLE:{id:"LAYER_TAP_TOGGLE",name:"层开关 | 瞬时开启层",desc:"瞬时开启层，如果连续点击数次时开关层"},UNKNOWN:{id:"UNKNOWN",name:"其他",desc:"用于显示特殊功能，或该键盘不支持的功能"}};Object.freeze(action_kinds);var keycodes=[];keycodes[0]={id:"NO  ",name:'<i class="fa fa-ban fs22"></i>',desc:"设置该按键在该层无效，也可用<kt>shift</kt>+<kt>鼠标中键</kt>点击设置"},keycodes[1]={id:"TRNS",name:"",desc:"按键透明，也可用<kt>鼠标中键</kt>点击按键设置"},keycodes[2]={id:"POST_FAIL",name:"POST_FAIL",desc:"POST_FAIL"},keycodes[3]={id:"UNDEFINED",name:"UNDEFINED",desc:"UNDEFINED"},keycodes[4]={id:"A",name:"A",desc:"A"},keycodes[5]={id:"B",name:"B",desc:"B"},keycodes[6]={id:"C",name:"C",desc:"C"},keycodes[7]={id:"D",name:"D",desc:"D"},keycodes[8]={id:"E",name:"E",desc:"E"},keycodes[9]={id:"F",name:"F",desc:"F"},keycodes[10]={id:"G",name:"G",desc:"G"},keycodes[11]={id:"H",name:"H",desc:"H"},keycodes[12]={id:"I",name:"I",desc:"I"},keycodes[13]={id:"J",name:"J",desc:"J"},keycodes[14]={id:"K",name:"K",desc:"K"},keycodes[15]={id:"L",name:"L",desc:"L"},keycodes[16]={id:"M",name:"M",desc:"M"},keycodes[17]={id:"N",name:"N",desc:"N"},keycodes[18]={id:"O",name:"O",desc:"O"},keycodes[19]={id:"P",name:"P",desc:"P"},keycodes[20]={id:"Q",name:"Q",desc:"Q"},keycodes[21]={id:"R",name:"R",desc:"R"},keycodes[22]={id:"S",name:"S",desc:"S"},keycodes[23]={id:"T",name:"T",desc:"T"},keycodes[24]={id:"U",name:"U",desc:"U"},keycodes[25]={id:"V",name:"V",desc:"V"},keycodes[26]={id:"W",name:"W",desc:"W"},keycodes[27]={id:"X",name:"X",desc:"X"},keycodes[28]={id:"Y",name:"Y",desc:"Y"},keycodes[29]={id:"Z",name:"Z",desc:"Z"},keycodes[30]={id:"1",name:"!<br>1",desc:"1 !"},keycodes[31]={id:"2",name:"@<br>2",desc:"2 @"},keycodes[32]={id:"3",name:"#<br>3",desc:"3 #"},keycodes[33]={id:"4",name:"$<br>4",desc:"4 $"},keycodes[34]={id:"5",name:"%<br>5",desc:"5 %"},keycodes[35]={id:"6",name:"^<br>6",desc:"6 ^"},keycodes[36]={id:"7",name:"&<br>7",desc:"7 &"},keycodes[37]={id:"8",name:"*<br>8",desc:"8 *"},keycodes[38]={id:"9",name:"(<br>9",desc:"9 ("},keycodes[39]={id:"0",name:")<br>0",desc:"0 )"},keycodes[40]={id:"ENT",name:"Enter",desc:"Enter",name_mac:"Return",desc_mac:"Return"},keycodes[41]={id:"ESC",name:"Esc",desc:"Esc"},keycodes[42]={id:"BSPC",name:"BS",desc:"Backspace",name_mac:"Delete",desc_mac:"Delete"},keycodes[43]={id:"TAB",name:"Tab",desc:"Tab"},keycodes[44]={id:"SPC",name:"Space",desc:"Space"},keycodes[45]={id:"MINS",name:"_<br>-",desc:"- _"},keycodes[46]={id:"EQL",name:"+<br>=",desc:"= +"},keycodes[47]={id:"LBRC",name:"{<br>[",desc:"[ {"},keycodes[48]={id:"RBRC",name:"}<br>]",desc:"] }"},keycodes[49]={id:"BSLS",name:"|<br>\\",desc:"\\ |"},keycodes[50]={id:"NUHS",name:"~<br>#",desc:"ISO ~#"},keycodes[51]={id:"SCLN",name:":<br>;",desc:"; :"},keycodes[52]={id:"QUOT",name:"\"<br>'",desc:"' \""},keycodes[53]={id:"GRV ",name:"~<br>`",desc:"` ~"},keycodes[54]={id:"COMM",name:"<<br>,",desc:", <"},keycodes[55]={id:"DOT ",name:"><br>.",desc:". >"},keycodes[56]={id:"SLSH",name:"?<br>/",desc:"/ ?"},keycodes[57]={id:"CAPS",name:"Caps Lock",desc:"CapsLock"},keycodes[58]={id:"F1  ",name:"F1",desc:"F1"},keycodes[59]={id:"F2  ",name:"F2",desc:"F2"},keycodes[60]={id:"F3  ",name:"F3",desc:"F3"},keycodes[61]={id:"F4  ",name:"F4",desc:"F4"},keycodes[62]={id:"F5  ",name:"F5",desc:"F5"},keycodes[63]={id:"F6  ",name:"F6",desc:"F6"},keycodes[64]={id:"F7  ",name:"F7",desc:"F7"},keycodes[65]={id:"F8  ",name:"F8",desc:"F8"},keycodes[66]={id:"F9  ",name:"F9",desc:"F9"},keycodes[67]={id:"F10 ",name:"F10",desc:"F10"},keycodes[68]={id:"F11 ",name:"F11",desc:"F11"},keycodes[69]={id:"F12 ",name:"F12",desc:"F12"},keycodes[70]={id:"PSCR",name:"Print<br>Scrn",desc:"Print Screen",name_mac:"F13",desc_mac:"F13(mac)"},keycodes[71]={id:"SLCK",name:"Scrll<br>Lock",desc:"Scroll Lock",name_mac:"F14",desc_mac:"F14(mac)"},keycodes[72]={id:"PAUS",name:"Pause",desc:"Pause Break",name_mac:"F15",desc_mac:"F15(mac)"},keycodes[73]={id:"INS ",name:"Ins",desc:"Insert"},keycodes[74]={id:"HOME",name:"Home",desc:"Home"},keycodes[75]={id:"PGUP",name:"Page<br>Up",desc:"Page Up"},keycodes[76]={id:"DEL ",name:"Del",desc:"Del"},keycodes[77]={id:"END ",name:"End",desc:"End"},keycodes[78]={id:"PGDN",name:"Page<br>Dn",desc:"Page Down"},keycodes[79]={id:"RGHT",name:"→",name_dsa:'<i class="fa fa-arrow-right"/>',desc:"Right"},keycodes[80]={id:"LEFT",name:"←",name_dsa:'<i class="fa fa-arrow-left"/>',desc:"Left"},keycodes[81]={id:"DOWN",name:"↓",name_dsa:'<i class="fa fa-arrow-down"/>',desc:"Down"},keycodes[82]={id:"UP  ",name:"↑",name_dsa:'<i class="fa fa-arrow-up"/>',desc:"Up"},keycodes[83]={id:"NLCK",name:"Num<br>Lock",desc:"Num Lock",name_mac:"Clear",desc_mac:"Clear"},keycodes[84]={id:"PSLS",name:"/",name_dsa:"÷",desc:"Keypad /"},keycodes[85]={id:"PAST",name:"*",name_dsa:"×",desc:"Keypad *"},keycodes[86]={id:"PMNS",name:"-",desc:"Keypad -"},keycodes[87]={id:"PPLS",name:"+",desc:"Keypad +"},keycodes[88]={id:"PENT",name:"P↩",desc:"Keypad Enter"},keycodes[89]={id:"P1  ",name:'1<br><span class="fs10">End</span>',name_dsa:"1",desc:"Keypad 1"},keycodes[90]={id:"P2  ",name:"2<br>↓",name_dsa:"2",desc:"Keypad 2"},keycodes[91]={id:"P3  ",name:'3<br><span class="fs10">PgDn</span>',name_dsa:"3",desc:"Keypad 3"},keycodes[92]={id:"P4  ",name:"4<br>←",name_dsa:"4",desc:"Keypad 4"},keycodes[93]={id:"P5  ",name:"5",desc:"Keypad 5"},keycodes[94]={id:"P6  ",name:"6<br>→",name_dsa:"6",desc:"Keypad 6"},keycodes[95]={id:"P7  ",name:'7<br><span class="fs10">Home</span>',name_dsa:"7",desc:"Keypad 7"},keycodes[96]={id:"P8  ",name:"8<br>↑",name_dsa:"8",desc:"Keypad 8"},keycodes[97]={id:"P9  ",name:'9<br><span class="fs10">PgUp</span>',name_dsa:"9",desc:"Keypad 9"},keycodes[98]={id:"P0  ",name:'0<br><span class="fs10">Ins</span>',name_dsa:"0",desc:"Keypad 0"},keycodes[99]={id:"PDOT",name:'.<br><span class="fs10">Del</span>',name_dsa:".",desc:"Keypad ."},keycodes[100]={id:"NUBS",name:"|<sub>ISO</sub><br>\\",desc:"|\\ for ISO layout"},keycodes[101]={id:"APP ",name:"Menu",desc:"Menu on Win"},keycodes[102]={id:"POWER",name:"Power",desc:"Power(work on Mac)"},keycodes[103]={id:"PEQL",name:"=",desc:"Keymapd Equal(Not work on Win)"},keycodes[104]={id:"F13 ",name:"F13",desc:"F13"},keycodes[105]={id:"F14 ",name:"F14",desc:"F14"},keycodes[106]={id:"F15 ",name:"F15",desc:"F15"},keycodes[107]={id:"F16 ",name:"F16",desc:"F16"},keycodes[108]={id:"F17 ",name:"F17",desc:"F17"},keycodes[109]={id:"F18 ",name:"F18",desc:"F18"},keycodes[110]={id:"F19 ",name:"F19",desc:"F19"},keycodes[111]={id:"F20 ",name:"F20",desc:"F20"},keycodes[112]={id:"F21 ",name:"F21",desc:"F21"},keycodes[113]={id:"F22 ",name:"F22",desc:"F22"},keycodes[114]={id:"F23 ",name:"F23",desc:"F23"},keycodes[115]={id:"F24 ",name:"F24",desc:"F24"},keycodes[130]={id:"LCAP",name:"Locking Caps Lock",desc:"Locking Caps Lock"},keycodes[131]={id:"LNUM",name:"Locking Num Lock",desc:"Locking Num Lock"},keycodes[132]={id:"LSCR",name:"Locking Scroll Lock",desc:"Locking Scroll Lock"},keycodes[135]={id:"INT1",name:"JIS ろ",desc:"Japanese RO"},keycodes[136]={id:"INT2",name:"ひらがな",desc:"Japanese Hiragana"},keycodes[137]={id:"INT3",name:"JIS ￥",desc:"Japanese Yen"},keycodes[138]={id:"INT4",name:"変換",desc:"Japanese Henkan"},keycodes[139]={id:"INT5",name:"無変換",desc:"Japanese Muhenkan"},keycodes[140]={id:"INT6",name:"INT6",desc:"INT6"},keycodes[141]={id:"INT7",name:"INT7",desc:"INT7"},keycodes[142]={id:"INT8",name:"INT8",desc:"INT8"},keycodes[143]={id:"INT9",name:"INT9",desc:"INT9"},keycodes[144]={id:"LANG1",name:"한/영",desc:"Korean Hangul/English"},keycodes[145]={id:"LANG2",name:"한자",desc:"Korean Hanja"},keycodes[146]={id:"LANG3",name:"LANG3",desc:"LANG3"},keycodes[147]={id:"LANG4",name:"LANG4",desc:"LANG4"},keycodes[148]={id:"LANG5",name:"LANG5",desc:"LANG5"},keycodes[149]={id:"LANG6",name:"LANG6",desc:"LANG6"},keycodes[150]={id:"LANG7",name:"LANG7",desc:"LANG7"},keycodes[151]={id:"LANG8",name:"LANG8",desc:"LANG8"},keycodes[152]={id:"LANG9",name:"LANG9",desc:"LANG9"},keycodes[176]={id:"P00",name:"00",desc:"Keypad 00, 极少数键盘未支持此功能"},keycodes[224]={id:"LCTL",name:"Ctrl",desc:"Left Control"},keycodes[225]={id:"LSFT",name:"Shift",desc:"Left Shift"},keycodes[226]={id:"LALT",name:"Alt",desc:"Left Alt",name_mac:"Option",desc_mac:"Left option⌥"},keycodes[227]={id:"LGUI",name:"Win",desc:"Left Windows",name_mac:"Cmd⌘",desc_mac:"Left command⌘"},keycodes[228]={id:"RCTL",name:"rCtrl",desc:"Right Control"},keycodes[229]={id:"RSFT",name:"rShift",desc:"Right Shift"},keycodes[230]={id:"RALT",name:"rAlt",desc:"Right Alt",name_mac:"rOption",desc_mac:"Right option⌥"},keycodes[231]={id:"RGUI",name:"rWin",desc:"Right Windows",name_mac:"rCmd⌘",desc_mac:"Right command⌘"},keycodes[358]={id:"MAC_POWER_MENU",name:'<i class="i_mac_powermenu fs32"></i>',desc:"Mac: 显示一个对话框，询问您是要重新启动、睡眠还是关机"},keycodes[870]={id:"MAC_SCREENOFF",name:'<i class="i_mac_display_off fs32"></i>',desc:"Mac: 将显示器置于睡眠状态"},keycodes[3174]={id:"MAC_SLEEP",name:'<i class="i_mac_powersleep fs32"></i>',desc:"Mac: 将您的 Mac 置于睡眠状态"},Object.freeze(keycodes),system_codes=[],system_codes[129]={id:"PWR ",name:'<i class="i_system_power fs32"></i>',desc:"System Power，适合Win10，仅有线模式下有效"},system_codes[130]={id:"SLEP",name:'<i class="i_system_sleep fs32"></i>',desc:"System Sleep，仅有线模式下有效"},system_codes[131]={id:"WAKE",name:'<i class="i_system_wake fs32"></i>',desc:"System Wake，仅有线模式下有效"},Object.freeze(system_codes),consumer_codes=[],consumer_codes[111]={id:"SBUP",name:' <i style="padding-left:6px" class="kb kb-Unicode-Screen-Bright fs24"/>',desc:"增大屏幕亮度，需要设备本身支持此功能，系统要求win8以上/Mac/iOS/iPadOS"},consumer_codes[112]={id:"SBDN",name:' <i style="padding-left:6px" class="kb kb-Unicode-Screen-Dim fs24"/>',desc:"降低屏幕亮度，需要设备本身支持此功能，系统要求win8以上/Mac/iOS/iPadOS"},consumer_codes[226]={id:"MUTE",name:' <i class="kb kb-Multimedia-Mute-2 fs22"/>',desc:"静音"},consumer_codes[233]={id:"VOLU",name:' <i class="kb kb-Multimedia-Volume-Up-2 fs22"/>',desc:"音量加"},consumer_codes[234]={id:"VOLD",name:' <i class="kb kb-Multimedia-Volume-Down-2 fs22"/>',desc:"音量减"},consumer_codes[181]={id:"MNXT",name:' <i class="fa fa-step-forward fs20"/>',desc:"下一曲"},consumer_codes[182]={id:"MPRV",name:' <i class="fa fa-step-backward fs20"/>',desc:"上一曲"},consumer_codes[183]={id:"MSTP",name:' <i class="fa fa-stop fs20"/>',desc:"停止播放"},consumer_codes[184]={id:"EJCT",name:' <i class="material-icons fs22">keyboard_hide</i>',desc:"显示或隐藏iOS/iPadOS虚拟键盘"},consumer_codes[205]={id:"MPLY",name:' <i class="fa fa-play fs20"/>',desc:"播放/暂停"},consumer_codes[387]={id:"MSEL",name:' <i class="fa fa-music fs20"/>',desc:"启动默认音乐播放器"},consumer_codes[394]={id:"MAIL",name:' <i class="fa fa-envelope fs20"></i>',desc:"邮件"},consumer_codes[402]={id:"CALC",name:' <i class="fa fa-calculator fs22"/>',desc:"计算器，仅Windows下有效"},consumer_codes[404]={id:"MYCM",name:' <i class="fa fa-desktop fs20"></i>',desc:"资源管理器，仅Windows下有效"},consumer_codes[545]={id:"WSCH",name:'<i class="i_www_search fs32"></i>',desc:"浏览器： 搜索"},consumer_codes[547]={id:"WHOM",name:'<i class="i_www_home fs32"></i>',desc:"浏览器： 主页"},consumer_codes[548]={id:"WBAK",name:'<i class="i_www_back fs32"></i>',desc:"浏览器： 后退"},consumer_codes[549]={id:"WFWD",name:'<i class="i_www_forward fs32"></i>',desc:"浏览器： 前进"},consumer_codes[550]={id:"WSTP",name:'<i class="i_www_stop fs32"></i>',desc:"浏览器： 停止"},consumer_codes[551]={id:"WREF",name:'<i class="i_www_refresh fs32"></i>',desc:"浏览器： 刷新"},consumer_codes[554]={id:"WFAV",name:'<i class="i_www_favorites fs32"></i>',desc:"浏览器： 收藏夹"},consumer_codes[179]={id:"MFFD",name:"Fast Forward",desc:"Media Fast Forward(Mac)"},consumer_codes[180]={id:"MRWD",name:"Rewind",desc:"Media Rewind(Mac)"},Object.freeze(consumer_codes),mousekey_codes=[],mousekey_codes[240]={id:"MS_U",name:'<i class="i_mouse_move_up fs32"></i>',desc:"鼠标： 上移"},mousekey_codes[241]={id:"MS_D",name:'<i class="i_mouse_move_down fs32"></i>',desc:"鼠标： 下移"},mousekey_codes[242]={id:"MS_L",name:'<i class="i_mouse_move_left fs32"></i>',desc:"鼠标： 左移"},mousekey_codes[243]={id:"MS_R",name:'<i class="i_mouse_move_right fs32"></i>',desc:"鼠标： 右移"},mousekey_codes[244]={id:"BTN1",name:'<i class="i_mouse_left fs32"></i>',desc:"鼠标: 点击左键"},mousekey_codes[245]={id:"BTN2",name:'<i class="i_mouse_right fs32"></i>',desc:"鼠标: 点击右键"},mousekey_codes[246]={id:"BTN3",name:'<i class="i_mouse_middle fs32"></i>',desc:"鼠标: 点击中键"},mousekey_codes[247]={id:"BTN4",name:'<i class="i_mouse_back fs32"></i>',desc:"鼠标: 点击后退"},mousekey_codes[248]={id:"BTN5",name:'<i class="i_mouse_forward fs32"></i>',desc:"鼠标: 点击前进"},mousekey_codes[249]={id:"WH_U",name:'<i class="i_mouse_wheel_up fs32"></i>',desc:"鼠标: 滚轮 上"},mousekey_codes[250]={id:"WH_D",name:'<i class="i_mouse_wheel_down fs32"></i>',desc:"鼠标: 滚轮 下"},mousekey_codes[251]={id:"WH_L",name:'<i class="i_mouse_wheel_left fs32"></i>',desc:"鼠标: 滚轮 左"},mousekey_codes[252]={id:"WH_R",name:'<i class="i_mouse_wheel_right fs32"></i>',desc:"鼠标: 滚轮 右"},mousekey_codes[253]={id:"ACL0",name:'<i class="i_mouse_speed_slow fs32"></i>',desc:"鼠标: 移动速度 慢"},mousekey_codes[254]={id:"ACL1",name:'<i class="i_mouse_speed_medium fs32"></i>',desc:"鼠标: 移动速度 中"},mousekey_codes[255]={id:"ACL2",name:'<i class="i_mouse_speed_fast fs32"></i>',desc:"鼠标: 移动速度 快"},mousekey_codes[0]={id:"BTN1_",name:"火力左键",desc:"火力模式按键 鼠标左键"},mousekey_codes[4]={id:"A",name:"火A",desc:"火力模式按键 A"},mousekey_codes[5]={id:"B",name:"火B",desc:"火力模式按键 B"},mousekey_codes[6]={id:"C",name:"火C",desc:"火力模式按键 C"},mousekey_codes[7]={id:"D",name:"火D",desc:"火力模式按键 D"},mousekey_codes[8]={id:"E",name:"火E",desc:"火力模式按键 E"},mousekey_codes[9]={id:"F",name:"火F",desc:"火力模式按键 F"},mousekey_codes[10]={id:"G",name:"火G",desc:"火力模式按键 G"},mousekey_codes[11]={id:"H",name:"火H",desc:"火力模式按键 H"},mousekey_codes[12]={id:"I",name:"火I",desc:"火力模式按键 I"},mousekey_codes[13]={id:"J",name:"火J",desc:"火力模式按键 J"},mousekey_codes[14]={id:"K",name:"火K",desc:"火力模式按键 K"},mousekey_codes[15]={id:"L",name:"火L",desc:"火力模式按键 L"},mousekey_codes[16]={id:"M",name:"火M",desc:"火力模式按键 M"},mousekey_codes[17]={id:"N",name:"火N",desc:"火力模式按键 N"},mousekey_codes[18]={id:"O",name:"火O",desc:"火力模式按键 O"},mousekey_codes[19]={id:"P",name:"火P",desc:"火力模式按键 P"},mousekey_codes[20]={id:"Q",name:"火Q",desc:"火力模式按键 Q"},mousekey_codes[21]={id:"R",name:"火R",desc:"火力模式按键 R"},mousekey_codes[22]={id:"S",name:"火S",desc:"火力模式按键 S"},mousekey_codes[23]={id:"T",name:"火T",desc:"火力模式按键 T"},mousekey_codes[24]={id:"U",name:"火U",desc:"火力模式按键 U"},mousekey_codes[25]={id:"V",name:"火V",desc:"火力模式按键 V"},mousekey_codes[26]={id:"W",name:"火W",desc:"火力模式按键 W"},mousekey_codes[27]={id:"X",name:"火X",desc:"火力模式按键 X"},mousekey_codes[28]={id:"Y",name:"火Y",desc:"火力模式按键 Y"},mousekey_codes[29]={id:"Z",name:"火Z",desc:"火力模式按键 Z"},mousekey_codes[30]={id:"1",name:"火1",desc:"火力模式按键 1 !"},mousekey_codes[31]={id:"2",name:"火2",desc:"火力模式按键 2 @"},mousekey_codes[32]={id:"3",name:"火3",desc:"火力模式按键 3 #"},mousekey_codes[33]={id:"4",name:"火4",desc:"火力模式按键 4 $"},mousekey_codes[34]={id:"5",name:"火5",desc:"火力模式按键 5 %"},mousekey_codes[35]={id:"6",name:"火6",desc:"火力模式按键 6 ^"},mousekey_codes[36]={id:"7",name:"火7",desc:"火力模式按键 7 &"},mousekey_codes[37]={id:"8",name:"火8",desc:"火力模式按键 8 *"},mousekey_codes[38]={id:"9",name:"火9",desc:"火力模式按键 9 ("},mousekey_codes[39]={id:"0",name:"火0",desc:"火力模式按键 0 )"},mousekey_codes[62]={id:"F5",name:"火F5",desc:"火力模式按键 F5"},Object.freeze(mousekey_codes),mods_codes=[],mods_codes[0]={id:0,name:"    ",desc:"none"},mods_codes[1]={id:1,name:"Ctrl",desc:"Control"},mods_codes[2]={id:2,name:"Shift",desc:"Shift"},mods_codes[3]={id:3,name:"Shift+Ctrl",desc:"Shift + Control"},mods_codes[4]={id:4,name:"Alt",desc:"Alt"},mods_codes[5]={id:5,name:"Alt+Ctrl",desc:"Alt + Control"},mods_codes[6]={id:6,name:"Alt+Shift",desc:"Alt + Shift"},mods_codes[7]={id:7,name:"Alt+Shift+Ctrl",desc:"Alt + Shift + Control"},mods_codes[8]={id:8,name:"Win",desc:"Win"},mods_codes[9]={id:9,name:"Win+Ctrl",desc:"Win + Control"},mods_codes[10]={id:10,name:"Win+Shift",desc:"Win + Shift"},mods_codes[11]={id:11,name:"Win+Shift+Ctrl",desc:"Win + Shift + Control"},mods_codes[12]={id:12,name:"Win+Alt",desc:"Win + Alt"},mods_codes[13]={id:13,name:"Win+Alt+Ctrl",desc:"Win + Alt + Control"},mods_codes[14]={id:14,name:"Win+Alt+Shift",desc:"Win + Alt + Shift"},mods_codes[15]={id:15,name:"Win+Alt+Shift+Ctrl",desc:"Win + Alt + Shift + Control"},mods_codes[16]={id:16,name:"    ",desc:"none"},mods_codes[17]={id:17,name:"rCtrl",desc:"rControl"},mods_codes[18]={id:18,name:"rShift",desc:"rShift"},mods_codes[19]={id:19,name:"rShift+rCtrl",desc:"rShift + rControl"},mods_codes[20]={id:20,name:"rAlt",desc:"rAlt"},mods_codes[21]={id:21,name:"rAlt+rCtrl",desc:"rAlt + rControl"},mods_codes[22]={id:22,name:"rAlt+rShift",desc:"rAlt + rShift"},mods_codes[23]={id:23,name:"rAlt+rShift+rCtrl",desc:"rAlt + rShift + rControl"},mods_codes[24]={id:24,name:"rWin",desc:"rWin"},mods_codes[25]={id:25,name:"rWin+rCtrl",desc:"rWin + rControl"},mods_codes[26]={id:26,name:"rWin+rShift",desc:"rWin + rShift"},mods_codes[27]={id:27,name:"rWin+rShift+rCtrl",desc:"rWin + rShift + rControl"},mods_codes[28]={id:28,name:"rWin+rAlt",desc:"rWin + rAlt"},mods_codes[29]={id:29,name:"rWin+rAlt+rCtrl",desc:"rWin + rAlt + rControl"},mods_codes[30]={id:30,name:"rWin+rAlt+rShift",desc:"rWin + rAlt + rShift"},mods_codes[31]={id:31,name:"rWin+rAlt+rShift+rCtrl",desc:"rWin + rAlt + rShift + rControl"},Object.freeze(mods_codes),on_codes=[],on_codes[1]={id:1,name:"On Press",desc:"On Press"},on_codes[2]={id:1,name:"On Release",desc:"On Release"},on_codes[3]={id:1,name:"On Both",desc:"On Press and Release"},am_codes=[],am_codes[0]={id:"未知",name:"未知",desc:"未知"},af_codes=[],af_codes[0]={id:"未知",name:"未知",desc:"未知"},KEYMAP_LAYERS=8,KEYMAP_ROW=8,KEYMAP_COL=16,no_map=function(){return[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]},transparent_map=function(){return[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]},keymaps=[[[136,17642,17641,17634,4,5,6,7,8,9,10,11,12,13,14,15],[16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],[32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47],[48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],[64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79],[80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],[96,97,98,99,100,101,133,103,20724,20725,20726,20727,20728,20729,20730,111],[112,113,114,115,137,135,138,139,224,225,226,227,228,229,230,231]],transparent_map(),transparent_map(),transparent_map(),transparent_map(),transparent_map(),transparent_map(),transparent_map()],KEYMAP_START_ADDRESS=26624,KEYMAP_SIZE=2048,ACT_MODS=0,ACT_LMODS=0,ACT_RMODS=1,ACT_MODS_TAP=2,ACT_LMODS_TAP=2,ACT_RMODS_TAP=3,ACT_USAGE=4,ACT_MOUSEKEY=5,ACT_LAYER=8,ACT_LAYER_EXT=9,ACT_LAYER_TAP=10,ACT_LAYER_TAP_EXT=11,ACT_MACRO=12,ACT_BACKLIGHT=13,ACT_COMMAND=14,ACT_FUNCTION=15,OP_TAP_TOGGLE=240,OP_ON_OFF=241,OP_OFF_ON=242,OP_SET_CLEAR=243,OP_BIT_AND=0,OP_BIT_OR=1,OP_BIT_XOR=2,OP_BIT_SET=3,ON_SPECIAL_USE=0,ON_PRESS=1,ON_RELEASE=2,ON_BOTH=3,MOD_LCTL=1,MOD_LSFT=2,MOD_LALT=4,MOD_LGUI=8,MOD_RCTL=17,MOD_RSFT=18,MOD_RALT=20,MOD_RGUI=24,MODS_ONESHOT=0,MODS_TAP_TOGGLE=1,PAGE_CONSUMER=0,PAGE_SYSTEM=1,FUNC_TAP=8;var kind_codes={KEY:ACT_MODS<<12,MODS_KEY:ACT_MODS<<12,MODS_TAP_KEY:ACT_MODS_TAP<<12,MODS_ONESHOT:ACT_MODS_TAP<<12|MODS_ONESHOT,MODS_TAP_TOGGLE:ACT_MODS_TAP<<12|MODS_TAP_TOGGLE,USAGE_SYSTEM:ACT_USAGE<<12|PAGE_SYSTEM<<10,USAGE_CONSUMER:ACT_USAGE<<12|PAGE_CONSUMER<<10,MOUSEKEY:ACT_MOUSEKEY<<12,MACRO:ACT_MACRO<<12,MACRO_TAP:ACT_MACRO<<12,MACRO_OPT:ACT_MACRO<<12,FUNCTION:ACT_FUNCTION<<12,FUNCTION_TAP:ACT_FUNCTION<<12|FUNC_TAP<<8,FUNCTION_OPT:ACT_FUNCTION<<12,LAYER_CLEAR:ACT_LAYER<<12|OP_BIT_AND<<10,LAYER_MOMENTARY:ACT_LAYER_TAP<<12|OP_ON_OFF,LAYER_TOGGLE:ACT_LAYER<<12|OP_BIT_XOR<<10|ON_RELEASE<<8,LAYER_INVERT:ACT_LAYER<<12|OP_BIT_XOR<<10,LAYER_ON:ACT_LAYER<<12|OP_BIT_OR<<10,LAYER_OFF:ACT_LAYER<<12|OP_BIT_AND<<10,LAYER_SET:ACT_LAYER<<12|OP_BIT_SET<<10,LAYER_TAP_KEY:ACT_LAYER_TAP<<12,LAYER_MODS:ACT_LAYER_TAP<<12|224,LAYER_TAP_TOGGLE:ACT_LAYER_TAP<<12|OP_TAP_TOGGLE,LAYER_ON_OFF:ACT_LAYER_TAP<<12|OP_ON_OFF,LAYER_OFF_ON:ACT_LAYER_TAP<<12|OP_OFF_ON,LAYER_SET_CLEAR:ACT_LAYER_TAP<<12|OP_SET_CLEAR,LAYER_BIT_AND:ACT_LAYER<<12|OP_BIT_AND<<10,LAYER_BIT_OR:ACT_LAYER<<12|OP_BIT_OR<<10,LAYER_BIT_XOR:ACT_LAYER<<12|OP_BIT_XOR<<10,LAYER_BIT_SET:ACT_LAYER<<12|OP_BIT_SET<<10,DEFAULT_LAYER_SET:ACT_LAYER<<12|OP_BIT_SET<<10|ON_SPECIAL_USE<<8,UNKNOWN:0};$(function(){$("#kind_dropdown").change(function(e){var a=new Array(0,0,0);switch(a[0]="kind",$("#kind_dropdown-btn").attr("value")){case"KEY":a[1]="keycodes";break;case"MODS_KEY":a[1]="keycodes",a[2]="key_mods";break;case"MODS_TAP_KEY":a[1]="keycodes4tap",a[2]="key_mods";break;case"MODS_ONESHOT":case"MODS_TAP_TOGGLE":a[1]="key_mods";break;case"LAYER_MOMENTARY":case"LAYER_ON_OFF":case"LAYER_OFF_ON":case"LAYER_SET_CLEAR":case"LAYER_TAP_TOGGLE":a[1]="layer";break;case"LAYER_TAP_KEY":a[1]="keycodes4tap",a[2]="layer_tap";break;case"LAYER_MODS":a[1]="layer",a[2]="layer_mods";break;case"LAYER_INVERT":case"LAYER_ON":case"LAYER_OFF":case"LAYER_SET":a[1]="layer",a[2]="layer_on";break;case"LAYER_TOGGLE":a[1]="layer";break;case"LAYER_CLEAR":a[1]="layer_on";break;case"DEFAULT_LAYER_SET":a[1]="layer";break;case"LAUNCH_SHORTCUT":a[1]="launch_shortcut"}$("#fn-set").find("[id$=_dropdown-btn]").each(function(){for(var e=0,o=0;o<3;o++)if(this.id==a[o]+"_dropdown-btn"){$(this).addClass("showf").removeClass("hidef hidden"),e=1;break}if(!e){$(this).addClass("hidef").removeClass("showf");var s=$(this);setTimeout(function(){s.addClass("hidden")},300)}})})}),$(function(){$("#display-layout-info").click(function(){if(0==$("#keyboard-outline").find(".keycap-length").length){var e=0,a=0;$("#keyboard-outline").find(".key:visible").each(function(){var o=$(this).parents().parents().parents().attr("class"),s=o.match(/.*? w(\d+).*?/),t=o.match(/.*? h(\d+).*?/);if(!o.match(/.*?round.*?/)){e++;var n=0;if(1.5==(s=s?s[1]/100:t?t[1]/100:1)&&t&&200==t[1]&&(s+="/2",n=2),$(this).attr("length",s+"u"),s>=2&&s<=2.75?n=2:s>=3&&(n=s),n>0){var d=n+("zh_sc"==language?"u 卫星轴":"u stabilizer");$(this).attr("stabilizer",d)}var i=$(this);setTimeout(function(){i.attr("length")&&i.removeClass("fade-in-down fade-in-up").addClass("fade-out-down")},15*e),setTimeout(function(){a++;var o=i.attr("length"),s=("<br>"+i.attr("stabilizer")).replace(/<br>undefined/,"");o&&(i.removeClass("fade-out-down").addClass("fade-in-down"),i.html('<span class="keycap-length">{0}</span>{1}'.format(o,s)),i.removeAttr("length stabilizer")),$("#this_layout_keys").text(a),a==e&&setTimeout(function(){$("#keyboard-outline").find(".homing").find(".key").removeClass("fade-in-down fade-in-up")},15)},15*e+200)}}),$("#layout-info-pane").css("display","").removeClass("hidef").addClass("showf")}else $("#layer_set").tabs("select","layer_0")})}),String.prototype.format=function(){for(var e=this,a=0;a<arguments.length;a++){var o=new RegExp("\\{"+a+"\\}","gi");e=e.replace(o,arguments[a])}return e};