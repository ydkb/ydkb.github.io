function update_indicator(e,a){if(e<8){indicator[e]=a,keymaps[2][0][0]=indicator[0]|indicator[1]<<8,keymaps[3][0][0]=indicator[2]|indicator[3]<<8,keymaps[4][0][0]=indicator[4]|indicator[5]<<8,keymaps[5][0][0]=indicator[6]|indicator[7]<<8;var t=$(`#indicator_dropdown_menu li[value=${indicator[e]}]`);t&&$("#indicator_dropdown-btn_"+e).text(t.text()).attr({"data-tooltip":t.attr("data-tooltip"),value:indicator[e]});var o=$("#indicator_dropdown-name_"+e).text()+" : "+$("#indicator_dropdown-btn_"+e).text();$("#keyboard-outline").find(".kbd-led.led"+e).attr("data-tooltip",o)}else{for(var s=new Array,n=0;n<4;n++){var i=keymaps[n+2][0][0];s[2*n]=255&i,s[2*n+1]=i>>8}for(n=0;n<8;n++)update_indicator(n,s[n])}7==e&&console.log(keymaps[2][0][0].toString(16),keymaps[3][0][0].toString(16),keymaps[4][0][0].toString(16),keymaps[5][0][0].toString(16))}function update_indicator_color(e,a){if(console.log("Set LED"+e+": #"+a),e<8){if("block"==$("#indicator-color-btn_"+e).css("display")){indicator_color[e]=a;var t=parseInt(a.substr(0,2),16),o=parseInt(a.substr(2,2),16),s=parseInt(a.substr(4,2),16);keymaps[e][0][1]=t|o<<8,keymaps[e][0][2]=65280&keymaps[e][0][2]|s,$("#indicator-color-btn_"+e)[0].jscolor.fromString(a),$("#indicator-color-btn_"+e).attr("value",a),$("#mykbd").find(".kbd-led.led"+e).each((function(){$(this).css("background-color","#"+a);var e=M.Tooltip.getInstance(this);e&&$(e.tooltipEl).find(".aug")[0].style.setProperty("--aug-border-bg","#"+a)})),$("#keyboard-ledmap").find("#indicator_dropdown-btn_"+e).each((function(){var e=M.Tooltip.getInstance(this);e&&$(e.tooltipEl).find(".aug")[0].style.setProperty("--aug-border-bg","#"+a)}))}}else for(var n=0;n<8;n++){var i=(255&keymaps[n][0][1])<<16|65280&keymaps[n][0][1]|255&keymaps[n][0][2];update_indicator_color(n,i=("000000"+i.toString(16)).substr(-6))}}function update_keycap_color(e){$.cookie?null==e&&$.cookie("ck_keycap_color")?e=$.cookie("ck_keycap_color").match(/#(.{6})/g):e&&6==e.length&&$.cookie("ck_keycap_color",e,{expires:365,path:"/"}):null==e&&now_keycap_color&&(e=now_keycap_color),null==e&&(e=["#575d5e","#e3d9c6","#ed6b21","#575d5e","#575d5e","#ed6b21"]),6==e.length&&(document.documentElement.style.setProperty("--color-mykeycap1",e[0]),document.documentElement.style.setProperty("--bgcolor-mykeycap1",e[1]),document.documentElement.style.setProperty("--color-mykeycap2",e[2]),document.documentElement.style.setProperty("--bgcolor-mykeycap2",e[3]),document.documentElement.style.setProperty("--color-mykeycap3",e[4]),document.documentElement.style.setProperty("--bgcolor-mykeycap3",e[5]),now_keycap_color=e,$("#keycap_color-user").find('[onchange^="update_keycap_color_single("]').each((function(){var a=$(this).attr("onchange").slice(27,28),t=e[a].slice(1,7);$(this)[0].jscolor.fromString(t),$(this).attr("value",t)})),$(".border .top").css("background-color","transparent"),$(".border .top").css("background-color",""))}function update_keycap_color_single(e,a){console.log("set color "+e+" to "+a),console.log(now_keycap_color),now_keycap_color[e]="#"+a,update_keycap_color(now_keycap_color),$("#user-keycap-colors").val(now_keycap_color)}function update_case_color(e){e&&6==e.length&&(e="#"+e),$.cookie?null==e?e=$.cookie("ck_case_color"):$.cookie("ck_case_color",e,{expires:365,path:"/"}):now_case_color&&(e=now_case_color),e&&($("#case_color_css").remove(),$(`<style id="case_color_css" type="text/css">.mycase{background-color: ${e}!important}</style>`).appendTo("head"),now_case_color=e)}function update_plate_color_user(e){6==e.length&&(e="#"+e,$("#plate_color_css").remove(),$(`<style id="plate_color_css" type="text/css">.plate{background-color: ${e}!important}</style>`).appendTo("head"),now_case_color=e)}function jsdef_init(){$(".jsdef").each((function(){var e=$(this).attr("class"),a=e.match(/(.*?)ml-(\d+)(.*?)/),t=e.match(/(.*?)pl-(\d+)(.*?)/),o=e.match(/(.*?)ht-(\d+)(.*?)/),s=e.match(/(.*?)wd-(\d+)(.*?)/),n=e.match(/(.*?)lh-(\d+)(.*?)/);a&&$(this).css({"margin-left":a[2]+"px"}),t&&$(this).css({"padding-left":t[2]+"px"}),o&&$(this).css({height:o[2]+"px"}),s&&$(this).css({width:s[2]+"px"}),n&&$(this).css({"line-height":n[2]+"px"})}))}function tooltip_init(){$(".tooltipped").tooltip({delay:50}),update_indicator_color(10)}function update_logo_desc(){var e=$("#firmware-dropdown-btn").attr("value"),a=$("#firmware-dropdown").find(`[value=${e}]`).attr("data-tooltip");$("#logo_desc").text(a)}function short_keycap_name(e,a,t,o,s){return e.match(new RegExp(t,"i"))&&$(`.key.k${a}:visible`).each((function(){$(this).parents(".border")[0].offsetWidth<=54*o&&(e=e.replace(new RegExp(t,"i"),s))})),e}function display_label(e,a){var t=new Action(e),o=new Action(255&e),s={name:t.name,desc:t.desc};if(e>49151&&e<65536){var n=$(`[kc="0x${e.toString(16)}"]`);n.length>0?(s.name=n.html(),s.desc=n.attr("title")):62464==(62718&e)?((s=display_label(64511&e,a)).name+="<sub>F4</sub>","zh_cn"==NOW_LANG?s.desc+=",<br>如果和<kt>左Alt</kt>一起时则执行<kt>Alt+F4</kt>":s.desc+="<br>If combined with <kt>LAlt</kt>, execute <kt>Alt+F4</kt>"):console4jslang&&(s.name="u"+e.toString(16))}if(e>=18176&&e<18432){var i=("0"+(255&e).toString(16)).slice(-2);s.name=`SC${i}`,s.desc=`Launch shortcut ${i}`}return s.name=short_keycap_name(s.name,a,"backspace",1.6,"BS"),$("#keycap_style_gmk.nowdsa")[0]&&(o.name_dsa?s.name=" "+t.name_dsa:s.name=s.name.slice(0,3).match(/<i/g)?s.name:s.name.toUpperCase()),kc_alpha(e)||kc_numpad(e)?s.name=` <span class="bigfont">${s.name}</span>`:(kc_symbol(e)||kc_function(e))&&(s.name=` <span class="midfont">${s.name}</span>`),is_mac&&(s.name=keylabel_mac(s.name),s.desc=keylabel_mac(s.desc),s.name=short_keycap_name(s.name,a,"option",1,"opt"),s.name=short_keycap_name(s.name,a,"control",1,"ctrl"),kc_numpad(e)&&(s.name=` <i class="bigfont">${s.name.replace(/<br>.*/g,"")}</i>`)),$(`.key.k${a}:visible`).each((function(){$(this).closest(".encoder").length>0&&(s.name=s.name.replaceAll("<br>",""))})),"en"==NOW_LANG&&(s.desc=window.jslang.translate(s.desc,"en")),s}function kbd_name_filter(e){var a=e.toLowerCase();$("#firmware-dropdown").find("li:not(.optgroup)").each((function(e){$(this).css("display",($(this).text()+$(this).attr("data-tooltip")).toLowerCase().includes(a)?"block":"none")}))}function user_keycap_colors(e){console.log(e)}function gernerate_kbd_list(e,a,t){return`<li value="${e}" class="tooltipped tip_kbdlist" lang-id="kbdlist-${e}"  data-position="right" deta-delay="80" data-tooltip="${a}" lang="zh_sc"> <a lang="zh_sc">${t}<i class="material-icons fav-kbd" lang-id="kbdlist-fav" title="fav or not">favorite_border</i>`}function fav_kbd_list_refresh(){$.cookie&&($("#fav-kbd-list").find(".tooltipped").each((function(){var e=M.Tooltip.getInstance(this);e&&e.destroy(),$(this).remove()})),$("#firmware-dropdown").find(".myfav").each((function(){var e=$(this).parent().parent().attr("value");$("#fav-kbd-list").append(gernerate_kbd_list(e,CONFIG.kbd[e].desc,CONFIG.kbd[e].name)),$("#fav-kbd-list").find(`[value=${e}]`).each((function(){if($(this).find(".fav-kbd").addClass("myfav").text("favorite"),!M.Tooltip.getInstance(this))M.Tooltip.init(this)}))})))}function process_html_page(){for(var e in add_some_css_to_head(),update_copyright(),$("#fn-set").find("a").each((function(){if(this.id.match(/_dropdown-btn/)){var e=this.id.replace("-btn","");$(this).addClass("col dropdown-trigger btn-flat select tooltipped uicolor").attr({"data-target":e,"data-tooltip":$(this).text()}),$(this).next("ul").addClass("dropdown-content")}})),$(".waves-effect").addClass("waves-light"),CONFIG.kbd)e.match(/optgroup.*/)?$("#firmware-dropdown").append(`<li class="disabled optgroup uicolor-text"><span>${CONFIG.kbd[e].name}`):e.match(/.*hidden/)||$("#firmware-dropdown").append(gernerate_kbd_list(e,CONFIG.kbd[e].desc,CONFIG.kbd[e].name));if($.cookie&&$.cookie("fav_list")){var a=$.cookie("fav_list").split(" ");for(let e of a)e&&$("#firmware-dropdown").find(`[value=${e}]`).find(".fav-kbd").addClass("myfav").text("favorite")}fav_kbd_list_refresh();for(let e=0;e<8;e++)$("#ledmap-setting").append(`<div>                 <a id="indicator_dropdown-name_${e}" class="col mykeycap2" lang="zh_sc">LED${e}:</a>                 <a id="indicator_dropdown-btn_${e}" class='col dropdown-trigger btn select uicolor' data-target='indicator_dropdown_menu'>选择功能</a>                 <input id="indicator-color-btn_${e}" class="col btn jscolor" type="show"  onchange="update_indicator_color(${e},''+this.jscolor)" value="ff0000"> </div>`);for(let e=1;e<5;e++)e<4?$("#keycap_color-user-setting").append(`<div><a class="col mykeycap${e} key-flat" title="Keycaps1" lang="zh_sc">Main</a></div>                     <div><a lang="zh_sc">文字颜色</a><input class="col btn jscolor" type="show"  onchange="update_keycap_color_single(${2*(e-1)},''+this.jscolor)" value="ffffff"></div>                     <div><a lang="zh_sc">键帽颜色</a><input class="col btn jscolor" type="show"  onchange="update_keycap_color_single(${2*(e-1)+1},''+this.jscolor)" value="ffffff"></div>`):$("#keycap_color-user-setting").append('<div><a class="col mycase key-flat" style="padding: 6px" title="Keycaps3" lang="zh_sc"><span class="plate" style="width: calc(100% - 6px);height: calc(100% - 6px);"></span></a></div>                     <div><a lang="zh_sc" class="tooltipped" data-tooltip="建设中，切换键帽样式可以恢复到默认颜色">外壳颜色(dev)</a> <input class="col btn jscolor" type="show"  onchange="update_case_color(\'\'+this.jscolor)" value="ffffff"> </div>                     <div><a lang="zh_sc" class="tooltipped" data-tooltip="建设中，刷新页面可以恢复到默认颜色">定位板(dev)</a> <input class="col btn jscolor" type="show"  onchange="update_plate_color_user(\'\'+this.jscolor)" value="ffffff"> </div>');jscolor.installByClassName("jscolor"),$("#setting-pane .keyboard-set").find("li").each((function(e){if($(this).attr("kc")){var a=[{attr:"L",class:"low"},{attr:"S",class:"s1"},{attr:"R",class:"rowstart"},{attr:"A",class:"t1a"},{attr:"T",class:"t1"},{attr:"W",class:"name_win"},{attr:"M",class:"name_mac"}];for(var t in a)null!=$(this).attr(a[t].attr)&&$(this).addClass(a[t].class).removeAttr(a[t].attr);null==$(this).attr("class")&&-1==$(this).html().indexOf("<br>")&&$(this).addClass("t1"),$(this).addClass("key-set").attr("lang","zh_sc")}})),$("#setting-pane").find(".keys-category").attr("lang","zh_sc"),$("#indicator_dropdown_menu").find("li").attr("lang","zh_sc").addClass("tooltipped").attr("data-position","right").find("a").attr("lang","zh_sc"),$("#fn-set").find("a").attr("lang","zh_sc"),$("#keyboard-ledmap").find(".dropdown-trigger").addClass("tooltipped").attr("data-position","right"),$("#keyboard-ledmap").find('[id^="indicator_dropdown-name_"]').addClass("tooltipped").attr("data-position","left");for(let e=1;e<16;e*=2)$("#key_mods_dropdown,#layer_mods_dropdown").append(`<li class="optgroup-option"><span><label><input type="checkbox" value="${e}"><span>${mods_codes(e).name}</span></label></span></li>`);lang_init(),$(".key-set_shift_off, .key-set_shift_on").find("li").each((function(e){var a=$(this).html().match(/(.*)\<br\>(.*)/);a&&$(this).html(`<span class="t2_s">${a[1]}</span><br><span class="t2_l">${a[2]}</span>`)}))}function first_visit(){if($.cookie&&!$.cookie("ck_select_kbd")){if(0==document.location.search.substring(1).length){var e=document.querySelector("#nav-side");M.Sidenav.getInstance(e).open()}var a=document.querySelector("#kbdinfo_tab");M.Tooltip.getInstance(a).open()}}function kc_alpha(e){return e>3&&e<30}function kc_symbol(e){return e>29&&e<40||e>44&&e<57||100==e}function kc_function(e){return e>57&&e<70||e>103&&e<116}function kc_numpad(e){return e>83&&e<100&&88!=e||176==e}CONFIG={kbd:{optgroup0:{name:"YDKB ( High-end )"},"1800mini":{name:"1800mini",fwbin:1,size:{X:16,Y:5.25,M:-24,BR:16},checksum:{value:6145,addr:65280}},"1800qaz":{desc:"1800QAZ",name:"1800QAZ",fwbin:1,size:{X:12.25,Y:4.4,M:-18,BR:6},checksum:{value:8768,addr:26368}},master98:{name:"Master98 Pro",fwbin:1,size:{X:19.5,Y:6.4,M:-18},checksum:{value:6552,addr:65280}},sairo64:{name:"Sairo64",fwbin:1,size:{X:15,Y:5,MU:-24}},taichi:{name:"TAICHI PAD",size:{X:4,Y:4,M:-24,BR:16}},x8086k:{name:"X-8086K",fwbin:1,size:{X:18.25,Y:6.25,M:-24,BR:16}},optgroup_ec:{name:"YDKB (静电容系列)"},ble660c:{name:"BLE660C",desc:"USB/BLE Controller for Leopold FC660C",firmware_url:"./config/ble660c_980c.bin",size:{X:16.5,Y:5,M:-18,BR:6},checksum:{value:6502,addr:26368}},ble980c:{name:"BLE980C",desc:"USB/BLE Controller for Leopold FC980C",firmware_url:"./config/ble660c_980c.bin",size:{X:19.5,Y:6.75,BR:6},checksum:{value:6502,addr:26368}},hhkb_ble:{name:"HHKB BLE",desc:"USB/BLE Controller for HHKB Professional / Professional 2 / Professional JP",fwbin:1,size:{X:15,Y:5,MU:-24},checksum:{value:6499,addr:26368}},eevee:{name:"Eevee Uni",desc:"基于 Eevee 静电容主控方案的通用固件，最大支持 7x16 按键。40A / 40B",fwbin:1,size:{MaskHeight:330},checksum:{value:60978,addr:26368}},eepad:{name:"EEPad",desc:"基于 Eevee 的数字小键盘。EEPad 23U/",firmware_url:"./config/eevee.bin",size:{MaskHeight:330},checksum:{value:60978,addr:26368}},ee60:{name:"EE60",desc:"基于 Eevee 主控方案，60%静电容双模单模PCB，适配部分套件如： S58m等",firmware_url:"./config/eevee.bin",size:{X:15,Y:5,MU:-24},checksum:{value:60978,addr:26368}},ee660:{name:"EE660",desc:"基于 Eevee 主控方案，可以用于替换 FC660C 的PCB",firmware_url:"./config/eevee.bin",size:{X:16.5,Y:5,M:-18,BR:6},checksum:{value:60978,addr:26368}},hfkb:{name:"HFKB",desc:"Happy Flying Keyboard. 基于 Eevee 主控方案，可用于客制化，或者替换HHKB的原装PCB",firmware_url:"./config/eevee.bin",size:{X:15,Y:5,MU:-24},checksum:{value:60978,addr:26368}},optgroup_kbdfans:{name:"KBDFans x YDKB"},boop65:{name:"Boop65",desc:"KBDFans Boop65 Keyboard",firmware_url:"./config/unicore_f1_boop65_uf2.hex",layout:"./config/layout-kbdfans_boop65.html",size:{X:16,Y:5,MU:-16,MR:-24,MD:-16,ML:-24,BR:12}},dusk67:{name:"Dusk67",desc:"KBDFans Dusk67 Keyboard",firmware_url:"./config/unicore_f1_dusk67_uf2.hex",layout:"./config/layout-kbdfans_dusk67.html",size:{X:16,Y:5,M:-24}},eden_v2:{name:"Eden v2",desc:"KBDFans Eden v2 Keyboard",firmware_url:"./config/unicore_f1_eden_v2_uf2.hex",layout:"./config/layout-kbdfans_eden_v2.html",size:{X:15,Y:5,M:-16}},kbd8xmk3:{name:"KBD8x MkIII",desc:"KBDFans KBD8x MkIII 80% Keyboard",firmware_url:"./config/unicore_f1_kbd8xmk3_uf2.hex",layout:"./config/layout-kbdfans_kbd8xmk3.html",size:{X:18.25,Y:6.25,M:-16}},kbd8xmk3_og:{name:"KBD8x MkIII OG",desc:"KBDFans KBD8x MkIII OG (CEM-1) 80% Keyboard",firmware_url:"./config/unicore_f1_kbd8xmk3_og_uf2.hex",layout:"./config/layout-kbdfans_kbd8xmk3_og.html",size:{X:18.25,Y:6.25,M:-16}},kunlun:{name:"Kunlun",desc:"for KBDFans Kunlun",size:{MaskHeight:380},checksum:{value:8547,addr:26368}},mountain:{name:"Mountain",desc:"for KBDFans Mountain",size:{MaskHeight:380},checksum:{value:8547,addr:26368}},pavlov_mx:{name:"PAVLOV_MX",desc:"KBDFans PAVLOV Keyboard",firmware_url:"./config/pavlov_mx_uf2.hex",layout:"./config/layout-kbdfans_pavlov_mx.html",size:{X:16,Y:5,M:-16}},taco75:{name:"Taco75",desc:"KBDFans Taco75 Keyboard",firmware_url:"./config/unicore_f1_taco75_uf2.hex",layout:"./config/layout-kbdfans_taco75.html",size:{X:16,Y:6.25,M:-16}},tacopad:{name:"Taco Pad",desc:"KBDFans Taco Pad",firmware_url:"./config/unicore_f1_tacopad_uf2.hex",layout:"./config/layout-kbdfans_tacopad.html",size:{X:4,Y:6.25,M:-16}},tofufa:{name:"Tofu-fa",desc:"KBDFans Tofu-fa Keyboard",firmware_url:"./config/unicore_f1_tofufa_uf2.hex",layout:"./config/layout-kbdfans_tofufa.html",size:{X:16,Y:5,M:-16}},uni88:{name:"Uni88",desc:"KBDFans Uni88",firmware_url:"./config/unicore_f1_uni88_uf2.hex",layout:"./config/layout-kbdfans_uni88.html",size:{X:18.25,Y:6.25,M:-16}},yd67ble:{name:"YD67BLE",desc:"65% USB/BLE Hotswap PCB by YANG for KBD67 Lite from KBDFans",fwbin:1,size:{X:16,Y:5,M:-18,BR:9},checksum:{value:8551,addr:26368}},optgroup_ble:{name:"YDKB (BLE系列键盘)"},aria_hidden:{name:"Aria",desc:"Layout test. 8deg rotation (not 12deg as Alice). Maybe not the final version.",firmware_url:"./config/louise.hex",size:{MaskHeight:375},checksum:{value:8513,addr:26368}},ble40:{name:"BLE40",firmware_url:"./config/ble40_blup.hex",size:{X:12,Y:4}},blup:{name:"BLUP",firmware_url:"./config/ble40_blup.hex",size:{X:12,Y:4}},cad66:{name:"CAD66",size:{X:16.5,Y:5.25,MU:-24,MR:-16,MD:-16,ML:-16}},chicory:{name:"Chicory",size:{X:12,Y:4}},d60ble_hidden:{name:"D60BLE",desc:"60% USB/BLE Hotswap PCB by YANG for D60 from KBDFans",size:{X:15,Y:5,M:-18,BR:9},checksum:{value:8545,addr:26368}},duang60:{name:"Duang60 v1",desc:"专为无钢或半钢设计的60%蓝牙双模焊接版PCB by YANG。单模版也使用此固件。",fwbin:1,size:{X:15,Y:5,MU:-24},checksum:{value:8288,addr:26368}},duang60_v2:{name:"Duang60 v2",desc:"Duang60的热插拔版本，适配某些特定键盘如： Falcon / Fly60 / Rama Kara / S58m等",fwbin:1,size:{X:15,Y:5,MU:-24},checksum:{value:8546,addr:26368}},fmini:{name:"Fmini",desc:"一个类似Kmini布局的PCB by YANG",size:{X:18.5,Y:5,MU:-32,MR:-16,MD:-16,ML:-16,BR:6}},hello_v1_hidden:{name:"Hello_v1",desc:"Hello Keyborad v1，支持多个键盘，包括HHKB改装，MX轴，ALPS轴等",size:{X:15,Y:5,MU:-24,MR:-18,MD:-18,ML:-18},checksum:{value:8556,addr:26368}},just60:{name:"Just60",desc:"60%蓝牙双模机械键盘 by YANG",firmware_url:"./config/just60_yd60ble.hex",size:{X:15,Y:5,MU:-24},checksum:{value:6496,addr:26368}},just66:{name:"Just66",desc:"USB/BLE 双模多配列PCB，仅v1.x支持CA66外壳。珈蓝PCJR的双模默认是此PCB。",firmware_url:"./config/just68.bin",size:{X:16.5,Y:5.25,MU:-24,MR:-16,MD:-16,ML:-16},checksum:{value:6502,addr:26368}},just660:{name:"Just660",desc:"USB/BLE 双模多配列PCB for Leopold FC660M",firmware_url:"./config/just68.bin",size:{X:16.5,Y:5,M:-18,BR:6}},just68:{name:"Just68 v1",desc:"USB/BLE 双模多配列键盘（兼容Tada68外壳和小门牙），焊接版",fwbin:1,size:{X:16,Y:5}},just68v2:{name:"Just68 v2",desc:"USB/BLE 双模热插拔键盘，仅支持单空格和单配列，可带一个滚轮编码器",fwbin:1,size:{X:16,Y:5},checksum:{value:8552,addr:26368}},louise:{name:"Louise",desc:"40% version of Alice, 适配外壳有 Curva40 / Reel40",fwbin:1,size:{MaskHeight:320},checksum:{value:8513,addr:26368}},minira:{name:"Minira v1",desc:"60%蓝牙双模机械键盘 配列同Filco Minila",size:{X:15,Y:5,MU:-24}},minira_v2:{name:"Minira v2",desc:"支持双旋钮，60%蓝牙双模机械键盘，支持Minira配列和64配列，单模版也使用此固件。",fwbin:1,size:{X:15,Y:5,MU:-24},checksum:{value:8544,addr:26368}},pearly:{name:"Pearly v1",desc:"40%蓝牙双模机械键盘PCB, v1焊接版兼容AQ40和Pearl外壳。",fwbin:1,size:{X:13,Y:4,M:-24},checksum:{value:8256,addr:26368}},pearly_v2:{name:"Pearly v2",desc:"40%蓝牙双模机械键盘PCB，v2热插拔版，有12列和13列两种PCB，PISA外壳使用。",fwbin:1,size:{X:13,Y:4,M:-20,BR:10},checksum:{value:8770,addr:26368}},taiga40:{name:"Taiga40",desc:"40%蓝牙双模机械键盘热插拔PCB，适配外壳 xx",fwbin:1,size:{MaskHeight:320},checksum:{value:8771,addr:26368}},test_hidden:{name:"Test",desc:"40%蓝牙双模机械键盘，暂测试用途",firmware_url:"./config/louise.hex",size:{X:13,Y:4,M:-16,BR:10},checksum:{value:8771,addr:26368}},xikii104:{name:"Xikii i104",desc:"大爽全尺寸键盘",fwbin:1,size:{X:23,Y:7,EY:-1.4,MU:-70,MR:-40,MD:-54,ML:-40,BR:18},checksum:{value:8608,addr:26368}},xikii_6x:{name:"Xikii i6x",desc:"小爽键盘",fwbin:1,size:{X:16.5,Y:5,MU:-70,MR:-32,MD:-32,ML:-32,BR:12},checksum:{value:8550,addr:26368}},xikii_8x:{name:"Xikii i8x",desc:"中爽键盘",fwbin:1,size:{X:18.5,Y:7,EY:-.5,MU:-70,MR:-40,MD:-54,ML:-40,BR:18},checksum:{value:8576,addr:26368}},yd60ble:{name:"YD60BLE",desc:"60%蓝牙双模机械键盘 by YANG",firmware_url:"./config/just60_yd60ble.hex",size:{X:15,Y:5,MU:-24}},yd81_hidden:{name:"YD81",desc:"Get more than 80%. 支持有线蓝牙双模",firmware_url:"./config/yd81.hex",layout:"./config/layout-yd81.html"},ydp50:{name:"YDP50",desc:"USB/BLE双模50% 无线键盘 by YANG",size:{X:12,Y:5}},ydpm40ble:{name:"YDPM40BLE",desc:"YDPM40 双模版",size:{X:12,Y:4}},optgroup3:{name:"YDKB (其他键盘)"},akb48:{name:"AKB48",desc:"Atreus Keyboard 48 by YANG",size:{MaskHeight:320}},cod67:{name:"COD67",desc:"COD67 PCB by YANG",size:{MaskHeight:370}},ergoplus_hidden:{name:"ErgoPlus",desc:"An ErgoDox layout keyboard with full RGB and hotswap",firmware_url:"./config/ergodone.hex",layout:"./config/layout-ergoplus.html"},eswn:{name:"ESWN"},hskb:{name:"HSKB",desc:"HSKB原型机一，分体有线带屏幕键盘",size:{X:16,Y:5,MU:-78,MR:-18,MD:-18,ML:-18}},ns60:{name:"NS60",desc:"60%蓝牙双模机械键盘，同时支持上下灯位",size:{X:15,Y:5,MU:-24}},sasuke01:{name:"Sasuke No.01",desc:"佐助(辅佐助手)小键盘。此键盘目前更建议使用vial的固件(vial.ydkb.io有提供)",fwbin:1,size:{MaskHeight:210},checksum:{value:8464,addr:26368}},simpo40:{name:"Simpo40",desc:"40% Keyboard.",firmware_url:"./config/simpo_uf2.hex",size:{X:12,Y:4}},simpo66:{name:"Simpo66",desc:"单模有线版PCB，支持CA66旧版外壳。珈蓝PCJR的单模默认是此PCB",firmware_url:"./config/simpo_uf2.hex",size:{X:16.5,Y:5.25,MU:-24,MR:-16,MD:-16,ML:-16}},simpo68:{name:"Simpo68",desc:"65% Keyboard. Just68的单模有线版本",firmware_url:"./config/simpo_uf2.hex",size:{X:16,Y:5}},stm60:{name:"STM60",desc:"60% Keyboard that uses STM32F103",size:{X:15,Y:5,MU:-24},firmware_url:"./config/stm60_uf2.hex"},stm60c:{name:"STM60.C",desc:"60% Keyboard that uses STM32F103",firmware_url:"./config/stm60_uf2.hex",size:{X:15,Y:5,MU:-24}},thx30:{name:"THX30",size:{X:10,Y:3}},unicore_f1:{name:"UniCore-F1",desc:"UniCore-F1 DevBoard",firmware_url:"./config/unicore_f1_uf2.hex",size:{MaskHeight:330}},uukb:{name:"UUKB",desc:"USB/优联 双模键盘",firmware_url:"./config/uukb_uf2.hex"},yd68:{name:"YD68",desc:"YD68双空格键盘，v2为单空格但支持蓝牙双模",size:{X:16,Y:5}},ydkb_u2u:{name:"YDKB优联",desc:"YDKB的优联键盘集合",size:{MaskHeight:310}},ydp60:{name:"YDP60",desc:"YDP60",size:{X:15,Y:5,MU:-24}},ydpm40:{name:"YDPM40",desc:"YDP40 双空格类Planck and YDM40 by YANG",size:{X:12,Y:4}},yxpad:{name:"YXPAD",size:{X:4,Y:6}},optgroup4:{name:"YDKB Mod"},apple_adb:{name:"Apple_ADB",desc:"Apple ADB Keyboard to USB",size:{MaskHeight:416}},ble980m:{name:"BLE980M",desc:"Leopold FC980M USB/蓝牙4.0双模改装",fwbin:1,size:{MaskHeight:451}},filco104:{name:"FILCO104",desc:"FILCO104 YDKB Conroller",size:{MaskHeight:416}},yd3000c_hidden:{name:"YD3000c",desc:"G80-3000系列的转换器，支持多种自定义功能，G80-3494支持USB下全键无冲",size:{MaskHeight:540}},optgroup5:{name:"K.T.E.C."},chili:{name:"Chili3000",desc:"K.T.E.C.成员 !#&*^$)~$#`^(%#$Gacathon 作品，G80-3000外壳可用PCB",firmware_url:"./config/lm_chili.hex",layout:"./config/layout-lm_chili.html",size:{X:23,Y:7,EY:-1.4,MU:-70,MR:-40,MD:-54,ML:-40,BR:18}},cw40:{name:"CW40",desc:"K.T.E.C.出品，国外设计，国内制造",size:{X:12,Y:4}},daisy:{name:"Daisy",desc:"K.T.E.C.出品，国外设计，国内制造",size:{X:12,Y:4}},ergodone:{name:"Ergodone",desc:"K.T.E.C.出品，国外设计，国内制造",size:{MaskHeight:460}},grape:{name:"Grape11900",desc:"K.T.E.C.成员 !#&*^$)~$#`^(%#$Gacathon 作品，G80-11900/11800外壳可用PCB",firmware_url:"./config/lm_grape.hex",layout:"./config/layout-lm_grape.html",size:{X:20,Y:8,EY:-1.6,MU:-48,MR:-48,MD:-60,ML:-48,BR:18}},leechee:{name:"Leechee1800",desc:"K.T.E.C.成员 !#&*^$)~$#`^(%#$Gacathon 作品，G80-1800外壳可用PCB",firmware_url:"./config/lm_leechee.hex",layout:"./config/layout-lm_leechee.html",size:{X:19.5,Y:7,EY:-1.5,MU:-54,MR:-40,MD:-54,ML:-40,BR:18}},staryu:{name:"Staryu",desc:"K.T.E.C.出品，国外设计，国内制造",size:{X:3,Y:2}},optgroup6:{name:"Others(第三方)"},ca66:{name:"CA66",desc:"CA66有线版，适用于2020年之前的有线版CA66。2020及之后的，使用若遇软件或硬件问题，自行解决。",size:{MaskHeight:480}},diyer72:{name:"Diyer72",desc:"YDKB's firmware for Diyer72 / Xikii72 Keyboard",size:{MaskHeight:385.5}},exe_hidden:{name:"EXE",desc:"E神作品，国内客制化先驱"},gh60:{name:"GH60_ABC",desc:"该固件主要给添加了UART2BT蓝牙模块的使用， 完整支持XD60v2，其他ABC版本自测。",size:{X:15,Y:5,MU:-24}},hw75:{name:"瀚文75(HW75)",desc:"稚晖君 & Xikii 瀚文(Hello Word) 75% 尺寸开源键盘。本站固件由YANG@YDKB提供第三方友情支持。",firmware_url:"./config/hw75_uf2.hex",size:{MaskHeight:440,X:16.5,Y:6.5,M:-16}},u2u_pro:{name:"U2U PRO",desc:"USB2USB Converter with AT90USB1286. 此固件自2020年3月后不再更新。",size:{MaskHeight:440}},udock:{name:"UDock",desc:"UDock by Yock and Bobnaive. 此固件自2020年3月后不再更新。",size:{MaskHeight:514}}}},KEYCAP_COLORS=[{name:"Hana",value:["#a598c5","#efefea"],case_color:"#ebc3f0"},{name:"HHKB",value:["#222222","#eae6e7","#cbcdda"],order:[0,1,0,2,0,2]},{name:"RF 10th",value:["#222222","#989793","#6688aa"],order:[0,1,0,2,0,2],case_color:"#333333"},{name:"Raindrop",value:["#0073a2","#e5e4df"]},{name:"Carbon",value:["#575d5e","#e3d9c6","#ed6b21"],order:[0,1,2,0,0,2],case_color:"#424848"},{name:"Honeywell",value:["#212224","#efefea","#575757","#b01c11"],order:[0,1,1,2,1,3]},{name:"Hyperfuse",value:["#6c3b7b","#c4c4c0","#5dceba","#63696a"],order:[0,1,2,3,2,3]},{name:"Granite",value:["#525554","#e6e8e3","#222222","#a0a4a7"],order:[0,1,2,3,2,3]},{name:"Jukebox",value:["#a51b1b","#d9c9a8","#69d0a5"],order:[0,1,0,2,1,0]},{name:"Valentine",value:["#dc90bc","#efefea"],case_color:"#eaa0ca"},{name:"EVA 01",value:["#93c247","#592254"]},{name:"Pulse",value:["#00a6b4","#212224"]},{name:"Royal Navy",value:["#2f3d6f","#f0f0f0","#a92f0d"],order:[0,1,1,0,1,2]},{name:"Dolch",value:["#e4dedd","#5f5c52","#333430","#00a4a9"],order:[0,1,0,2,0,3]},{name:"Classic Olivetti",value:["#0965ed","#f5f5f5","#cfcdc2"],order:[0,1,0,2,1,0]},{name:"Lime",value:["#93c247","#e5e4df","#7c878e"],order:[0,1,1,2,1,0]},{name:"Eve",value:["#333333","#d4d0c7","#2785db"],order:[0,1,2,0,1,2]},{name:"Godspeed",value:["#666666","#d3cdc1","#6a94b1","#f9eb74"],order:[0,1,1,2,0,3]},{name:"Bentō",value:["#487992","#fff4f0","#f8767e"],order:[0,1,2,0,1,2]},{name:"Jamón",value:["#f2ebd7","#8c303a","#b2343c","#424446"],order:[0,1,0,2,3,0]},{name:"White on Black",value:["#efefea","#222222"],order:[0,1,0,1,0,1]},{name:"βeta",value:["#333333","#dcd6c4","#727473","#dd7632"],order:[0,1,0,2,0,3]},{name:"DMG",value:["#1d1770","#d1cdca","#7f8389","#722158"],order:[0,1,0,2,1,3]},{name:"Shiko",value:["#7a99ac","#dde5ed","#a1d1ee"],order:[0,1,1,0,1,2]},{name:"Olivia++",value:["#222222","#e1dbd1","#373634","#e0b19f"],order:[0,1,3,2,0,3]},{name:"Olivia dark",value:["#e0b19f","#222222"],order:[0,1,0,1,1,0]},{name:"Oblivion",value:["#dedeca","#6b7273","#474946","#297fa9"],order:[0,1,0,2,0,3]},{name:"Oblivion W",value:["#dedeca","#e7e8e5","#474946","#297fa9"],order:[2,1,0,2,0,3]},{name:"Symbiosis",value:["#e5e4df","#747b7b","#0073a2","#ffac00"],order:[0,1,0,2,2,3],case_color:"c4d0d0"},{name:"Posh Blue",value:["#222d5a","#e1dbd1","#d8a0a6"],order:[0,1,2,0,0,2]},{name:"Posh Pink",value:["#222d5a","#e1dbd1","#d8a0a6"],order:[0,1,0,2,2,0]},{name:"Pitta",value:["#333333","#eee6d3","#ccc0a6","#3cdcc6"],order:[0,1,0,2,0,3]}],UI_THEME=[{name:"默认主题",color:"#0288d1"},{name:"红色主题",color:"#e57373"},{name:"粉色主题",color:"#f06292"},{name:"紫色主题",color:"#7e57c2"},{name:"青色主题",color:"#00acc1"},{name:"绿色主题",color:"#4caf50"},{name:"暗黑模式",color:"#242424"}],$((function(){is_mac=navigator.platform.includes("Mac"),new_than_231223_mods_key_mouse_vol=0;var e,a,t,o=!0,s=0,n="1800mini",i=Array(256).fill(0),d=0,r=255,c="gmk";now_keycap_color=[],iscasejscolor=0,layouts_save="",is_dev=0,is_xikiicom=0;var l=0,_="",m=Array.from(transparent_map());indicator=Array(8).fill(0),indicator_color=Array(8).fill(0);var u=document.location.search.substring(1),f=u.match(/(.*)-(\d+)/);f?(variant=f[1],layouts_save=f[2]):variant=u,lang_pre_action();var p=0,h=url_decode_keymap(document.location.hash.substring(1).replace(/YDKB/g,"+"));function y(e){var a=CONFIG.kbd[e];if(a){$("#firmware-dropdown-btn").html(`<i class="material-icons fl">keyboard</i>${a.name}`).attr({value:e}),$("#logo_name, #kbdinfo_tab_name").text(a.name),update_logo_desc(),a.layout||(a.layout=`./config/layout-${e}.html`),a.firmware_url||(a.fwbin?a.firmware_url=`./config/${e}.bin`:a.firmware_url=`./config/${e}.hex`),$("#keyboard-outline").css("display",""),$("#keyboard-ledmap").css("display","none"),$("#firmware-dropdown").find("li.uicolor").removeClass("uicolor"),$("#firmware-dropdown").find(`[value=${e}]`).addClass("uicolor"),$("#layouts-set-div, #layouts-set-on2").hide(),$("#layouts-set-on").addClass("scale-out");var t=a.size;if(t){var o=t.M?t.M:t.MU?t.MU:-12,s=t.M?t.M:t.MD?t.MD:-12,n=54*t.Y-o-s+24;t.EY&&(n+=54*t.EY),t.MaskHeight&&(n=t.MaskHeight),$("#keyboard-outline").html(`<div class="keyboard-mask page-wd" style="height: ${n}px;"></div><div style="height:${n-30}px;"</div>`);var i=54*t.Y/128,d=n/2-30,r=640;t.MaskHeight&&(r=640-1/(i=(t.MaskHeight-60)/128)*64),$("#loading").css({top:d+"px",left:r+"px",transform:`scale(${i})`}),$("#loading").show()}H(a.layout)}}function k(){$("#keyboard-outline").css("display","none"),$("#keyboard-ledmap").css("display","block"),$("#keyboard-outline").find(".key").empty(),X(0)}null!=h&&(keymaps=h,p=1),window.onfocus=function(){},window.onblur=function(){$("#tabs-main").find(".keydown").removeClass("keydown"),l=0},$("#kbd-name-filter").bind("input propertychange",(function(){kbd_name_filter($(this).val())})),$("#user-keycap-colors").bind("input propertychange",(function(){user_keycap_colors($(this).val())})),$("#key-set-tabs").on("click","li a",(function(){var e=$(this).attr("href");"#tabs-kbdinfo"==e?(X(0),$("#keyboard-outline").find(".keyboard-mask").removeClass("hidef"),$("#keyboard-outline").find(".bl-key").css("z-index","12").find(".plate").css("background","red")):($("#keyboard-outline").find(".keyboard-mask").addClass("fade-out"),setTimeout((function(){$("#keyboard-outline").find(".keyboard-mask").removeClass("fade-out").addClass("hidef")}),50),$("#keyboard-outline").find(".bl-key").css("z-index","").find(".plate").css("background","")),e.match(/#tabs-readme|#tabs-kbdinfo|#tabs-keycap/g)?($("#fn-set-row").hide(),$("#keycode_tabs").css("height","397px")):($("#fn-set-row").show(),$("#keycode_tabs").css("height","336px")),$("#key-set-tabs .indicator").html($(this)[0].innerHTML)})),$("#firmware-dropdown").on("click","li",(function(){var e=$(":hover");if(0==e[e.length-1].outerHTML.indexOf("<a ")){var a=$(this).attr("value");CONFIG.kbd[a]&&n!=a&&(n=a,layouts_save="",y(n),$.cookie&&$.cookie("ck_select_kbd",n,{expires:365,path:"/"}))}else if(e[e.length-1].outerHTML.includes("fav-kbd")&&$.cookie){var t=$.cookie("fav_list"),o=$(this).attr("value"),s=o+" ";if(t.length<2&&(t=""),$(this).find(".fav-kbd").hasClass("myfav")){$("#firmware-dropdown").find(`[value=${o}]`).find(".fav-kbd").each((function(){0==$(this).closest("#fav-kbd-list").length&&$(this).removeClass("myfav").text("favorite_border")}));var i=new RegExp(s,"g");t=t.replace(i,"").replace(/undefined/g,"").replace(/  /g,"")}else $(this).find(".fav-kbd").addClass("myfav").text("favorite"),t+=s;fav_kbd_list_refresh(),$.cookie("fav_list",t,{expires:365,path:"/"})}})),$("#layouts-set-border, #keycap_color-userset-border").drags(),$("#layouts-set-on, #layouts-set-off, #layouts-set-on2").click((function(){fadeToggle($("#layouts-set-border")[0])})),$("#keycap_color-userset-on, #keycap_color-userset-off").click((function(){fadeToggle($("#keycap_color-userset-border")[0])})),$("input.jscolor, textarea.not_drag").on("mousemove",(function(e){$(this).addClass("no_drag")})),$("input.jscolor, textarea.not_drag").on("mouseout",(function(e){$(this).removeClass("no_drag")})),$(document).ready((function(){for(var e of(process_html_page(),$(".sidenav").sidenav(),$(".collapsible").collapsible(),$(".modal").modal(),$(".dropdown-trigger").dropdown({coverTrigger:!1}),$("#keymap-load-dropdown-btn, #download-share-dropdown-btn").dropdown({constrainWidth:!1,coverTrigger:!1}),$("#fn-set .dropdown-trigger").dropdown({closeOnClick:!1}),$(".fixed-action-btn.toolbar").floatingActionButton({toolbarEnabled:!0}),$(".fixed-action-btn.tips").floatingActionButton({hoverEnabled:!1,direction:"right"}),$(".fixed-action-btn.tips").find(".scale-transition").removeClass("scale-out"),KEYCAP_COLORS)){e.order||(e.order=[0,1,1,0,1,0]);for(var a=new Array(0,0,0,0,0,0),t=0;t<6;t++)a[t]=e.value[e.order[t]];var o="";function s(e,a,t,o){return`<li class="key-color key-${e}" style="color:${a}; background:${t}">${o}</li>`}e.case_color&&(o=`case-color="${e.case_color}"`),$("#keycap-color-list").append(`<div class="keycap-color-block" ${o}>`+s("main",a[0],a[1],"key")+s("enter",a[4],a[5],"enter")+s("mod",a[2],a[3],e.name)+"</div>")}for(let n of UI_THEME)$("#ui-theme").append(`<li style="color:#fefefe; background-color:${n.color};"><a lang="zh_sc">${n.name}`);fetch("./common/case_list.txt").then(checkResponse).then(parseTEXT).then((function(e){let a=e.split("\n");a.pop();for(let e of a)$("#mycase-style ul").append(`<li style="background-image: url(./common/case/${e}"><a>`)})),jsdef_init(),Q(is_mac),D(0),J(),update_keycap_color(),Z(),update_case_color(),V(),$("#setting-pane").show(),$(".tabs").tabs()})),$(".fixed-action-btn.tips").on("mousedown","ul li",(function(e){o=$(this).children().hasClass("green"),$("#layer_set").tabs("select","layer_0")})),$(".fixed-action-btn.tips").on("click",".tip_redt",(function(e){e.shiftKey&e.altKey&&$("#layoutFile").trigger("click")})),$("#keycap-color-list").on("click",".keycap-color-block",(function(){now_keycap_color[0]=$(this).find(".key-main").css("color"),now_keycap_color[1]=$(this).find(".key-main").css("background"),now_keycap_color[2]=$(this).find(".key-mod").css("color"),now_keycap_color[3]=$(this).find(".key-mod").css("background"),now_keycap_color[4]=$(this).find(".key-enter").css("color"),now_keycap_color[5]=$(this).find(".key-enter").css("background");for(var e=0;e<6;e++){var t=now_keycap_color[e].match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)/);t&&(now_keycap_color[e]=`#${hex8(t[1])}${hex8(t[2])}${hex8(t[3])}`)}update_keycap_color(now_keycap_color),iscasejscolor||(a=now_keycap_color[1],$(this).attr("case-color")&&(a=$(this).attr("case-color")),$.cookie&&$.cookie("ck_case_color",a,{expires:365,path:"/"}),update_case_color(a))})),$("#casejscolor-toggle").click((function(){iscasejscolor=$(this).prop("checked"),$("#casejscolor-btn")[0].type=iscasejscolor?"show":"hidden"})),$("#ui-theme").on("click","li",(function(){J($(this).css("background-color"))})),led_setting=20,$("#ledmap-setting").on("click",'[id^="indicator_dropdown-btn_"]',(function(){led_setting=this.id.replace("indicator_dropdown-btn_","");$("#indicator_dropdown_menu").find("li").show();for(let a of[{class_name:"can_disable",led_action_id:255},{class_name:"conn_mode",led_action_id:22},{class_name:"io_bt",led_action_id:20},{class_name:"io_ws2812",led_action_id:30}]){var e=$("#kb_ledmap-"+led_setting).hasClass(a.class_name)?"block":"none";$("#indicator_dropdown_menu").find(`[value=${a.led_action_id}]`).css({display:e})}$("#kb_ledmap-"+led_setting).hasClass("disable_only")?$("#indicator_dropdown_menu").find("li").each((function(){$(this).attr("value")>=254?$(this).show():$(this).hide()})):$("#indicator_dropdown_menu").find("[value=254]").hide();var a=M.Dropdown.getInstance(document.getElementById(this.id));a.close(),a.open()})),$("[id^='indicator_dropdown_']").on("click","li",(function(){update_indicator(led_setting,this.value)})),$("[id^='layouts-']").on("click","[class^='layouts-']",(function(){var e=this.id.match(/layouts-(\d)(\d)/);if($("#kblayouts-00").length>0){for(var a=0;a<$("div[id^='kblayouts-"+e[1]+"']").length;a++)$("#keyboard-outline").find(".akblayouts-"+e[1]+a).hide(),$("#keyboard-outline").find("[layout="+e[1]+a+"]").hide(),$("#kblayouts-"+e[1]+a).hide();$("#keyboard-outline").find(".akblayouts-"+e[1]+e[2]).each((function(){$(this).show()})),$("#keyboard-outline").find("[layout="+e[1]+e[2]+"]").show(),$("#kblayouts-"+e[1]+e[2]).show()}var t=layouts_save.match(/(\d)/g);layouts_save="",$("div[id^='kblayouts-']").each((function(){if("block"==$(this).css("display")){var e=this.id.match(/kblayouts-(\d)(\d)/),a=e[1],o=e[2];t[a]=o}}));for(a=0;a<t.length;a++)layouts_save+=t[a];keymaps[1][0][0]="1"+layouts_save>>16,keymaps[0][0][0]="1"+layouts_save&65535,$("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),b()})),$("#mykeycap_change li a").click((function(){Z(c=$(this).attr("value"))})),$("#lock_shift").click((function(){let e=$(this).hasClass("fa-unlock");$(this).toggleClass("fa-unlock",!e).toggleClass("fa-lock",e),$('#tabs-main [kc="225"').toggleClass("shift_locked",e),$(".key-set_shift_on").css("display",e?"block":"none"),$(".key-set_shift_off").css("display",e?"none":"block")})),$("#mykeycap_system_change").click((function(){is_mac^=1,Q(is_mac)})),$("#case-style-set").click((function(){$(".sidenav").sideNav("show")})),$("#mycase-style ul").on("click","li",(function(){V($(this).css("background-image"))})),$(".layer").click((function(e,a){$("#keyboard-outline").css("display",""),$("#keyboard-ledmap").css("display","none");var t=parseInt($(this).attr("id").match(/layer-(\d+)/)[1]),o=t<d?"up":"down";d=t,$("#layer_set .indicator").text($(this).text().toUpperCase()),$("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),$("#keyboard-outline").find(".key").each((function(){$(this).removeClass("fade-in-down fade-in-up").addClass(`fade-out-${o}`).removeAttr("length stabilizer")})),setTimeout((function(){$("#keyboard-outline").find(".key").each((function(){$(this).removeClass("fade-out-down fade-out-up").addClass(`fade-in-${o}`)})),setTimeout((function(){$("#keyboard-outline").find(".key").removeClass("fade-in-down fade-in-up")}),400),b(keymaps[t])}),350),$("#keymap-layer-clear").hasClass("recovery")&&$("#keymap-layer-clear").removeClass("recovery").text("清空当前层设置")})),$("#ledmap-tab").click((function(e,a){$("#layer_set .indicator").text($(this).text().toUpperCase()),k()})),$("#keyboard-outline").on("click",".kbd-led",(function(e){var a=$(this).attr("class").match(/.*led(\d).*/);a&&a[1]<8&&(k(),$("#layer_set").tabs("select","ledmap_tab"))}));var b=function(e){for(var a in null==e&&(e=keymaps[d]),$("#this_layout_keys").text("0"),$("#layout-info-pane").hasClass("showf")&&$("#layout-info-pane").removeClass("showf").addClass("hidef"),e)for(var t in e[a]){var o=e[a][t],s=parseInt(a).toString(32)+parseInt(t).toString(32),n=display_label(o,s);$(".key.k"+s).each((function(){$(this).html(n.name).attr("data-tooltip",n.desc),S($(this)[0],o)}))}},v=0;$("#keyboard-outline").on("mouseover mouseout",".key",(function(e){var a=$(this).attr("class").match(/k([0-9a-v][0-9a-v])/i),t=parseInt("0x"+a[1]);if(128!=t){var s=$(":hover"),n=keymaps[d][t>>4][15&t];"mouseover"==e.type&&(n>255||0==n)&&s[s.length-1].classList.contains("key")?o&&0==v&&(v=t,play_sound("sound/key_hover.wav")):"mouseout"==e.type&&0==s.hasClass("key")&&(v=0)}})),$("#keyboard-outline").on("mouseover mouseout","[class^=mykeycap]",(function(e){var a=$(this).find(".key"),t=a.attr("class").match(/k([0-9a-v][0-9a-v])/i),s=parseInt("0x"+t[1]);if(128!=s){var n=keymaps[d][s>>4][15&s];"mouseover"==e.type&&(n>255||n<2)?(o||$("#keyfunction-display").html(a.attr("data-tooltip").replace("<br>","")).removeClass("hidef"),e.altKey&&($("#keyfunction-display")[0].innerHTML+=`  Code:0x${n.toString(16).toUpperCase()}`)):"mouseout"==e.type&&$("#keyfunction-display").addClass("hidef")}})),$("#keycode_tabs").on("mouseover mouseout",".key-set",(function(e){var a=$(this),t=a.attr("kc");"mouseover"==e.type&&(t>255||t<2)?$("#keyfunction-display").html(a.attr("title")).removeClass("hidef"):"mouseout"==e.type&&$("#keyfunction-display").addClass("hidef")})),$("#layer_set").on("mouseover mouseout",".layer",(function(e){var a=parseInt($(this).attr("id").match(/layer-(\d+)/)[1]);a!=d&&"gmk"==c&&(r=a,"mouseover"==e.type?(e.shiftKey&&($("#layer_set").find(".bottom").removeClass("bottom"),$(this).addClass("bottom")),$("#keyboard-outline").find(".key:visible").each((function(){var e,t=this.className.match(/k([0-9a-v])([0-9a-v])/i);t[1]<8&&(e=keymaps[a][parseInt(t[1],32)][parseInt(t[2],32)]);var o=display_label(e,t[0]);if(o.name=o.name.replace(/fs(\d+)/g,"fs10").replace(/midfont/g,"bottomfont").replace(/bigfont/g,"bottomfont").replace(/<br>/g," ").replace("font-size","nofont").replace('<div style="height:15px"></div>',""),$(this).find(".bottom_content").remove(),0==$(this).closest(".encoder").length){var s=this.title;$(this).append(`<span class="bottom_content">${o.name}`),$(this).attr("title",s)}}))):"mouseout"==e.type&&(e.shiftKey?(console.log("keep layer "+a),$("#layer_set").find(".layer").each((function(){console.log(this.id),this.id=="layer-"+a?$(this).addClass("bottom"):$(this).removeClass("bottom")}))):(r=255,$("#keyboard-outline").find(".bottom_content").remove(),$("#layer_set").find(".bottom").removeClass("bottom"))))})),$("#layouts-set").on("mouseover mouseout","label span",(function(e){var a=$(this).attr("for");console.log(a);var t=$("#keyboard-outline").find(`#kb${a}, [layout=${a.slice(-2)}]`);t&&("mouseover"!=e.type||$("#layouts-set").find("#"+a).prop("checked")?"mouseout"==e.type&&($("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),t.find("[class^=mykeycap]").each((function(e){$(this).css("z-index","")})),t.css("z-index",""),$("#layouts-set").find("#"+a).prop("checked")||t.hide()):($("#keyboard-outline").find(".keyboard-mask").removeClass("hidef"),t.show(),t.find("[class^=mykeycap]").each((function(e){$(this).css("z-index","12")})),t.css("z-index","12")))})),$("#keycode_tabs").on("click",".key-set",(function(a,t){var o=parseInt($(this).attr("kc"));if(l&&o<152&&(o|=(15&l)<<8),4==l&&61440==(61694&o)&&o>=61696&&(o|=l<<8),D(o),o<=255&&($("#tabs-main").find(`[id=code-${o}]`).each((function(e){$(this).removeClass("keydown")})),o>=224&&o<=229&&(l&=~(1<<o-224))),e){ani_fly_button(o,{top:a.pageY,left:a.pageX}),L(o)}else{var s=lang_from_json("select_key_first");M.toast({html:s,classes:"rounded",displayLength:"1000"})}}));var g,w=0,A=0,E=0;document.addEventListener("keydown",(function(a){var t=a.keyCode,o=keyCode2tmkCode(256*a.location+t);if(o<256&&0==i[o])i[o]=1;else if(!w)return;230==o&&(w&&(A=1),15!=l&&23!=l||(w=1));if(A)o>=224&&o<=229&&(l|=1<<o-224),a.returnValue=!1;else if(console.log(`KeyDN:js keycode: 0x${(256*a.location+t).toString(16)}. Key:${[tmkCode2keyName(o)]}`),$("#tabs-main").find(`[kc=${o}]`).each((function(e){$(this).addClass("keydown")})),o>=224&&o<=229?(l|=1<<o-224,g=$(".key-editing")[0],console.log(g)):g=null,$(":hover").length>4&&"keyboard-outline"==$(":hover")[4].id||$(":hover").length>5&&"tabs-main"==$(":hover")[5].id){if(a.returnValue=!1,!e)return;if((o<224||o>=228)&&!l)ani_fly_button(o,getElementAbsPos($("#tabs-main").find(".keydown")[0])),L(o)}}));var T=0;document.addEventListener("keyup",(function(a){var t=a.keyCode,o=keyCode2tmkCode(256*a.location+t);o<256&&(i[o]=0);var s=l;if(230==o&&A){A=0,l=0;var n,d,r,c=parseInt(E/4);if(n=parseInt(c/128),d=parseInt(c/16)%8,r=c%16,0==E&&(U=[no_map(),no_map(),no_map(),no_map(),no_map(),no_map(),no_map(),no_map()]),E%4==0?5==s?(E+=3,U[n][d][r]=1):6==s?(E++,U[n][d][r]=0):U[n][d][r]|=s:E%4==1?U[n][d][r]|=s<<2:E%4==2?6==s?p++:U[n][d][r]|=s<<8:E%4==3&&(U[n][d][r]|=s<<10),E%4==3){var _=("0000000000000000"+U[n][d][r].toString(2)).slice(-16),m=("0"+parseInt(E/40.95)).slice(-2);$("#keyfunction-display").removeClass("hidef").html(`接收完成前请勿操作电脑，接收按键设置 <span style='font-family:"Consolas", Sans-serif'> ${m}%  KEY[${n}][${d}][${("0"+r).slice(-2)}]: ${_}</span>`),$("#tabs-main").find(".keydown").removeClass("keydown")}4096==++E&&($("#keyfunction-display").html("接收按键完成"),$("#keyfunction-display").addClass("hidef"),E=0,w=0,I(),b()),a.returnValue=!1}else if(0==E){var u;if(console.log(`KeyUP:js keycode: 0x${(256*a.location+t).toString(16)}. Key:${tmkCode2keyName(o)}`),$("#tabs-main").find(`[kc=${o}]`).each((function(e){u=$(this),$(this).removeClass("keydown")})),o>=224&&o<=229&&(l&=~(1<<o-224)),$(":hover").length>4&&"keyboard-outline"==$(":hover")[4].id||$(":hover").length>5&&"tabs-main"==$(":hover")[5].id){if(a.returnValue=!1,!e)return;0==T&&g==$(".key-editing")[0]&&0==l&&(70==o||o>=224)&&(ani_fly_button(o,getElementAbsPos(u[0])),L(o));for(var f=0,p=0;p<8;p++)l&1<<p&&f++;if(console.log(`mods_num:${f}, code: ${o}`),f>0&&(T=f),s&&o<224){var h=l<<8|o;ani_fly_button(h,getElementAbsPos(u[0])),L(h),T=h}else 0==f&&(T=0)}}})),document.oncontextmenu=function(e){var a=$(":hover");if(e.altKey&&a.length>6)for(var t=6;t<a.length-1;t++){var o=a[t].className.match(/mykeycap(\d)/);if(o){var s=$('[class="'+a[t].className+'"]'),n=parseInt(o[1])+1;return n>3&&(n=1),s.removeClass(o[0]).addClass("mykeycap"+n),!1}}if(a.length>8&&"kind_dropdown"==a[a.length-3].id){var i=a[a.length-2].dataset.helplink;return window.open("help/#/"+i,"_blank"),!1}};var C=function(a){var t=e.match(/k([0-9a-v])([0-9a-v])/i);if(!t)throw"invalid id";return{row:parseInt(t[1],32),col:parseInt(t[2],32)}},L=function(a){var t=$("#keyboard-outline").find(".key-editing");if(t.length>0&&e){l&&a>=2&&a<=255&&(a|=l<<8);var o=C(e),s=parseInt(o.row).toString(32)+parseInt(o.col).toString(32);keymaps[d][o.row][o.col]=a,!0;new Action(a);var n=display_label(a,s),i=n.name,c=n.desc;if(r<8&&r!=d){var _=display_label(keymaps[r][o.row][o.col],s);_.name=_.name.replace(/fs(\d+)/g,"fs10").replace(/midfont/g,"bottomfont").replace(/bigfont/g,"bottomfont").replace(/<br>/g," ").replace("font-size","nofont").replace('<div style="height:15px"></div>',""),i+=`<span class="bottom_content">${_.name}`}$("."+e).each((function(){var e=$(this);e.removeClass("fade-in-down fade-in-up").addClass("fade-out-down"),setTimeout((function(){e.removeClass("fade-out-down fade-out-up").addClass("fade-in-down").html(i),setTimeout((function(){e.removeClass("fade-in-down fade-in-up")}),350)}),300)})),$("."+e).attr("data-tooltip",c);var m=t.find(".key");m&&S(m[0],a),$("."+e).focus();for(var u=$("#keyboard-outline").find(".key-editing"),f="";"keyboard-outline"!=u.attr("id")&&(u.nextAll().each((function(){if((f=$(this).is("[class^=mykeycap]:visible")?$(this):$(this).find("[class^=mykeycap]:visible").first()).length>0)return!1})),!(f.length>0));)u=u.parent();0==f.length&&(f=0),setTimeout((function(){X(f)}),300)}};function S(e,a){var t=M.Tooltip.getInstance(e),s=e.parentElement.parentElement.parentElement,n=s.classList.contains("round"),i=s.classList.contains("square"),d=s.dataset.usertip;if((n||i||d||100==a||a>255||0==a)&&o){if(n){let a="";a=lang_from_json(`encoder_round${e.parentElement.parentElement.parentElement.className.match(/(.sw|.ccw|.cw)/g)[0]}`),e.dataset.tooltip=a+e.dataset.tooltip}if(i){let a="";a=lang_from_json(`encoder_square${e.parentElement.parentElement.parentElement.className.match(/(.sw|.upward|.dnward)/g)[0]}`),e.dataset.tooltip=a+e.dataset.tooltip}if(d&&(e.dataset.tooltip=d+e.dataset.tooltip),null==t)t=M.Tooltip.init(e)}else t&&t.destroy()}function O(e){var a;if(keycodes[e]&&!(e>255))return e<101?(a=keycodes[e].desc,e<2&&(a=keycodes[e].id)):a=e>=168&&e<192||e>=240?keycodes[e].id:keycodes[e].name,is_mac&&keycodes[e].name_mac&&(a=keycodes[e].name_mac),a}for(var P in $("#advanced-mode-toggle").click((function(){$("#advanced-mode-layer").css("display",$(this).prop("checked")?"block":"none")})),$("#keymap-layer-copy").click((function(){for(var e=0;e<8;e++)for(var a=0;a<16;a++)m[e][a]=keymaps[d][e][a];$("#copied-layer_1, #copied-layer_2").text(d)})),$("#keymap-layer-paste").click((function(){keymaps[d]=Array.from(m),b()})),$("#keymap-layer-clear").click((function(){$(this).hasClass("recovery")?($(this).removeClass("recovery").text("清空当前层设置"),keymaps[d]=Array.from(m)):($(this).addClass("recovery").text("恢复当前层设置"),m=Array.from(keymaps[d]),keymaps[d]=Array.from(transparent_map())),b()})),$("#keymap-layer-exchange").click((function(){var e,a=$("#copied-layer_1").text();e=keymaps[d],keymaps[d]=keymaps[a],keymaps[a]=e,b()})),$("#preset-keymap-list, #keyboard-outline").on("click","li",(function(){var e=$("#keyboard-outline").find("#kb-preset_keymap").find("[id^='kb-preset_keymap-"+this.value+"']"),a=url_decode_keymap(e.attr("value-keymap").replace(/YDKB/g,"+"));null!=a&&(U=a,console.log(U));var t=e.attr("value-layout");t&&G(_=unzip(t)),I(),b()})),$(".editor_dropdown").hide(),action_kinds){var N="LAUNCH_SHORTCUT"==action_kinds[P].id?action_kinds[P].link:"edit-keymap/"+action_kinds[P].link;$("#kind_dropdown").append(`<li value="${action_kinds[P].id}" class="tooltipped" data-tooltip="${action_kinds[P].desc}" data-position="right" data-helplink="${N}" lang="zh_sc"> <a lang="zh_sc"> ${action_kinds[P].name}`)}for(var x in $("#kind_dropdown").find('[value^="OPT_GROUP"]').addClass("disabled optgroup uicolor-text").removeClass("tooltipped"),$("#kind_dropdown").find('[value="UNKNOWN"]').addClass("hide"),keycodes)2!=x&&3!=x&&x<255&&($("#keycodes_dropdown").append(W(x,keycodes[x].desc,O(x))),(x<224||x>=240)&&$("#keycodes4tap_dropdown").append(W(x,keycodes[x].desc,O(x))));for(var R=0;R<8;R++)$("#layer_dropdown").append(W(R,"Layer "+R,"Layer "+R));for(R=0;R<24;R++){let e=R%8;R<8?$("#layer_tap_dropdown").append(W(R,`Layer ${e}`,`Layer ${e}`)):R<16?$("#layer_tap_dropdown").append(W(R,`Layer ${e}(S)`,`Layer ${e}(S)`)):R>16&&$("#layer_tap_dropdown").append(W(R,`Layer ${e}(P)`,`Layer ${e}(P)`))}for(R=0;R<100;R++){var Y=("0"+R).slice(-2);$("#launch_shortcut_dropdown").append(W("0x47"+Y,"Launch Shortcut "+Y,"Shortcut "+Y))}var D=function(e){var a=new Action(e),t=(new Action(255&e),$("#kind_dropdown").find("[value="+a.id+"]").text());$("#kind_dropdown-btn").html(t).attr({value:a.id}),$("#fn-set").find("ul li").removeClass("uicolor").removeAttr("style"),$("#kind_dropdown").find("[value="+a.id+"]").addClass("uicolor"),$("#kind_dropdown").trigger("change");var o=O(e);e>255&&e<53248&&(o=O(255&e)),$("#keycodes_dropdown-btn").html(o).attr({value:a.key_code}),$("#keycodes_dropdown").find("[value="+a.key_code+"]").addClass("uicolor"),(255&e)<176&&($("#keycodes4tap_dropdown-btn").html(o).attr({value:a.key_code}),$("#keycodes4tap_dropdown").find("[value="+a.key_code+"]").addClass("uicolor"));var s=a.id&&a.id.match(/(.*?)MOD(.*?)/)?mods_codes(e>>8&31).name:"";$("#key_mods_dropdown-btn").html(s).attr({value:a.key_mods});for(var n=0;n<5;n++){var i=1<<n;$("#key_mods_dropdown").find("[value="+i+"]").prop("checked",a.key_mods&i)}$("#key_mods_dropdown").find("[value=0]").prop("checked",a.key_mods<16),$("#key_mods_dropdown").find("[value=0x10]").prop("checked",a.key_mods>16);var d="",r=0;$("#key_mods_dropdown input:checked").each((function(e,a){r|=$(this).val(),$(this).val()>0&&$(this).val()<16&&(d+=(r<16?"":"r")+$(this).parent().text()+"+")})),d.length>2&&$("#key_mods_dropdown-btn").html(d.slice(0,-1));var c=a.layer_tap_val<16?a.layer_tap_val:0;if("LAYER_TOGGLE"==a.id||"DEFAULT_LAYER_SET"==a.id){for(var l=15&e;l>>1;l>>=1)c++;c+=4*((224&e)>>5)}"LAYER_TOGGLE"==a.id?c-=10:"DEFAULT_LAYER_SET"==a.id&&(c-=12),$("#layer_dropdown-btn").html("Layer "+c).attr({value:c}),$("#layer_dropdown").find("[value="+c+"]").addClass("uicolor"),c<8?$("#layer_tap_dropdown-btn").html("Layer "+c).attr({value:c}):$("#layer_tap_dropdown-btn").html("Layer "+(c-8)+"(S)").attr({value:c}),$("#layer_tap_dropdown").find("[value="+c+"]").addClass("uicolor"),$("#layer_mods_dropdown-btn").html(s).attr({value:63&a.layer_tap_code});for(n=0;n<5;n++){i=1<<n;$("#layer_mods_dropdown").find("[value="+i+"]").prop("checked",15&a.layer_tap_code&i)}$("#layer_mods_dropdown").find("[value=0x20]").prop("checked",32&a.layer_tap_code),$("#layer_mods_dropdown").find("[value=0x10]").prop("checked",16&a.layer_tap_code),d="",r=0,$("#layer_mods_dropdown input:checked").each((function(e,a){$(this).val()>0&&$(this).val()<16&&(d+=$(this).parent().text()+"+")})),16&a.layer_tap_code&&(d="r"+d),d.length>2&&$("#layer_mods_dropdown-btn").html(d.slice(0,-1)),$("#layer_on_dropdown-btn").html("Layer "+a.layer_bitop_op).attr({value:a.layer_bitop_op}),$.cookie("uicolor")&&$("#fn-set").find("ul li.uicolor").css({"background-color":$.cookie("uicolor")})};$("[id$=dropdown-btn]").on("click",(function(){var e=this.id.replace("-btn","");$("[id$=dropdown]").hide(),$("#"+e).show()})),$("#fn-set").find("[id$=_dropdown]").on("click","li",(function(){var e=$(this).offsetParent().attr("id"),a=$(this).attr("value");$("#fn-set").find("#"+e+"-btn").text($(this).text()).attr({value:a}),$("#"+e).find("li").removeClass("uicolor").removeAttr("style"),$("#"+e).find("[value="+a+"]").addClass("uicolor"),$.cookie("uicolor")&&$("#fn-set #"+e).find("[value="+a+"]").css({"background-color":$.cookie("uicolor")}),$("#kind_dropdown").trigger("change");var t=$("#"+e+"-btn");t&&-1==e.indexOf("_mods_")&&M.Dropdown.getInstance(t[0]).close();if("key_mods_dropdown"==e||"layer_mods_dropdown"==e){var o=0,s="";$(this).find("input[type=checkbox]").prop("checked",!$(this).find("input[type=checkbox]").prop("checked")),$("#"+e+" input:checked").each((function(a,t){o|=$(this).val(),"key_mods_dropdown"==e?$(this).val()>0&&$(this).val()<16&&(s+=(o<16?"":"r")+$(this).parent().text()+"+"):o>16&&32!=o&&(s+=(o<32?"r":"")+$(this).parent().text()+"+")})),$("#fn-set").find("#"+e+"-btn").text(s.slice(0,-1)).attr({value:o})}})),$("#fn-set").find("button.action-apply").click((function(a){if(e){var t=action_editor_get_code();ani_fly_button(t,getElementAbsPos($(this)[0])),L(t)}}));var F=[],B=[],U=[];function K(e){var a=e.slice(-3);return fetch(e).then(checkResponse).then((function(e){var t=e.headers.get("Last-Modified"),o=format_date(new Date(t));return $("#latest_firmware_date, #latest_firmware_date_short").hide(),$("#latest_firmware_date").text(o.long),"hex"==a?e.text():e.arrayBuffer()})).then((function(e){var t,o=bin_split_firmware("hex"==a?convert_hex2bin(e,0,0):new Uint8Array(e),KEYMAP_START_ADDRESS,KEYMAP_SIZE);(console.log("firmware lines: "+o),F=o.before,B=o.after,!p&&$("#kb-preset_keymap-0").length>0)?(console.log("load keymap0"),null!=(t=url_decode_keymap($("#kb-preset_keymap-0").attr("value-keymap").replace(/YDKB/g,"+")))&&(U=t)):(U=p?keymaps:o.keymaps,I());console4jslang&&!p&&$("#yang_keymap").length>0&&(null!=(t=url_decode_keymap($("#yang_keymap").attr("value-keymap").replace(/YDKB/g,"+")))&&(U=t),$("#yang_keymap").remove());var s=0;if(new_than_231223_mods_key_mouse_vol=0,0!=o.date){var n={};n.short="D"+shorten_date(o.date[0])+shorten_date(o.date[1])+shorten_date(o.date[2]),n.long="20"+o.date[0]+"-"+o.date[1]+"-"+o.date[2]+$("#latest_firmware_date").text().slice(10),$("#latest_firmware_date").text(n.long),$("#latest_firmware_date_short").text(n.short),console.log(o.date),o.date[3]>=230928&&(s=1),o.date[3]>=231223&&(new_than_231223_mods_key_mouse_vol=1)}else $("#latest_firmware_date").text("2020"),$("#latest_firmware_date_short").text("2020");return $("#latest_firmware_date, #latest_firmware_date_short").show(),s?($("#kind_dropdown").find('[value="MODS_TAP_KFT"]').show(),$("#layer_mods_dropdown").find("#select-rmods").show()):($("#kind_dropdown").find('[value="MODS_TAP_KFT"]').hide(),$("#layer_mods_dropdown").find("#select-rmods").hide()),new_than_231223_mods_key_mouse_vol?$(".fw_after_231223").show():$(".fw_after_231223").hide(),e})).catch((function(e){console.log("request failed",e)}))}$("#firmwareFile").change((function(e){var a=e.target.files[0];if(a){var t=new FileReader;t.onloadend=function(e){var t=a.name.toLowerCase(),o=this.result,s=0;if(t.match(/.hex/g))o=convert_hex2bin(this.result,0,0);else if(t.match(/.uf2/g)){var i=uf2_to_bin(this.result);o=i.binstr,s=i.bin_start_addr}else t.match(/.bin/g)&&"hw75"==n&&(s=16384);var d=bin_split_firmware(o,KEYMAP_START_ADDRESS,KEYMAP_SIZE,s);if(31744==o.length&&(d=bin_split_firmware(o,29696,KEYMAP_SIZE,s)),U=d.keymaps,console.log("firmware_keymaps:"+U),"udock"==n||"unicore_f1"==n){var r=d.after;if(r.length>0&&205==r[0]){for(var c=r[1]|r[2]<<8,l="",m=0;m<c;m++)l+=String.fromCharCode(r[m+3]);G(_=unzip(l))}}$("#keymap-load").prop("disabled",!1),$("#keymap-load-div").show(),I(),b()},t.readAsBinaryString(a),$("#firmwareFile").val("")}else $("#keymap-load").prop("disabled",!0)})),$("#keymap-load").prop("disabled",!0),$("#keymap-load").click((function(e,a){I()}));var I=function(){for(keymaps=$.extend(!0,[],U);keymaps.length<KEYMAP_LAYERS;)keymaps.push(transparent_map());var e=""+parseInt(keymaps[1][0][0]<<16|keymaps[0][0][0]);if(console.log(parseInt(s)+1+" layouts:"+e),"1"==e.slice(0,1)&&e.length-2==s){var a=e.slice(1).match(/(\d)/g);0==layouts_save&&(layouts_save=e.slice(1));for(var t=0;t<s+1;t++){for(var o=0;o<$(`div[id^='kblayouts-${t}`).length+1;o++)$(`#kblayouts-${t}${o}`).hide(),$(`#layouts-${t}${o}`).prop({checked:"false"}),$("#keyboard-outline").find(`.akblayouts-${t}${o}`).hide(),$("#keyboard-outline").find(`[layout=${t}${o}]`).hide();$(`#kblayouts-${t}${a[t]}`).show(),$(`#layouts-${t}${a[t]}`).prop({checked:"checked"}),$("#keyboard-outline").find(`.akblayouts-${t}${a[t]}`).show(),$("#keyboard-outline").find(`[layout=${t}${a[t]}]`).show()}}update_indicator(10),update_indicator_color(10)};function G(e){var a=$("#keyboard-outline")[0].offsetHeight;$("#kbd-layout").empty(),$("#kbd-layout").append(e),q(),b(),tooltip_init();var t=$("#keyboard-outline")[0].offsetHeight,o=$("#keyboard-outline").find(".keyboard-mask");o.css("height",parseInt(o.css("height"))+t-a+"px")}$("#keyboard-outline").on("change","#layoutFile",(function(e,a){var t=e.target.files[0];if(t){var o=new FileReader;o.onloadend=function(e){if(t.name.match(/.html/g)){if(!this.result.match(/(mykeycap|\[mc.*)/))return void alert(lang_from_json("not a layout file"));G(_=this.result)}},o.readAsBinaryString(t),$("#layoutFile").val("")}})),$("#hex-download").prop("disabled",!0),$("#hex-download, #bin-download, #uf2-download").click((function(e,a){$("#firmwareFile")[0].files[0]&&$("#firmwareFile")[0].files[0].name.match(/\.hex/)&&console.log("hex file");var t,o=".hex";if("uf2-download"==this.id){var s=[].concat(F).concat(hex_keymaps(KEYMAP_START_ADDRESS)),i=convert_hex2bin(s,16384,KEYMAP_START_ADDRESS+KEYMAP_SIZE);console.log(i);var d=1591873650,r=$("#kbd-firmware");r.attr("value-family-id")&&(d=parseInt(r.attr("value-family-id"),16)),console.log("0x"+d.toString(16));var c=bin_to_uf2(i,134234112,d);if("unicore_f1"==n&&_.length>0){var l=zip(_);console.log("layout: "+l);var m=new Uint8Array(3+l.length);console.log("save layout file "+_.length+" to "+l.length),m[0]=205,m[1]=255&l.length,m[2]=l.length>>8;for(var u=0;u<l.length;u++)m[3+u]=l[u].charCodeAt();layout_file_content=bin_to_uf2(m,134283264,d),c=new Uint8Array([...c,...layout_file_content])}t=new Blob([c],{type:"application/octet-stream"}),console.log(c),o=".uf2"}else if("bin-download"==this.id){s=[].concat(F).concat(hex_keymaps(KEYMAP_START_ADDRESS));var f=0;if("1800mini"!=n&&"master98"!=n&&"sairo64"!=n&&"x8086k"!=n&&"u2u_pro"!=n&&"udock"!=n||(f=57344),-1!=n.indexOf("hw75"))i=convert_hex2bin(s,16384,KEYMAP_START_ADDRESS+KEYMAP_SIZE+f);else i=convert_hex2bin(s,0,KEYMAP_START_ADDRESS+KEYMAP_SIZE+f);if(i=bin_overwrite(i),"udock"==n&&_.length>0){l=zip(_);console.log(_.length+" to "+l.length),i[65536]=205,i[65537]=255&l.length,i[65538]=l.length>>8;for(u=0;u<l.length;u++)i[65539+u]=l[u].charCodeAt()}var p=CONFIG.kbd[n].checksum;if(p){var h=0;for(R=0;R<i.length;R++){var y=i[R];word=1&R?y<<8:y,h+=word}var k=i[p.addr]|i[p.addr+1]<<8;h-=k,k=p.value-h&65535,e.shiftKey&e.altKey&&(k=0),i[p.addr]=255&k,i[p.addr+1]=k>>8}if(t=new Blob([i],{type:"application/octet-stream"}),o=".BIN",i[0]==i[1]&&i[1]==i[2])return void alert(lang_from_json("download file wrong"))}else{var b=[].concat(F).concat(hex_keymaps(KEYMAP_START_ADDRESS)).concat(B).join("\r\n").concat("\r\n").concat(":00000001FF\r\n");t=new Blob([b],{type:"application/octet-stream"})}var v=$("#kbd-firmware").attr("value-filename");null==v&&(v=n,"bin-download"==this.id&&(v=v.toUpperCase())),saveAs(t,v+o)})),$("#share-dialog-btn").click((function(){update_share_url_panel()})),$("#keymap-share, #shorten-url").click((function(e,a){var t=zip(JSON.stringify(keymaps)),o=document.location.origin+document.location.pathname+"?"+(n+($("#kblayouts-00").length>0?"-"+layouts_save:""))+"#"+t;"shorten-url"==this.id?(navigator.clipboard.writeText(t),$("#share-url").val(t),M.textareaAutoResize($("#share-url")),$("#share-dialog").removeClass("url-long"),M.toast({html:"复制成功",classes:"rounded",displayLength:"1000"})):($("#share-url").val(o),M.textareaAutoResize($("#share-url")),$("#share-dialog").addClass("url-long")),update_share_url_panel()})),$("#output-c").click((function(e,a){$("#keymap-c").text().length>0?(navigator.clipboard.writeText($("#keymap-c").text()),$("#keymap-c").text("")):(keymaps[7][0][0]=0,$("#keymap-c").text(source_output(keymaps))),M.textareaAutoResize($("#keymap-c"))})),$(window).bind("beforeunload",(function(){return"CAUTION: You will lost your change."})),$("#show-tabs-kbdinfo").click((function(e,a){$("#key-set-tabs").tabs("select","tabs-kbdinfo")}));var z=$.Deferred().resolve();CONFIG.kbd[variant]&&CONFIG.kbd[variant].firmware_url&&($("#firmware-dropdown").val(variant),z=K(CONFIG.kbd[variant].firmware_url).then((function(e){if(!document.location.hash)for(keymaps=$.extend(!0,[],U);keymaps.length<KEYMAP_LAYERS;)keymaps.push(transparent_map());$("#hex-download").prop("disabled",!1),$("#keymap-load").prop("disabled",!1)})));var H=function(e){var a=CONFIG.kbd[n].size;if(a){var t,o,s,i,d;a.M?t=o=s=i=a.M:(t=a.MU?a.MU:-12,o=a.MR?a.MR:-12,s=a.MD?a.MD:-12,i=a.ML?a.ML:-12),d=a.BR?a.BR:-i-6;var r=54*a.X-i-o,c=54*a.Y-t-s}var l=$(".keyboard-mask")[0],_=l?l.offsetHeight:0;fetch(e).then(checkResponse).then(parseTEXT).then((function(e){if($("#keyboard-outline").html(e),a&&($("#keyboard-outline").prepend(l),a.X&&a.Y)){var m=`height: ${_-30}px; width: 54px; padding: ${-t-8}px 0 0 ${640-27*a.X}px;`;$("#mykbd").attr("style",m);var u=`<div class="{0}" style="margin: ${t}px ${o}px ${s}px ${i}px; height: ${c}px; width: ${r}px; border-radius: ${d}px">`;$("#mycase").prepend(u.format("kbdbg-mask")).prepend(u.format("kbdbg-border"))}var f=$("#kbd-firmware");if(f.attr("value-keymapaddr")?KEYMAP_START_ADDRESS=parseInt(f.attr("value-keymapaddr"),16):KEYMAP_START_ADDRESS=26624,console.log("KEYMAP_ADDR: 0x"+KEYMAP_START_ADDRESS.toString(16)),K(CONFIG.kbd[n].firmware_url).then((function(e){p||(I(),$("#advanced-mode-toggle").prop("checked")&&(p=1)),$("#layer_set").tabs("select","layer_0"),$("#keyboard-outline").find(".keyboard-mask").addClass("hidef"),setTimeout((function(){$("#loading").hide()}),600),setTimeout((function(){first_visit()}),800)})),$("#tool-download").parent().show(),$("#hex-download").parent().show(),$("#bin-download").parent().hide(),$("#uf2-download").parent().hide(),f.attr("value-format")){$("#tool-download").parent().hide();var h=f.attr("value-format");console.log("Firmware format: "+h),h.match(/bin/g)&&($("#bin-download").parent().show(),console4jslang||$("#hex-download").parent().hide()),h.match(/uf2/g)&&($("#uf2-download").parent().show(),console4jslang||$("#hex-download").parent().hide()),h.match(/hex/g)&&($("#hex-download").parent().show(),$("#tool-download").parent().show())}q();var y,k=$("#kbd-info").attr("value-type");if(k){var b=$("#kbd-firmware").attr("value-filename");if(null==b){b=CONFIG.kbd[n].name;var v=$("#kbd-firmware").attr("value-filename");v&&(b=v),"lufa_msd_usb"==k&&(k="lufa_msd_ble"),"lufa_msd_ble"==k&&(b=b.toUpperCase())}var g=$("#kbd-firmware").attr("value-diskname");null==g&&(g=b),function(e,a,t){fetch("config/templates_bootloader.html").then(checkResponse).then(parseTEXT).then((function(o){var s=$(o),n=$(s).find("#"+t).html();j(n=n.replace(/BIN_NAME/g,e).replace(/DISK_NAME/g,a)),onLangChange(NOW_LANG)}))}(b,g,k)}else y=$("#kbd-info").html(),$("#kbd-info").remove(),$("#kbdinfo_detail").empty(),y?j(y):$("#kbdinfo_detail").append("暂无其他说明");$("#purchase-link").empty(),$("#purchase-link").append(`<li class="waves-effect waves-light"><a href="#!">尊重劳动成果，远离山寨。右侧为 ${CONFIG.kbd[n].name} 正规购买渠道和介绍。`);var w=$("[id^='kbd-purchase_link_']");if($(".fixed-action-btn.toolbar").find(".scale-transition").toggleClass("scale-out",0==w.length),w.each((function(e){$("#purchase-link").append(`<li class="waves-effect waves-light"><a href=${$(this).attr("value")} target="_blank">${$(this).text()}`),$(this).remove()})),$("#macrofn").empty(),$("#macrofn").hide(),$("#macrofn").html($("#kbd-macrofn").html().replace(/\(R\)/g,"<SUB> (R)</SUB>").replace(/\(L\)/g,"<SUB> (L)</SUB>")),$("#kbd-macrofn").remove(),fetch("/config/templates_led_fn.html").then(checkResponse).then(parseTEXT).then((function(e){var a=$(e),t=["#backlight_control_keys","#ble51_control_keys","#ble51_control_keys_v2","#ble51_control_keys_v3","#rgb_control_keys"];for(R in $("#rgblight-help, #backlight-help").hide(),t)$(t[R]).each((function(){var e=$(a).find(t[R]).html();$(this).html(e),"#backlight_control_keys"==t[R]&&$("#backlight-help").show(),"#rgb_control_keys"==t[R]&&$("#rgblight-help").show()}))})).then((function(e){$("#macrofn").html($("#macrofn").html().replaceAll('id="code-','kc="')),$("#macrofn").find("[kc]").addClass("key-set"),$("#macrofn").show(),onLangChange(NOW_LANG)})),$("#ledmap-tab,[id^='indicator_dropdown-'], [id^='indicator-color-']").each((function(){$(this).hide()})),$("#kb_ledmap-0").length>0&&($("#ledmap-tab").show(),$("[id^='kb_ledmap-']").each((function(){var e=this.id.replace("kb_ledmap-","");$("#indicator_dropdown-name_"+e).show().text($(this).text()).attr({"data-tooltip":$(this).attr("title")}),$("#indicator_dropdown-btn_"+e).show(),$(this).hasClass("rgb_color")&&$("#indicator-color-btn_"+e).show(),p||update_indicator(e,this.value)}))),$("#preset-keymap-group").hide(),$("#preset-keymap-list").empty(),$("#kb-preset_keymap").length>0&&($("#preset-keymap-group").show(),$("[id^='kb-preset_keymap-']").each((function(){var e=this.id.replace("kb-preset_keymap-","");$("#preset-keymap-list").append(W(e,this.title,'<i class="material-icons mr5">cloud_download</i>'+$(this).text()))}))),$("#kb-changelog-url").length>0){var A="help/#/changelog/"+$("#kb-changelog-url").attr("href");$("#latest_firmware_changelog").attr("href",A).attr("target","_blank").show()}else $("#latest_firmware_changelog").removeAttr("href target");onLangChange(NOW_LANG)})).catch((function(e){console.log("request failed",e)}))};function X(a){if(0==a)$("#keyboard-outline").find(".key-editing").removeClass("key-editing"),$("main").removeClass("editing-key"),e=null,$("#fly-button").removeClass("fly");else{if(X(0),"k80"==(e=a.find(".key")[0].classList[1]))return;a.addClass("key-editing"),$("main").addClass("editing-key"),$("[id$=dropdown]").hide();var t=C(e),o=keymaps[d][t.row][t.col];D(o)}}function j(e){$("#kbdinfo_detail").html(e),init_space($("#kbdinfo_detail")),console.log($("#kbd-info").attr("value-type")),"lufa_msd_usb"==$("#kbd-info").attr("value-type")&&$("#kbdinfo_detail").find(".for-ble").remove(),CONFIG.kbd[n].checksum?$("#kbdinfo_detail").find(".hardware2bl").remove():$("#kbdinfo_detail").find(".software2bl").remove(),$("#kbdinfo_detail").html($("#kbdinfo_detail").html().replaceAll("<hanla></hanla>"," "))}function W(e,a,t){return`<li value="${e}" title="${a}" lang="zh_sc"> <a lang="zh_sc">${t}`}function J(e){$.cookie&&(null==e?e=$.cookie("uicolor"):$.cookie("uicolor",e,{expires:365,path:"/"})),e&&(document.documentElement.style.setProperty("--uicolor",e),$("html").toggleClass("dark-mode","rgb(36, 36, 36)"==e.toString()))}function V(e){$.cookie?null==e?e=$.cookie("ck_case_style"):$.cookie("ck_case_style",e,{expires:365,path:"/"}):null==e&&t&&(e=t),e&&(document.documentElement.style.setProperty("--mycase-background-image",e),t=e)}function Z(e){if($.cookie?null==e?(e=$.cookie("ck_keycap_style"),c=e||"gmk"):$.cookie("ck_keycap_style",e,{expires:365,path:"/"}):null==e&&t&&(e=c),e&&null!=e){$("#keycap_style_gmk").remove(),$("#keycap_style_flat").remove();var a='<link id="keycap_style_flat" href="flat.css" rel="stylesheet">',o='<link id="keycap_style_gmk" href="gmk.css" rel="stylesheet">';"gmk"==e?($(a).appendTo("head"),$(o).appendTo("head")):"flat"==e?($(o).appendTo("head"),$(a).appendTo("head")):"dsa"==e&&($('<link id="keycap_style_gmk" class="nowdsa" href="gmk.css" rel="stylesheet">').prependTo("head"),$(a).prependTo("head")),b()}}function Q(e){$("#keyboard-outline").find(".key:visible").toggleClass("fade-in-down",e).toggleClass("fade-in-up",!e),setTimeout((function(){$("#keyboard-outline").find(".key").removeClass("fade-in-down fade-in-up")}),400),b();var a=e?"none":"block",t=e?"block":"none";for(var o in $("#tabs-main").find(".name_win").each((function(){$(this).css("display",a)})),$("#tabs-main").find(".name_mac").each((function(){$(this).css("display",t)})),$("#mykeycap_system_change button").removeClass("using"),e?$("#system_mac").addClass("using"):$("#system_win").addClass("using"),keycodes)keycodes[o].desc_mac&&$("#keycodes_dropdown, #keycodes4tap_dropdown").find("[value="+o+"]").attr("title",e?keycodes[o].desc_mac:keycodes[o].desc).find("a").text(O(o));$("#key_mods_dropdown, #layer_mods_dropdown").find("label").each((function(){var a=$(this).html();e?$(this).html(a.replace("Ctrl","control").replace("Alt","option").replace("Win","cmd")):$(this).html(a.replace("control","Ctrl").replace("option","Alt").replace("cmd","Win"))})),$(".key-set").each((function(e){var a=display_label(parseInt($(this).attr("kc")),0);$(this).attr({title:a.desc}),$(this).attr("key")&&$(this).html(a.name)}))}function q(){var e,a;if($("#keyboard-outline").find("ks").each((function(){var e=this.outerHTML;e=e.replaceAll(", ","</ks><ks>").replaceAll(",","</ks><ks>"),$(this).replaceWith(e)})),$("#keyboard-outline").find("ks").each((function(){var e=$(this).text().match(/.*? \[(.*)\]/),a="";e&&(a=e[1]),-1==a.indexOf("mc")&&(a="mc1 "+a),$(this).prependClass(a);var t=this.outerHTML;e&&(t=t.replace(` [${e[1]}]`,"")),t=t.replace(/^<ks/,"<div").replace(/\/ks>$/,"/div>"),$(this).replaceWith(t)})),$("#keyboard-outline .mycase").find("div").each((function(){var e=this.className.match(/.*?col(\d+).*?/);e&&$(this).css("left",e[1]/100*54+"px");var a=this.className.match(/.*?row(\d+).*?/);a&&$(this).css("top",a[1]/100*54+"px")})),$("#keyboard-outline").find("[X], [Y], .mc1, .mc2, .mc3, .mykeycap1, .mykeycap2, .mykeycap3").each((function(){if($(this).parents("svg").length)return 1;if(!$(this).hasClass("round")&&!$(this).hasClass("square")){var t=$(this).attr("X"),o=$(this).attr("Y"),s=$(this).attr("W"),n=$(this).attr("H");if(!t){var i=this.className.match(/.*?col(\d+).*?/);i&&(t=i[1]/100,$(this).removeClass(`col${i[1]}`))}if(!o){var d=this.className.match(/.*?row(\d+).*?/);d&&(o=d[1]/100,$(this).removeClass(`row${d[1]}`))}if(!s){s=1;var r=this.className.match(/.*? w(\d+).*?/);r&&(1.5==(s=r[1]/100)&&$(this).hasClass("h200")||$(this).removeClass(`w${r[1]}`))}if(!n){n=1;var c=this.className.match(/.*? h(\d+).*?/);c&&(n=c[1]/100)}t||-1==this.className.indexOf("mc")||(t=0==$(this).prev().length?0:parseFloat(e)+parseFloat(a)),null!=t&&($(this).css("left",54*t+"px"),e=t),null!=o&&$(this).css("top",54*o+"px"),null!=s&&($(this).css("width",54*s+"px").css("--width",54*s+"px"),a=s),null!=n&&$(this).css("--height",54*n+"px"),-1==this.className.indexOf("mykeycaps")&&$(this).css("position","relative")}})),$("#keyboard-outline").find(".mykeycap1, .mykeycap2, .mykeycap3, .mc1, .mc2, .mc3").each((function(){this.className=this.className.replace("mc","mykeycap");var e=$(this).find(".key");if(e.length>0&&e.attr("class").match(/k([0-9a-v][0-9a-v])/i).length>0)return!0;var a=0,t=$(this).text().toLowerCase().match(/uk([0-9a-v])([0-9a-v])/i),o=$(this).text().toLowerCase().match(/ek([0-9a-v])([0-9a-v])/i);if(t&&3==t.length)a=("0"+(8*parseInt("0x"+t[1])+parseInt(t[2])+8).toString(16)).slice(-2);else if(o&&3==o.length){a=parseInt(o[1])+1+o[2]}else a=keyName2tmkCode($(this).text().toUpperCase()).toLowerCase();var s="";$(this).css("--width")&&(s+="width: calc(var(--width) + 6px);"),$(this).css("--height")&&(s+="height: calc(var(--height) + 6px);"),$(this).html(`<div class="plate" style="${s}"></div><div class="border"><div class="top"><div class="key k${a}">`);var n=$(this).attr("class").match(/.*(led(\d)).*/);if(n&&($(this).removeClass(n[1]).find(".border").prepend(`<div class="kbd-led ${n[1]}">`),$(this).hasClass("suden")&&$(this).removeClass("suden").find(".kbd-led").addClass("suden"),n[2]>7)){var i=$(this).attr("data-tooltip"),d=$(this).attr("led-color");d||(d="red"),$(this).removeAttr("data-tooltip led-color").find(".kbd-led").attr("data-tooltip",i).css("background-color",d)}})),$("#keyboard-outline").find(".kbd-led").each((function(){$(this).attr("class").match(/.*(led(\d)).*/)&&$(this).addClass("tooltipped").attr("data-position","left")})),$("#layouts-set").empty(),$("#layouts-set-div, #layouts-set-on2").hide(),$("#kblayouts-00").length>0){if($("#layouts-set-div, #layouts-set-on2").show(),$("#layouts-set-on").removeClass("scale-out"),$("#layouts-set").empty(),layouts_save)var t=layouts_save.match(/(\d)/g);s=0,$("div[id^='kblayouts-']").each((function(){var e=this.id.match(/kblayouts-(\d)(\d)/),a=e[1],o=e[2];s<a&&(s=a),console.log("user_layouts_i:"+a),0==o&&($("#layouts-set").append('<div class="rowstart">[ '+$(this).attr("value-desc")+" ]"),$("#layouts-set").append('<div id="layouts-'+a+'">'),t&&t[a]||(layouts_save+="0")),$("#layouts-"+a).append('<label><input type="radio" id="layouts-'+a+o+'" class="layouts-'+a+' with-gap" name="layouts-'+a+'"/><span for="layouts-'+a+o+'">'+$(this).attr("value-name")),$(`#kblayouts-${a}${o}, [layout=${a}${o}]`).css("display",0==o?"block":"none"),t&&t[a]&&($("#kblayouts-"+a+"0").hide(),$("#kblayouts-"+a+t[a]).show()),"block"==$(this).css("display")&&$("#layouts-"+a+o).prop({checked:"checked"})}))}}$.when(z).then((function(){variant?n=variant:$.cookie&&$.cookie("ck_select_kbd")&&(n=$.cookie("ck_select_kbd")),y(n)})),$("#keyboard-outline").on("mousedown",(function(e){$(":hover").length<=6&&X(0)})),$("#keyboard-outline").on("mousedown","[class^='mykeycap']",(function(e){2!=e.button&&($("#kbdinfo_tab").hasClass("active")||($(this).hasClass("key-editing")?X(0):X($(this)),1==e.button&&(e.preventDefault(),e.shiftKey?L(0):L(1))))})),$("#import-user-keycap-colors").click((function(e,a){console.log($("#user-keycap-colors").val());var t=$("#user-keycap-colors").val().split(",");t instanceof Array&&6==t.length&&update_keycap_color(t)}))}));var action_kinds={KEY:{id:"KEY",name:"常规按键",desc:"常规按键，右击查看帮助",link:"normal-key"},MODS_KEY:{id:"MODS_KEY",name:"修饰键（组合键）",desc:"修饰键，指ctrl shift alt(option) win(command)这些，右击查看帮助",link:"mods-key"},LAYER_MOMENTARY:{id:"LAYER_MOMENTARY",name:"瞬时开启层",desc:"按下按键时瞬时开启层，放开按键时层会关闭，右击查看帮助",link:"l-layer"},LAYER_TOGGLE:{id:"LAYER_TOGGLE",name:"层开关",desc:"切换层开关，右击查看帮助",link:"t-layer"},DEFAULT_LAYER_SET:{id:"DEFAULT_LAYER_SET",name:"设置默认层",desc:"设置一个层为默认层，右击查看帮助",link:"default-layer-set"},LAUNCH_SHORTCUT:{id:"LAUNCH_SHORTCUT",name:"启动快捷方式",desc:"启动一个快捷方式(仅支持windows)，右击查看帮助",link:"features/shortcut"},OPT_GROUP2:{id:"OPT_GROUP2",name:"Tap二合一功能按键 ▼",desc:"Tap二合一功能按键"},MODS_TAP_KEY:{id:"MODS_TAP_KEY",name:"按键 | 修饰键(s)",desc:"单击时是按键，长按及和其他键组合时是修饰键，右击查看帮助",link:"mods-tap-key"},MODS_TAP_KFT:{id:"MODS_TAP_KFT",name:"按键(k) | 修饰键",desc:"单击时是按键(且优先，即工作在非Interrupt模式下)，长按时是修饰键，右击查看帮助",link:"mods-tap-key"},LAYER_TAP_KEY:{id:"LAYER_TAP_KEY",name:"按键 | 瞬时开启层",desc:"单击是按键，长按及和其他键组合时是瞬时开启层，右击查看帮助",link:"layer-tap-key"},LAYER_TAP_TOGGLE:{id:"LAYER_TAP_TOGGLE",name:"层开关 | 瞬时开启层",desc:"瞬时开启层，如果连续点击数次时开关层，右击查看帮助",link:"lt-layer"},LAYER_MODS:{id:"LAYER_MODS",name:"修饰键 & 瞬时开启层",desc:"瞬时开启层的同时按下修饰键(目前仅支持左修饰键)，右击查看帮助",link:"layer-mods"},UNKNOWN:{id:"UNKNOWN",name:"其他",desc:"用于显示特殊功能，或该键盘不支持的功能",link:""}};Object.freeze(action_kinds);var keycodes=[];keycodes[0]={id:"NO  ",name:'<i class="fa fa-ban fs22"></i>',desc:"当前层禁用此按键。也可用<kt>shift</kt>+<kt>鼠标中键</kt>点击设置"},keycodes[1]={id:"TRNS",name:"▽",desc:"当前层此按键穿透到更低层。可用<kt>鼠标中键</kt>点击按键设置"},keycodes[2]={id:"POST_FAIL",name:"POST_FAIL",desc:"POST_FAIL"},keycodes[3]={id:"UNDEFINED",name:"UNDEFINED",desc:"UNDEFINED"},keycodes[4]={id:"A",name:"A",desc:"A"},keycodes[5]={id:"B",name:"B",desc:"B"},keycodes[6]={id:"C",name:"C",desc:"C"},keycodes[7]={id:"D",name:"D",desc:"D"},keycodes[8]={id:"E",name:"E",desc:"E"},keycodes[9]={id:"F",name:"F",desc:"F"},keycodes[10]={id:"G",name:"G",desc:"G"},keycodes[11]={id:"H",name:"H",desc:"H"},keycodes[12]={id:"I",name:"I",desc:"I"},keycodes[13]={id:"J",name:"J",desc:"J"},keycodes[14]={id:"K",name:"K",desc:"K"},keycodes[15]={id:"L",name:"L",desc:"L"},keycodes[16]={id:"M",name:"M",desc:"M"},keycodes[17]={id:"N",name:"N",desc:"N"},keycodes[18]={id:"O",name:"O",desc:"O"},keycodes[19]={id:"P",name:"P",desc:"P"},keycodes[20]={id:"Q",name:"Q",desc:"Q"},keycodes[21]={id:"R",name:"R",desc:"R"},keycodes[22]={id:"S",name:"S",desc:"S"},keycodes[23]={id:"T",name:"T",desc:"T"},keycodes[24]={id:"U",name:"U",desc:"U"},keycodes[25]={id:"V",name:"V",desc:"V"},keycodes[26]={id:"W",name:"W",desc:"W"},keycodes[27]={id:"X",name:"X",desc:"X"},keycodes[28]={id:"Y",name:"Y",desc:"Y"},keycodes[29]={id:"Z",name:"Z",desc:"Z"},keycodes[30]={id:"1",name:"!<br>1",desc:"1 !"},keycodes[31]={id:"2",name:"@<br>2",desc:"2 @"},keycodes[32]={id:"3",name:"#<br>3",desc:"3 #"},keycodes[33]={id:"4",name:"$<br>4",desc:"4 $"},keycodes[34]={id:"5",name:"%<br>5",desc:"5 %"},keycodes[35]={id:"6",name:"^<br>6",desc:"6 ^"},keycodes[36]={id:"7",name:"&<br>7",desc:"7 &"},keycodes[37]={id:"8",name:"*<br>8",desc:"8 *"},keycodes[38]={id:"9",name:"(<br>9",desc:"9 ("},keycodes[39]={id:"0",name:")<br>0",desc:"0 )"},keycodes[40]={id:"ENT",name:"Enter",desc:"Enter"},keycodes[41]={id:"ESC",name:"Esc",desc:"Esc"},keycodes[42]={id:"BSPC",name:"Backspace",desc:"Backspace"},keycodes[43]={id:"TAB",name:"Tab",desc:"Tab"},keycodes[44]={id:"SPC",name:"Space",desc:"Space"},keycodes[45]={id:"MINS",name:"_<br>-",desc:"- _"},keycodes[46]={id:"EQL",name:"+<br>=",desc:"= +"},keycodes[47]={id:"LBRC",name:"{<br>[",desc:"[ {"},keycodes[48]={id:"RBRC",name:"}<br>]",desc:"] }"},keycodes[49]={id:"BSLS",name:"|<br>\\",desc:"\\ |"},keycodes[50]={id:"NUHS",name:"~<br>#",desc:"ISO ~#"},keycodes[51]={id:"SCLN",name:":<br>;",desc:"; :"},keycodes[52]={id:"QUOT",name:"\"<br>'",desc:"' \""},keycodes[53]={id:"GRV ",name:"~<br>`",desc:"` ~"},keycodes[54]={id:"COMM",name:"<<br>,",desc:", <"},keycodes[55]={id:"DOT ",name:"><br>.",desc:". >"},keycodes[56]={id:"SLSH",name:"?<br>/",desc:"/ ?"},keycodes[57]={id:"CAPS",name:"Caps Lock",desc:"CapsLock"},keycodes[58]={id:"F1  ",name:"F1",desc:"F1"},keycodes[59]={id:"F2  ",name:"F2",desc:"F2"},keycodes[60]={id:"F3  ",name:"F3",desc:"F3"},keycodes[61]={id:"F4  ",name:"F4",desc:"F4"},keycodes[62]={id:"F5  ",name:"F5",desc:"F5"},keycodes[63]={id:"F6  ",name:"F6",desc:"F6"},keycodes[64]={id:"F7  ",name:"F7",desc:"F7"},keycodes[65]={id:"F8  ",name:"F8",desc:"F8"},keycodes[66]={id:"F9  ",name:"F9",desc:"F9"},keycodes[67]={id:"F10 ",name:"F10",desc:"F10"},keycodes[68]={id:"F11 ",name:"F11",desc:"F11"},keycodes[69]={id:"F12 ",name:"F12",desc:"F12"},keycodes[70]={id:"PSCR",name:"Print<br>Scrn",desc:"Print Screen"},keycodes[71]={id:"SLCK",name:"Scrll<br>Lock",desc:"Scroll Lock"},keycodes[72]={id:"PAUS",name:"Pause",desc:"Pause Break"},keycodes[73]={id:"INS ",name:"Ins",desc:"Insert"},keycodes[74]={id:"HOME",name:"Home",desc:"Home"},keycodes[75]={id:"PGUP",name:"Page<br>Up",desc:"Page Up"},keycodes[76]={id:"DEL ",name:"Del",desc:"Del"},keycodes[77]={id:"END ",name:"End",desc:"End"},keycodes[78]={id:"PGDN",name:"Page<br>Dn",desc:"Page Down"},keycodes[79]={id:"RGHT",name:"→",name_dsa:'<i class="fa fa-arrow-right"/>',desc:"Right"},keycodes[80]={id:"LEFT",name:"←",name_dsa:'<i class="fa fa-arrow-left"/>',desc:"Left"},keycodes[81]={id:"DOWN",name:"↓",name_dsa:'<i class="fa fa-arrow-down"/>',desc:"Down"},keycodes[82]={id:"UP  ",name:"↑",name_dsa:'<i class="fa fa-arrow-up"/>',desc:"Up"},keycodes[83]={id:"NLCK",name:"Num<br>Lock",desc:"Num Lock"},keycodes[84]={id:"PSLS",name:"/",name_dsa:"÷",desc:"Keypad /"},keycodes[85]={id:"PAST",name:"*",name_dsa:"×",desc:"Keypad *"},keycodes[86]={id:"PMNS",name:"-",desc:"Keypad -"},keycodes[87]={id:"PPLS",name:"+",desc:"Keypad +"},keycodes[88]={id:"PENT",name:"P↩",desc:"Keypad Enter"},keycodes[89]={id:"P1  ",name:'1<br><span class="fs10">End</span>',name_dsa:"1",desc:"Keypad 1"},keycodes[90]={id:"P2  ",name:"2<br>↓",name_dsa:"2",desc:"Keypad 2"},keycodes[91]={id:"P3  ",name:'3<br><span class="fs10">PgDn</span>',name_dsa:"3",desc:"Keypad 3"},keycodes[92]={id:"P4  ",name:"4<br>←",name_dsa:"4",desc:"Keypad 4"},keycodes[93]={id:"P5  ",name:"5",desc:"Keypad 5"},keycodes[94]={id:"P6  ",name:"6<br>→",name_dsa:"6",desc:"Keypad 6"},keycodes[95]={id:"P7  ",name:'7<br><span class="fs10">Home</span>',name_dsa:"7",desc:"Keypad 7"},keycodes[96]={id:"P8  ",name:"8<br>↑",name_dsa:"8",desc:"Keypad 8"},keycodes[97]={id:"P9  ",name:'9<br><span class="fs10">PgUp</span>',name_dsa:"9",desc:"Keypad 9"},keycodes[98]={id:"P0  ",name:'0<br><span class="fs10">Ins</span>',name_dsa:"0",desc:"Keypad 0"},keycodes[99]={id:"PDOT",name:'.<br><span class="fs10">Del</span>',name_dsa:".",desc:"Keypad ."},keycodes[100]={id:"NUBS",name:"|<sub>ISO</sub><br>\\",desc:"|\\ for ISO layout"},keycodes[101]={id:"APP ",name:"Menu",desc:"Menu on Win"},keycodes[102]={id:"POWER",name:"Power",desc:"Power(work on Mac)"},keycodes[103]={id:"PEQL",name:"=",desc:"Keymapd Equal(Not work on Win)"},keycodes[104]={id:"F13 ",name:"F13",desc:"F13"},keycodes[105]={id:"F14 ",name:"F14",desc:"F14"},keycodes[106]={id:"F15 ",name:"F15",desc:"F15"},keycodes[107]={id:"F16 ",name:"F16",desc:"F16"},keycodes[108]={id:"F17 ",name:"F17",desc:"F17"},keycodes[109]={id:"F18 ",name:"F18",desc:"F18"},keycodes[110]={id:"F19 ",name:"F19",desc:"F19"},keycodes[111]={id:"F20 ",name:"F20",desc:"F20"},keycodes[112]={id:"F21 ",name:"F21",desc:"F21"},keycodes[113]={id:"F22 ",name:"F22",desc:"F22"},keycodes[114]={id:"F23 ",name:"F23",desc:"F23"},keycodes[115]={id:"F24 ",name:"F24",desc:"F24"},keycodes[130]={id:"LCAP",name:"Locking Caps Lock",desc:"Locking Caps Lock"},keycodes[131]={id:"LNUM",name:"Locking Num Lock",desc:"Locking Num Lock"},keycodes[132]={id:"LSCR",name:"Locking Scroll Lock",desc:"Locking Scroll Lock"},keycodes[135]={id:"INT1",name:"JIS ろ",desc:"Japanese RO"},keycodes[136]={id:"INT2",name:"ひらがな",desc:"Japanese Hiragana"},keycodes[137]={id:"INT3",name:"JIS ￥",desc:"Japanese Yen"},keycodes[138]={id:"INT4",name:"変換",desc:"Japanese Henkan"},keycodes[139]={id:"INT5",name:"無変換",desc:"Japanese Muhenkan"},keycodes[140]={id:"INT6",name:"INT6",desc:"INT6"},keycodes[141]={id:"INT7",name:"INT7",desc:"INT7"},keycodes[142]={id:"INT8",name:"INT8",desc:"INT8"},keycodes[143]={id:"INT9",name:"INT9",desc:"INT9"},keycodes[144]={id:"LANG1",name:"한/영",desc:"Korean Hangul/English"},keycodes[145]={id:"LANG2",name:"한자",desc:"Korean Hanja"},keycodes[146]={id:"LANG3",name:"LANG3",desc:"LANG3"},keycodes[147]={id:"LANG4",name:"LANG4",desc:"LANG4"},keycodes[148]={id:"LANG5",name:"LANG5",desc:"LANG5"},keycodes[149]={id:"LANG6",name:"LANG6",desc:"LANG6"},keycodes[150]={id:"LANG7",name:"LANG7",desc:"LANG7"},keycodes[151]={id:"LANG8",name:"LANG8",desc:"LANG8"},keycodes[152]={id:"LANG9",name:"LANG9",desc:"LANG9"},keycodes[176]={id:"P00",name:"00",desc:"Keypad 00, 极少数键盘未支持此功能"},keycodes[224]={id:"LCTL",name:"Ctrl",desc:"Left Control"},keycodes[225]={id:"LSFT",name:"Shift",desc:"Left Shift"},keycodes[226]={id:"LALT",name:"Alt",desc:"Left Alt"},keycodes[227]={id:"LGUI",name:"Win",desc:"Left Windows"},keycodes[228]={id:"RCTL",name:"rCtrl",desc:"Right Control"},keycodes[229]={id:"RSFT",name:"rShift",desc:"Right Shift"},keycodes[230]={id:"RALT",name:"rAlt",desc:"Right Alt"},keycodes[231]={id:"RGUI",name:"rWin",desc:"Right Windows"},keycodes[168]={id:"Mute",name:' <i class="kb kb-Multimedia-Mute-2 fs20"/>',desc:"静音"},keycodes[169]={id:"Vol Up",name:' <i class="kb kb-Multimedia-Volume-Up-2 fs20"/>',desc:"音量加"},keycodes[170]={id:"Vol Down",name:' <i class="kb kb-Multimedia-Volume-Down-2 fs20"/>',desc:"音量减"},keycodes[240]={id:"MouseUp",name:'<i class="i_mouse_move_up fs24"></i>',desc:"鼠标： 上移"},keycodes[241]={id:"MouseDown",name:'<i class="i_mouse_move_down fs24"></i>',desc:"鼠标： 下移"},keycodes[242]={id:"MouseLeft",name:'<i class="i_mouse_move_left fs24"></i>',desc:"鼠标： 左移"},keycodes[243]={id:"MouseRight",name:'<i class="i_mouse_move_right fs24"></i>',desc:"鼠标： 右移"},keycodes[244]={id:"MouseLBtn",name:'<i class="i_mouse_left fs24"></i>',desc:"鼠标: 点击左键"},keycodes[245]={id:"MouseRBtn",name:'<i class="i_mouse_right fs24"></i>',desc:"鼠标: 点击右键"},keycodes[246]={id:"MouseMBtn",name:'<i class="i_mouse_middle fs24"></i>',desc:"鼠标: 点击中键"},keycodes[247]={id:"MouseBack",name:'<i class="i_mouse_back fs24"></i>',desc:"鼠标: 点击后退"},keycodes[248]={id:"MousePrev",name:'<i class="i_mouse_forward fs24"></i>',desc:"鼠标: 点击前进"},keycodes[249]={id:"WheelUp",name:'<i class="i_mouse_wheel_up fs24"></i>',desc:"鼠标: 滚轮 上"},keycodes[250]={id:"WheelDown",name:'<i class="i_mouse_wheel_down fs24"></i>',desc:"鼠标: 滚轮 下"},keycodes[251]={id:"WheelLeft",name:'<i class="i_mouse_wheel_left fs24"></i>',desc:"鼠标: 滚轮 左"},keycodes[252]={id:"WheelRight",name:'<i class="i_mouse_wheel_right fs24"></i>',desc:"鼠标: 滚轮 右"},Object.freeze(keycodes);var extra_keycodes={358:{id:"MAC_POWER_MENU",name:'<i class="i_mac_powermenu fs32"></i>',desc:"Mac Only: 显示一个对话框，询问您是要重新启动、睡眠还是关机"},870:{id:"MAC_SCREENOFF",name:'<i class="i_mac_display_off fs32"></i>',desc:"Mac Only: 将显示器置于睡眠状态"},3174:{id:"MAC_SLEEP",name:'<i class="i_mac_powersleep fs32"></i>',desc:"Mac Only: 将您的 Mac 置于睡眠状态"},1705:{id:"VOL_UP_DIV4",name:'<i class="kb kb-Multimedia-Volume-Up-2 fs16"/>¼',desc:"Mac Only: 音量增加4分之1格"},1706:{id:"VOL_DN_DIV4",name:'<i class="kb kb-Multimedia-Volume-Down-2 fs16"/>¼',desc:"Mac Only: 音量减小4分之1格"}};function mousekey_codes(e){var a={240:{id:"MS_U",name:'<i class="i_mouse_move_up fs32"></i>',desc:"鼠标： 上移"},241:{id:"MS_D",name:'<i class="i_mouse_move_down fs32"></i>',desc:"鼠标： 下移"},242:{id:"MS_L",name:'<i class="i_mouse_move_left fs32"></i>',desc:"鼠标： 左移"},243:{id:"MS_R",name:'<i class="i_mouse_move_right fs32"></i>',desc:"鼠标： 右移"},244:{id:"BTN1",name:'<i class="i_mouse_left fs32"></i>',desc:"鼠标: 点击左键"},245:{id:"BTN2",name:'<i class="i_mouse_right fs32"></i>',desc:"鼠标: 点击右键"},246:{id:"BTN3",name:'<i class="i_mouse_middle fs32"></i>',desc:"鼠标: 点击中键"},247:{id:"BTN4",name:'<i class="i_mouse_back fs32"></i>',desc:"鼠标: 点击后退"},248:{id:"BTN5",name:'<i class="i_mouse_forward fs32"></i>',desc:"鼠标: 点击前进"},249:{id:"WH_U",name:'<i class="i_mouse_wheel_up fs32"></i>',desc:"鼠标: 滚轮 上"},250:{id:"WH_D",name:'<i class="i_mouse_wheel_down fs32"></i>',desc:"鼠标: 滚轮 下"},251:{id:"WH_L",name:'<i class="i_mouse_wheel_left fs32"></i>',desc:"鼠标: 滚轮 左"},252:{id:"WH_R",name:'<i class="i_mouse_wheel_right fs32"></i>',desc:"鼠标: 滚轮 右"},253:{id:"ACL0",name:'<i class="i_mouse_speed_slow fs32"></i>',desc:'按住此键，再按鼠标移动键时，鼠标指针"慢速"匀速移动'},254:{id:"ACL1",name:'<i class="i_mouse_speed_medium fs32"></i>',desc:'按住此键，再按鼠标移动键时，鼠标指针"中速"匀速移动'},255:{id:"ACL2",name:'<i class="i_mouse_speed_fast fs32"></i>',desc:'按住此键，再按鼠标移动键时，鼠标指针"快速"匀速移动'}};return a[e]?a[e]:0==e?{id:"BTN1_",name:"火力左键",desc:"火力模式按键 鼠标左键"}:e<=69?{id:keycodes[e].id,name:"火"+keycodes[e].id,desc:"火力模式按键 "+keycodes[e].desc}:void console.log(e)}function mods_codes(e){var a="",t=[];return 1&e&&(a+="⌃",t.push("Ctrl")),2&e&&(a+="⇧",t.push("Shift")),4&e&&(a+="⌥",t.push("Alt")),8&e&&(a+="⌘",t.push("Win")),t=t.join(" + "),1==a.length?(a=t,16&e&&(t="Right "+t)):16&e&&(a="r"+a,t="Right "+t),{name:a,desc:t}}function keyCode2tmkCode(e){var a={173:189,61:187,59:186,181:173,182:174,183:175,480:347,736:605};navigator.userAgent.indexOf("Firefox")>=0&&a[e]&&(e=a[e]);return{8:42,9:43,13:40,272:225,528:229,273:224,529:228,274:226,530:230,19:72,20:57,27:41,32:44,33:75,34:78,35:77,36:74,37:80,38:82,39:79,40:81,44:70,45:73,46:76,48:39,49:30,50:31,51:32,52:33,53:34,54:35,55:36,56:37,57:38,65:4,66:5,67:6,68:7,69:8,70:9,71:10,72:11,73:12,74:13,75:14,76:15,77:16,78:17,79:18,80:19,81:20,82:21,83:22,84:23,85:24,86:25,87:26,88:27,89:28,90:29,347:227,604:231,605:231,93:101,781:88,864:98,813:98,865:89,803:89,866:90,808:90,867:91,802:91,868:92,805:92,869:93,780:93,870:94,807:94,871:95,804:95,872:96,806:96,873:97,801:97,874:85,875:87,877:86,878:99,814:99,879:84,112:58,113:59,114:60,115:61,116:62,117:63,118:64,119:65,120:66,121:67,122:68,123:69,144:83,145:71,186:51,187:46,188:54,189:45,190:55,191:56,192:53,219:47,220:49,221:48,222:52,124:104,173:16610,174:16618,175:16617,183:16786,226:100}[e]}function keyName2tmkCode(e){if(keyUnimap={KANA:"00",VOLDN:"40EA",VOLUP:"40E9",MUTE:"40E2",CALC:"4192",A:"04",B:"05",C:"06",D:"07",E:"08",F:"09",G:"0A",H:"0B",I:"0C",J:"0D",K:"0E",L:"0F",M:"10",N:"11",O:"12",P:"13",Q:"14",R:"15",S:"16",T:"17",U:"18",V:"19",W:"1A",X:"1B",Y:"1C",Z:"1D",1:"1E",2:"1F",3:"20",4:"21",5:"22",6:"23",7:"24",8:"25",9:"26",0:"27",ENTER:"28",ESC:"29",BS:"2A",BACKSPACE:"2A",TAB:"2B",SPACE:"2C","-":"2D","=":"2E","[":"2F","]":"30","\\":"31","ISO#":"32",";":"33","'":"34","`":"35",",":"36",COMMA:"36",".":"37","/":"38",CAPSLOCK:"39","CAPS LOCK":"39",F1:"3A",F2:"3B",F3:"3C",F4:"3D",F5:"3E",F6:"3F",F7:"40",F8:"41",F9:"42",F10:"43",F11:"44",F12:"45",PRTSCR:"46","PRINT SCREEN":"46",SCRLK:"47","SCROLL LOCK":"47",PAUSE:"48","PAUSE BREAK":"48",INS:"49",INSERT:"49",HOME:"4A",PGUP:"4B","PAGE UP":"4B",DEL:"4C",DELETE:"4C",END:"4D",PGDN:"4E","PAGE DOWN":"4E",RIGHT:"4F",LEFT:"50",DOWN:"51",UP:"52","NUM LOCK":"53",NUMLK:"53",NUMLOCK:"53","P/":"54","P*":"55","P-":"56","P+":"57",PENTER:"58",P1:"59",P2:"5A",P3:"5B",P4:"5C",P5:"5D",P6:"5E",P7:"5F",P8:"60",P9:"61",P0:"62","P.":"63","ISO\\":"64",MENU:"65","P,":"66","P=":"67",F13:"68",F14:"69",F15:"6A",F16:"6B",F17:"6C",F18:"6D",F19:"6E",F20:"6F",F21:"70",F22:"71",F23:"72",F24:"73",JYEN:"74",RO:"75",HENK:"76",MHEN:"77",CTRL:"78",SHIFT:"79",ALT:"7A",WIN:"7B",RCTRL:"7C",RSHIFT:"7D",RALT:"7E",RWIN:"7F",NO:"80"},"number"==typeof e){for(var a in e>=224&&e<232&&(e-=104),keyUnimap)if(e==parseInt(keyUnimap[a],16))return a;console.log(e)}if(keyUnimap[e])return keyUnimap[e];console.log(keyUnimap[e])}function tmkCode2keyName(e){return keyName2tmkCode(e)}function shorten_date(e){var a=parseInt(e,10);return a<10?""+a:String.fromCharCode(a+55)}function keylabel_mac(e){return e=e.replace(/Del/i,"delete<i class='kb kb-Unicode-DeleteRight-Big fs12'></i>").replace(/Home/i,"home").replace(/End/i,"end").replace(/Page<br>Up/i,"page<br>up").replace(/Page<br>Dn/i,"page<br>dn").replace(/backspace|bs/i,"delete").replace(/caps lock/i,"caps<br>lock").replace(/tab/i,"tab").replace(/esc/i,"esc").replace(/enter/i,"return").replace(/space/i,"space").replace(/ctrl/i,"control").replace(/shift/i,"shift").replace(/alt/i,"option").replace(/left windows/i,"Left Command").replace(/right windows/i,"Left Command").replace(/win/i,"cmd⌘").replace(/cmd⌘dows/i,"windows").replace(/print<br>scrn/i,"F13").replace(/scrll<br>lock/i,"F14").replace(/pause/i,"F15").replace(/ins/i,"help").replace(/p↩/i,"enter").replace(/p=/i,"=").replace(/num<br>lock/i,"clear")}function source_output(e){var a="";for(var t in a+='#include "action.h"\n',a+='#include "action_code.h"\n',a+='#include "actionmap.h"\n',a+="\n",a+="const action_t actionmaps[][",a+=e[0].length,a+="][",a+=e[0][0].length,a+='] __attribute__ ((section (".keymap.keymaps"))) = {\n',e){for(var o in a+="    {\n",e[t]){for(var s in a+="        { ",e[t][o])a+="0x"+("000"+e[t][o][s].toString(16)).substr(-4),a+=",";a+=" },\n"}a+="    },\n"}return a+="};\n"}function hex_line(e,a,t){var o=function(e){return("0"+e.toString(16)).substr(-2).toUpperCase()},s=0;s+=t.length,s+=e>>8,s+=255&e,s+=a;var n=":";n+=o(t.length),n+=o(e>>8),n+=o(255&e),n+=o(a);for(var i=0;i<t.length;i++)s+=t[i],n+=o(t[i]);return n+=o(1+~s&255)}function hex_eof(){return":00000001FF"}function hex_output(e,a){var t=[],o=[];return[].concat.apply([],[].concat.apply([],a)).forEach((function(a){o.push(a),16==o.length&&(t.push(hex_line(e,0,o)),e+=16,o.length=0)})),o.length>0&&(t+=hex_line(e,0,o)),t}function hex_keymaps(e){var a=[];return a=(a=[].concat.apply([],[].concat.apply([],keymaps))).map((function(e){return[255&e,(65280&e)>>8]})),hex_output(e,a=[].concat.apply([],a))}function get_fw_date_from_bin(e){var a=e,t=new Array(0,0,0,0),o=find_array_in_array("USB_D",e,0);if(0!=o){var s=o.end;t[0]=a[s]-55,month_day_to_num=function(e){return e<=57?e-48:e>=65?e-55:void 0},t[1]=month_day_to_num(a[s+2]),t[2]=month_day_to_num(a[s+4]),t[3]=1e4*t[0]+100*t[1]+t[2],console.info("%c_Got FW Date: "+t,"color: green")}return t[0]>=19&&t[1]>0&&t[1]<=12&&t[2]>0&&t[2]<=31?t:0}function bin_split_firmware(e,a,t,o){var s=[],n=[],i=[];null!=o&&(a-=o),console.log("bin keymap addr: 0x"+a.toString(16));var d=new Uint8Array(e.length);if(d.fill(0),"object"==typeof e)d=e;else for(var r=0;r<e.length;r++)d[r]=e[r].charCodeAt(0);var c=[];for(r=0;r<a;r++)c.push(d[r]);s=hex_output(0,c);for(r=a;r<a+t;r++)i.push(d[r]|d[r+1]<<8),r++;for(r=a+t;r<e.length;r++)n[r-a-t]=d[r];for(var l=[],_=[];i.length>0;)_.push(i.splice(0,16)),8==_.length&&(l.push(_),_=[]);return{before:s,after:n,keymaps:l,date:get_fw_date_from_bin(c)}}function url_encode_keymap(e){return"undefined"!=typeof LZString&&"undefined"!=typeof Base64?Base64.encode(LZString.compress(JSON.stringify(e))):window.btoa(JSON.stringify(e))}function url_decode_keymap(e){if(null==e||"string"!=typeof e||e.length<30)return null;var a=unzip(e);if(null!=a)return console.log("zip"),JSON.parse(a);try{return"undefined"!=typeof LZString&&"undefined"!=typeof Base64?(console.log("lz"),JSON.parse(LZString.decompress(Base64.decode(e))).keymaps):JSON.parse(window.atob(e)).keymaps}catch(e){return null}}function unzip(e){var a=atob(e),t=new pako.Inflate;if(t.push(a,!0),t.err)return null;var o=t.result;return strData=String.fromCharCode.apply(null,new Uint16Array(o)),strData}function zip(e){var a=pako.gzip(e,{to:"string"});return btoa(a)}function bin_to_uf2(e,a,t){for(var o=e.length+255>>8,s=[],n=0;n<e.length;n+=256){for(var i=new ArrayBuffer(512),d=new DataView(i),r=0;r<512;r++)d[r]=0;d.setUint32(0,171066965,!0),d.setUint32(4,2656915799,!0),d.setUint32(8,8192,!0),d.setUint32(12,a+n,!0),d.setUint32(16,256,!0),d.setUint32(20,s.length/512,!0),d.setUint32(24,o,!0),d.setUint32(28,t,!0);for(r=0;r<256;++r)d.setUint8(r+32,e[n+r]);d.setUint32(508,179400496,!0);for(r=0;r<512;r++)s.push(d.getUint8(r))}return new Uint8Array(s)}function uf2_to_bin(e){for(var a="",t=parseInt(e[13].charCodeAt(0),10)<<8|parseInt(e[12].charCodeAt(0),10),o=0;o<e.length;o+=512)for(var s=0;s<512;s++)s>=32&&s<288&&(a+=e[s+o]);return{binstr:a,bin_start_addr:t}}function load_hex_uf2(e){fetch(e).then(checkResponse).then(parseTEXT).then((function(e){var a=hex_split_firmware(e,63488,KEYMAP_SIZE);firmware_before_uf2=a.before}))}function bin_overwrite(e){var a=$("#fw-original").attr("value-name");if(a){var t=find_array_in_array(a,e,0),o=$("#fw-overwrite").attr("value-name");if(0!=t&&o&&o.length<a.length){o+=` (USB_${$("#latest_firmware_date_short").text()})`;for(var s=t.start,n=0;n<o.length;n++)e[s]=o[n].charCodeAt(0),s+=2;e[s]=0}}var i=$("#fw-original").attr("value-blename");if(i){var d=find_array_in_array(i,e,1),r=$("#fw-overwrite").attr("value-blename");if(0!=d&&r&&r.length<i.length){for(s=d.start,n=0;n<r.length;n++)e[s]=r[n].charCodeAt(0),s++;e[s]=0}}var c=$("#fw-original").attr("value-vid"),l=$("#fw-original").attr("value-pid");if(c&&l){var _=[255&parseInt(c,16),parseInt(c,16)>>8,255&parseInt(l,16),parseInt(l,16)>>8];console.log(`%c_Find VID:${c} PID:${l}`,"color:green");d=find_array_in_array(_,e,3);var m=$("#fw-overwrite").attr("value-pid");if(0!=d&&m)e[s=d.start+2]=255&parseInt(m),e[s+1]=parseInt(m)>>8}return e}system_codes=[],system_codes[129]={id:"PWR ",name:'<i class="i_system_power fs32"></i>',desc:"System Power，适合Win10，仅有线模式下有效"},system_codes[130]={id:"SLEP",name:'<i class="i_system_sleep fs32"></i>',desc:"System Sleep，仅有线模式下有效"},system_codes[131]={id:"WAKE",name:'<i class="i_system_wake fs32"></i>',desc:"System Wake，仅有线模式下有效"},Object.freeze(system_codes),consumer_codes={111:{id:"SBUP",name:' <i style="padding-left:6px" class="kb kb-Unicode-Screen-Bright fs24"/>',desc:"增大屏幕亮度，需要设备本身支持此功能，系统要求win8以上/Mac/iOS/iPadOS"},112:{id:"SBDN",name:' <i style="padding-left:6px" class="kb kb-Unicode-Screen-Dim fs24"/>',desc:"降低屏幕亮度，需要设备本身支持此功能，系统要求win8以上/Mac/iOS/iPadOS"},226:{id:"MUTE",name:' <i class="kb kb-Multimedia-Mute-2 fs22"/>',desc:"静音"},233:{id:"VOLU",name:' <i class="kb kb-Multimedia-Volume-Up-2 fs22"/>',desc:"音量加"},234:{id:"VOLD",name:' <i class="kb kb-Multimedia-Volume-Down-2 fs22"/>',desc:"音量减"},181:{id:"MNXT",name:' <i class="fa fa-step-forward fs20"/>',desc:"下一曲"},182:{id:"MPRV",name:' <i class="fa fa-step-backward fs20"/>',desc:"上一曲"},183:{id:"MSTP",name:' <i class="fa fa-stop fs20"/>',desc:"停止播放"},184:{id:"EJCT",name:' <i class="material-icons fs22">keyboard_hide</i>',desc:"显示或隐藏iOS/iPadOS虚拟键盘"},205:{id:"MPLY",name:' <i class="fa fa-play fs20"/>',desc:"播放/暂停"},387:{id:"MSEL",name:' <i class="fa fa-music fs20"/>',desc:"启动默认音乐播放器"},394:{id:"MAIL",name:' <i class="fa fa-envelope fs20"></i>',desc:"邮件"},402:{id:"CALC",name:' <i class="fa fa-calculator fs22"/>',desc:"计算器，仅Windows下有效"},404:{id:"MYCM",name:' <i class="fa fa-desktop fs20"></i>',desc:"资源管理器，仅Windows下有效"},545:{id:"WSCH",name:'<i class="i_www_search fs32"></i>',desc:"浏览器： 搜索"},547:{id:"WHOM",name:'<i class="i_www_home fs32"></i>',desc:"浏览器： 主页"},548:{id:"WBAK",name:'<i class="i_www_back fs32"></i>',desc:"浏览器： 后退"},549:{id:"WFWD",name:'<i class="i_www_forward fs32"></i>',desc:"浏览器： 前进"},550:{id:"WSTP",name:'<i class="i_www_stop fs32"></i>',desc:"浏览器： 停止"},551:{id:"WREF",name:'<i class="i_www_refresh fs32"></i>',desc:"浏览器： 刷新"},554:{id:"WFAV",name:'<i class="i_www_favorites fs32"></i>',desc:"浏览器： 收藏夹"},179:{id:"MFFD",name:"Fast Forward",desc:"Media Fast Forward(Mac)"},180:{id:"MRWD",name:"Rewind",desc:"Media Rewind(Mac)"}},Object.freeze(consumer_codes),KEYMAP_LAYERS=8,KEYMAP_ROW=8,KEYMAP_COL=16,no_map=function(){return new Array(8).fill(0).map((e=>new Array(16).fill(0)))},transparent_map=function(){return new Array(8).fill(1).map((e=>new Array(16).fill(1)))},keymaps=[[[136,17642,17641,17634,4,5,6,7,8,9,10,11,12,13,14,15],[16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],[32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47],[48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],[64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79],[80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],[96,97,98,99,100,101,133,103,20724,20725,20726,20727,20728,20729,20730,111],[112,113,114,115,137,135,138,139,224,225,226,227,228,229,230,231]],transparent_map(),transparent_map(),transparent_map(),transparent_map(),transparent_map(),transparent_map(),transparent_map()],KEYMAP_START_ADDRESS=26624,KEYMAP_SIZE=2048,ACT_MODS=0,ACT_LMODS=0,ACT_RMODS=1,ACT_MODS_TAP=2,ACT_LMODS_TAP=2,ACT_RMODS_TAP=3,ACT_MODS_TAP_KFT=6,ACT_LMODS_TAP_KFT=6,ACT_RMODS_TAP_KFT=7,ACT_USAGE=4,ACT_MOUSEKEY=5,ACT_LAYER=8,ACT_LAYER_EXT=9,ACT_LAYER_TAP=10,ACT_LAYER_TAP_EXT=11,ACT_MACRO=12,ACT_BACKLIGHT=13,ACT_COMMAND=14,ACT_FUNCTION=15,OP_TAP_TOGGLE=240,OP_ON_OFF=241,OP_OFF_ON=242,OP_SET_CLEAR=243,OP_BIT_AND=0,OP_BIT_OR=1,OP_BIT_XOR=2,OP_BIT_SET=3,ON_SPECIAL_USE=0,ON_PRESS=1,ON_RELEASE=2,ON_BOTH=3,MOD_LCTL=1,MOD_LSFT=2,MOD_LALT=4,MOD_LGUI=8,MOD_RCTL=17,MOD_RSFT=18,MOD_RALT=20,MOD_RGUI=24,MODS_ONESHOT=0,MODS_TAP_TOGGLE=1,PAGE_CONSUMER=0,PAGE_SYSTEM=1,FUNC_TAP=8;var kind_codes={KEY:ACT_MODS<<12,MODS_KEY:ACT_MODS<<12,MODS_TAP_KEY:ACT_MODS_TAP<<12,MODS_TAP_KFT:ACT_MODS_TAP_KFT<<12,MODS_ONESHOT:ACT_MODS_TAP<<12|MODS_ONESHOT,MODS_TAP_TOGGLE:ACT_MODS_TAP<<12|MODS_TAP_TOGGLE,USAGE_SYSTEM:ACT_USAGE<<12|PAGE_SYSTEM<<10,USAGE_CONSUMER:ACT_USAGE<<12|PAGE_CONSUMER<<10,MOUSEKEY:ACT_MOUSEKEY<<12,MACRO:ACT_MACRO<<12,MACRO_TAP:ACT_MACRO<<12,MACRO_OPT:ACT_MACRO<<12,FUNCTION:ACT_FUNCTION<<12,FUNCTION_TAP:ACT_FUNCTION<<12|FUNC_TAP<<8,FUNCTION_OPT:ACT_FUNCTION<<12,LAYER_CLEAR:ACT_LAYER<<12|OP_BIT_AND<<10,LAYER_MOMENTARY:ACT_LAYER_TAP<<12|OP_ON_OFF,LAYER_TOGGLE:ACT_LAYER<<12|OP_BIT_XOR<<10|ON_RELEASE<<8,LAYER_INVERT:ACT_LAYER<<12|OP_BIT_XOR<<10,LAYER_ON:ACT_LAYER<<12|OP_BIT_OR<<10,LAYER_OFF:ACT_LAYER<<12|OP_BIT_AND<<10,LAYER_SET:ACT_LAYER<<12|OP_BIT_SET<<10,LAYER_TAP_KEY:ACT_LAYER_TAP<<12,LAYER_MODS:ACT_LAYER_TAP<<12|192,LAYER_TAP_TOGGLE:ACT_LAYER_TAP<<12|OP_TAP_TOGGLE,LAYER_ON_OFF:ACT_LAYER_TAP<<12|OP_ON_OFF,LAYER_OFF_ON:ACT_LAYER_TAP<<12|OP_OFF_ON,LAYER_SET_CLEAR:ACT_LAYER_TAP<<12|OP_SET_CLEAR,LAYER_BIT_AND:ACT_LAYER<<12|OP_BIT_AND<<10,LAYER_BIT_OR:ACT_LAYER<<12|OP_BIT_OR<<10,LAYER_BIT_XOR:ACT_LAYER<<12|OP_BIT_XOR<<10,LAYER_BIT_SET:ACT_LAYER<<12|OP_BIT_SET<<10,DEFAULT_LAYER_SET:ACT_LAYER<<12|OP_BIT_SET<<10|ON_SPECIAL_USE<<8,UNKNOWN:0};function Action(e){this.code=e,Object.defineProperty(this,"kind",{set:function(e){this.code|=(15&e)<<12},get:function(){return(61440&this.code)>>12}}),Object.defineProperty(this,"key_mods",{set:function(e){this.code|=(31&e)<<8},get:function(){return(7936&this.code)>>8}}),Object.defineProperty(this,"key_code",{set:function(e){this.code|=255&e},get:function(){return 255&this.code}}),Object.defineProperty(this,"usage_page",{set:function(e){this.code|=(3&e)<<10},get:function(){return(3072&this.code)>>10}}),Object.defineProperty(this,"usage_code",{set:function(e){this.code|=1023&e},get:function(){return 1023&this.code}}),Object.defineProperty(this,"layer_tap_val",{set:function(e){this.code|=(31&e)<<8},get:function(){return(7936&this.code)>>8}}),Object.defineProperty(this,"layer_tap_code",{set:function(e){this.code|=255&e},get:function(){return 255&this.code}}),Object.defineProperty(this,"layer_bitop_op",{set:function(e){this.code|=(3&e)<<10},get:function(){return(3072&this.code)>>10}}),Object.defineProperty(this,"layer_bitop_on",{set:function(e){this.code|=(3&e)<<8},get:function(){return(768&this.code)>>8}}),Object.defineProperty(this,"layer_bitop_part",{set:function(e){this.code|=(7&e)<<5},get:function(){return(224&this.code)>>5}}),Object.defineProperty(this,"layer_bitop_xbit",{set:function(e){this.code|=(1&e)<<4},get:function(){return(16&this.code)>>4}}),Object.defineProperty(this,"layer_bitop_bits",{set:function(e){this.code|=15&e},get:function(){return 15&this.code}}),Object.defineProperty(this,"mousekey_code",{set:function(e){this.code|=255&e},get:function(){return 255&this.code}}),this.get_action=function(){switch((61440&this.code)>>12){case ACT_LMODS:case ACT_RMODS:if(0==this.key_mods){if(keycodes[this.key_code])return $.extend({},action_kinds.KEY,{name_dsa:keycodes[this.key_code].name_dsa,name:keycodes[this.key_code].name,desc:keycodes[this.key_code].desc})}else{if(extra_keycodes[this.code])return $.extend({},action_kinds.KEY,{name_dsa:extra_keycodes[this.code].name_dsa,name:extra_keycodes[this.code].name,desc:extra_keycodes[this.code].desc});if(keycodes[this.key_code]){var e=mods_codes(this.key_mods);if(2==this.key_mods&&kc_symbol(this.key_code))var a=o='<i class="midfont">'+keycodes[this.key_code].name.substring(0,1)+"</i>",t="直接输出标点 <kt>{0}</kt>, 等效于 <kt>{1}</kt> + <kt>{2}</kt>".format(keycodes[this.key_code].name.substring(0,1),e.desc,keycodes[this.key_code].desc);else{a=e.name+"+<br>"+keycodes[this.key_code].name_dsa;keycodes[this.key_code].name_dsa&&(a=e.name+"+<br>"+keycodes[this.key_code].name_dsa.replace("<br>"," "));var o=e.name;o+=this.key_code>0?"+<br>"+keycodes[this.key_code].name.replace("<br>"," "):"";t=`<kt>${e.desc}</kt>`;t+=this.key_code>0?` + <kt>${keycodes[this.key_code].desc}`:""}return $.extend({},action_kinds.MODS_KEY,{name_dsa:a,name:o,desc:t})}}break;case ACT_LMODS_TAP:case ACT_RMODS_TAP:case ACT_LMODS_TAP_KFT:case ACT_RMODS_TAP_KFT:e=mods_codes(this.key_mods);switch(this.key_code){case MODS_ONESHOT:return $.extend({},action_kinds.MODS_ONESHOT,{name:e.name+" OneShot",desc:e.desc+" OneShot"});case MODS_TAP_TOGGLE:return $.extend({},action_kinds.MODS_TAP_TOGGLE,{name:e.name+" TapToggle",desc:e.desc+" TapToggle"})}if(null==keycodes[this.key_code])break;(c=keycodes[this.key_code].name_dsa)&&(c=c.replace("<br>"," "));var s=keycodes[this.key_code].name.replace("<br>"," "),n="";return console.log(this.kind),4&this.kind&&(n="<sub>(K)</sub>"),$.extend({},action_kinds.MODS_TAP_KEY,{name_dsa:e.name+"|<br>"+c+n,name:e.name+"|<br>"+s+n,desc:"长按及与其他键组合时：<kt>{0}</kt> ；<br>快速单击时为 <kt>{1}{2}</kt>".format(e.desc,keycodes[this.key_code].desc,n)});case ACT_LAYER:var i=1==this.layer_bitop_bits||2==this.layer_bitop_bits||4==this.layer_bitop_bits||8==this.layer_bitop_bits;switch(this.layer_bitop_op){case OP_BIT_AND:return action_kinds.LAYER_BIT_AND;case OP_BIT_OR:return action_kinds.LAYER_BIT_OR;case OP_BIT_XOR:if(this.layer_bitop_on==ON_RELEASE&&0==this.layer_bitop_xbit&&i){for(var d=4*this.layer_bitop_part,r=this.layer_bitop_bits;r>>1;r>>=1)d++;return $.extend({},action_kinds.LAYER_TOGGLE,{name:"T"+d,desc:"点击打开或关闭 层<kt>{0}</kt>".format(d)})}return action_kinds.LAYER_BIT_XOR;case OP_BIT_SET:if(this.layer_bitop_on==ON_SPECIAL_USE&&0==this.layer_bitop_xbit&&i){for(d=4*this.layer_bitop_part,r=this.layer_bitop_bits;r>>1;r>>=1)d++;return $.extend({},action_kinds.DEFAULT_LAYER_SET,{name:"默认 层"+d,desc:"设置默认层 层"+d})}if(this.layer_bitop_on==ON_PRESS&&0==this.layer_bitop_xbit&&i){for(d=4*this.layer_bitop_part,r=this.layer_bitop_bits;r>>1;r>>=1)d++;return $.extend({},action_kinds.UNKNOWN,{name:"T->"+d,desc:"跳转到 层<kt>{0}</kt>".format(d)})}return action_kinds.UNKNOWN}break;case ACT_LAYER_EXT:break;case ACT_LAYER_TAP:case ACT_LAYER_TAP_EXT:switch(this.layer_tap_code){case OP_TAP_TOGGLE:return $.extend({},action_kinds.LAYER_TAP_TOGGLE,{name:"LT"+this.layer_tap_val,desc:"Switch Layer "+this.layer_tap_val+" with Tap toggle"});case OP_ON_OFF:s="L"+this.layer_tap_val;return 1==this.layer_tap_val&&(s="Fn/"+s),$.extend({},action_kinds.LAYER_MOMENTARY,{name:s,desc:"瞬时开启（按下开启，松开关闭） 层<kt>{0}</kt>".format(this.layer_tap_val)});default:if(224==(240&this.layer_tap_code)||208==(240&this.layer_tap_code)){e=mods_codes(31&this.layer_tap_code);return $.extend({},action_kinds.LAYER_MODS,{name:"LM"+this.layer_tap_val+"<br>"+e.name,desc:"瞬时开启 层<kt>{0}</kt>, 同时按住 <kt>{1}</kt>".format(this.layer_tap_val,e.desc)})}if(null==keycodes[this.key_code])break;var c;if(this.layer_tap_val<8)layer_tap_s=this.layer_tap_val;else if(this.layer_tap_val<16)layer_tap_s=(7&this.layer_tap_val)+"(S)";else{if(!(this.layer_tap_val<24))break;layer_tap_s=(7&this.layer_tap_val)+"(P)"}(c=keycodes[this.key_code].name_dsa)&&(c=c.replace("<br>"," "));s=keycodes[this.key_code].name.replace("<br>"," ");return $.extend({},action_kinds.LAYER_TAP_KEY,{name_dsa:"LT"+layer_tap_s+"<br>"+c,name:"LT"+layer_tap_s+"<br>"+s,desc:"长按及与其他键组合时，瞬时开启 层<kt>{0}</kt> ；<br>快速单击时为 <kt>{1}</kt>".format(layer_tap_s,keycodes[this.layer_tap_code].desc)})}break;case ACT_USAGE:switch(this.usage_page){case PAGE_SYSTEM:if(system_codes[this.usage_code])return $.extend({},action_kinds.USAGE_SYSTEM,{name:system_codes[this.usage_code].name,desc:system_codes[this.usage_code].desc});case PAGE_CONSUMER:if(consumer_codes[this.usage_code])return $.extend({},action_kinds.USAGE_CONSUMER,{name:consumer_codes[this.usage_code].name,desc:consumer_codes[this.usage_code].desc})}break;case ACT_MOUSEKEY:if(mousekey_codes(this.mousekey_code))return $.extend({},action_kinds.MOUSEKEY,{name:mousekey_codes(this.mousekey_code).name,desc:mousekey_codes(this.mousekey_code).desc})}return action_kinds.UNKNOWN},Object.defineProperty(this,"id",{get:function(){return this.get_action().id}}),Object.defineProperty(this,"name",{get:function(){var e=this.get_action();return null!=e?e.name:""}}),Object.defineProperty(this,"name_dsa",{get:function(){var e=this.get_action();if(null!=e)return e.name_dsa}}),Object.defineProperty(this,"desc",{get:function(){var e=this.get_action();return null!=e?e.desc:""}})}function action_editor_get_code(){var e=$("#kind_dropdown-btn").attr("value"),a=parseInt($("#keycodes_dropdown-btn").attr("value")),t=parseInt($("#keycodes4tap_dropdown-btn").attr("value")),o=parseInt($("#key_mods_dropdown-btn").attr("value")),s=parseInt($("#layer_dropdown-btn").attr("value")),n=parseInt($("#layer_tap_dropdown-btn").attr("value")),i=parseInt($("#layer_mods_dropdown-btn").attr("value")),d=parseInt($("#launch_shortcut_dropdown-btn").attr("value"));switch(e){case"KEY":return kind_codes[e]|a;case"MODS_KEY":return kind_codes[e]|o<<8|a;case"MODS_TAP_KEY":case"MODS_TAP_KFT":return kind_codes[e]|o<<8|t;case"MODS_ONESHOT":case"MODS_TAP_TOGGLE":return kind_codes[e]|o<<8;case"USAGE_SYSTEM":return kind_codes[e]|system_code;case"USAGE_CONSUMER":return kind_codes[e]|consumer_code;case"MOUSEKEY":return kind_codes[e]|mousekey_code;case"LAYER_MOMENTARY":case"LAYER_ON_OFF":case"LAYER_OFF_ON":case"LAYER_SET_CLEAR":case"LAYER_TAP_TOGGLE":return kind_codes[e]|s<<8;case"LAYER_TAP_KEY":return kind_codes[e]|n<<8|t;case"LAYER_MODS":return kind_codes[e]|s<<8|i;case"LAYER_INVERT":case"LAYER_ON":case"LAYER_OFF":case"LAYER_SET":return kind_codes[e]|layer_on<<8|s/4<<5|1<<s%4;case"LAYER_TOGGLE":return kind_codes[e]|s/4<<5|1<<s%4;case"LAYER_CLEAR":return 0|(kind_codes[e]|layer_on<<8);case"DEFAULT_LAYER_SET":return 0|kind_codes[e]|s/4<<5|1<<s%4;case"LAUNCH_SHORTCUT":return d}return 0}function update_copyright(){var e=(new Date).getFullYear()-2016,a=0,t=setInterval((function(){++a>=e&&clearInterval(t),$("#tyear").text(2016+a)}),1e3)}async function fetchHeader(e,a){return(await fetch(e)).headers.get(a)}function format_date(e){dateDigitToString=function(e){return e<10?"0"+e:e};var a=dateDigitToString(e.getFullYear()),t=dateDigitToString(e.getMonth()+1),o=dateDigitToString(e.getDate()),s=a+"-"+t+"-"+o+" "+dateDigitToString(e.getHours())+":"+dateDigitToString(e.getMinutes())+":"+dateDigitToString(e.getSeconds());return last_modified_date_short=shorten_date(a%100)+shorten_date(t)+shorten_date(o),console.log("Latest firmware: "+last_modified_date_short+" "+s),{short:last_modified_date_short,long:s}}function checkResponse(e){if(e.status>=200&&e.status<300)return e;var a=new Error(e.statusText);throw a.response=e,a}function parseTEXT(e){return e.text()}function parseJSON(e){return e.json()}$((function(){$("#kind_dropdown").change((function(e){var a="kind",t=$("#kind_dropdown-btn").attr("value");switch(t){case"KEY":a+=" keycodes";break;case"MODS_KEY":a+=" keycodes",a+=" key_mods";break;case"LAYER_MOMENTARY":case"LAYER_TOGGLE":case"DEFAULT_LAYER_SET":case"LAYER_TAP_TOGGLE":a+=" layer";break;case"LAUNCH_SHORTCUT":a+=" launch_shortcut";break;case"MODS_TAP_KEY":case"MODS_TAP_KFT":a+=" keycodes4tap",a+=" key_mods";break;case"LAYER_TAP_KEY":a+=" keycodes4tap",a+=" layer_tap";break;case"LAYER_MODS":a+=" layer",a+=" layer_mods"}$("#fn-set").find("[id$=_dropdown-btn]").each((function(){let e=this.id.slice(0,-13);if(a.split(" ").includes(e))$(this).addClass("showf").removeClass("hidef hidden");else if("block"==$(this).css("display")){$(this).addClass("hidef").removeClass("showf");var o=$(this);setTimeout((function(){o.addClass("hidden")}),300)}$("#keycodes_dropdown").find("li").each((function(){$(this).attr("value")>=224&&$(this).attr("value")<240?"MODS_KEY"==t?$(this).hide():$(this).show():$(this).attr("value")>=166&&(new_than_231223_mods_key_mouse_vol?$(this).show():$(this).hide())})),$("#keycodes4tap_dropdown").find("li").each((function(){$(this).attr("value")>=166&&(new_than_231223_mods_key_mouse_vol?$(this).show():$(this).hide())}))}))}))})),$((function(){$("#display-layout-info").click((function(){if(0==$("#keyboard-outline").find(".keycap-length").length){var e=0,a=0;$("#keyboard-outline").find(".key:visible").each((function(){var t=$(this).parents().parents().parents().attr("class"),o=t.match(/.*? w(\d+).*?/),s=t.match(/.*? h(\d+).*?/),n=t.match(/.*?round|square|keylarger150.*?/);o&&(o=o[1]/100);var i=$(this).parents().parents().parents().css("--width");if(i&&(o=parseFloat(i.replace("px",""))/54),!n){e++,1!=o||(o=s?s[1]/100:1);var d=0;if(1.5==o&&s&&200==s[1]&&(o+="/2",d=2),$(this).attr("length",o+"u"),o>=2&&o<=2.75?d=2:o>=3&&(d=o),d>0){var r=d+("zh_cn"==NOW_LANG?"u 卫星轴":"u stabilizer");$(this).attr("stabilizer",r)}var c=$(this);setTimeout((function(){c.attr("length")&&c.removeClass("fade-in-down fade-in-up").addClass("fade-out-down")}),15*e),setTimeout((function(){a++;var t=c.attr("length"),o=("<br>"+c.attr("stabilizer")).replace(/<br>undefined/,"");t&&(c.removeClass("fade-out-down").addClass("fade-in-down"),c.html('<span class="keycap-length">{0}</span>{1}'.format(t,o)),c.removeAttr("length stabilizer")),$("#this_layout_keys").text(a),a==e&&setTimeout((function(){$("#keyboard-outline").find(".homing").find(".key").removeClass("fade-in-down fade-in-up")}),15)}),15*e+200)}})),$("#layout-info-pane").css("display","").removeClass("hidef").addClass("showf")}else $("#layer_set").tabs("select","layer_0")}))})),String.prototype.format=function(){var e=this;for(var a in arguments){var t=new RegExp("\\{"+a+"\\}","gi");e=e.replace(t,arguments[a])}return e};var $jsonp=function(){var e={send:function(e,a){var t=a.callbackName||"callback",o=a.onSuccess||function(){},s=a.onTimeout||function(){},n=a.timeout||10,i=window.setTimeout((function(){window[t]=function(){},s()}),1e3*n);window[t]=function(e){window.clearTimeout(i),o(e)};var d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=e,document.getElementsByTagName("head")[0].appendChild(d),d.parentNode.removeChild(d)}};return e}();function fadeToggle(e,a){a=a||16.6;if(0==e.style.opacity){e.style.display="block";var t=0,o=setInterval((function(){t++,e.style.opacity=t/20,t>=20&&clearInterval(o)}),a)}else if(1==e.style.opacity)t=20,o=setInterval((function(){t--,e.style.opacity=t/20,0==t&&(e.style.display="none",clearInterval(o))}),a)}function add_some_css_to_head(){var e="";for(let a=8;a<=33;a++)e+=`.fs${a} {font-size: ${a}px;}`;for(let a=1;a<=30;a++)e+=`.key-set.spc${25*a} {margin-left:${50*a/4+4}px;}`;for(let a=1;a<=40;a++)e+=`.key-set.w${25*a} {width:${50*a/4-8}px;}`;for(let e=1;e<=100;e++);for(let e=1;e<=32;e++);for(let a=1;a<=100;a++)e+=`.kbdbg-inner.w${25*a} { width:${54*a/4+6}px; }`;for(let a=1;a<=28;a++)e+=`.kbdbg-inner.h${25*a} { height:${54*a/4+6}px; }`;for(let e=5;e<=32;e++);for(let e=5;e<=10;e++);addGlobalStyle(e)}function addGlobalStyle(e){var a,t;(a=document.getElementsByTagName("head")[0])&&((t=document.createElement("style")).type="text/css",t.innerHTML=e,a.appendChild(t))}function getElementAbsPos(e){var a=e.getBoundingClientRect();return{left:a.left+window.scrollX,top:a.top+window.scrollY}}function ani_fly_button(e,a){var t=$("#keyboard-outline").find(".key-editing");if(t.length>0){var o=t.find(".key");$("#fly-button").removeClass("fly");var s=display_label(e,0),n=getElementAbsPos(o[0]);$("#fly-button").attr("style",`--fbs_left: ${a.left}px; --fbs_top: ${a.top}px; width:36px;height:36px;box-shadow:0px 0px 10px #ccc;--fbe_left: ${n.left}px; --fbe_top: ${n.top}px;--fbcolor: ${t.css("color")};--fbbgcolor: ${t.css("background")};`),$("#fly-button").html(s.name).addClass("fly"),play_sound("sound/key_set.wav")}}function play_sound(e){var a=new Audio(e);a.pause(),a.currentTime=0,a.play()}function hex8(e){return("0"+parseInt(e).toString(16)).slice(-2)}function str_to_data0(e,a){for(var t=[],o=0;o<e.length;o++)t.push(e[o].charCodeAt(0)),0==a&&t.push(0);return t}function find_array_in_array(e,a,t){console.log(`%c_Find ${e} in size ${a.length}`,"color:green"),t<2&&(e=str_to_data0(e,t));for(var o=0,s=0;s<a.length;s++){o=s;for(var n=0;n<e.length&&a[o]==e[n];n++)o++;if(o==s+e.length)return console.log(`%c_found, addr: ${s}`,"color:green"),{start:s,end:o}}return 0}function update_share_url_panel(){var e;$("#share-dialog").hasClass("url-long")?(e=parseInt($("#share-dialog")[0].style.getPropertyValue("--aug-r")))<80&&(e++,$("#share-dialog")[0].style.setProperty("--aug-r",e+"px"),setTimeout("update_share_url_panel()",10)):((e=parseInt($("#share-dialog")[0].style.getPropertyValue("--aug-r")))>60&&(e=60),e>12&&(e--,$("#share-dialog")[0].style.setProperty("--aug-r",e+"px"),setTimeout("update_share_url_panel()",10)))}function lang_pre_action(){if(jslang=new Lang,Lang.prototype.attrList.push("data-tooltip","data-dropkind"),jslang.dynamic("en","lang/en.json"),jslang.dynamic("zh_cn","lang/zh_cn.json"),NOW_LANG=navigator.userLanguage||navigator.language||navigator.bowserLanguage,"zh-cn"===NOW_LANG.toLowerCase())NOW_LANG="zh_cn";else NOW_LANG="en";if(console4jslang=!0,null==window.location.href.match(/my.|18:2|0:8|console/g)?(console.log=()=>{},console4jslang=!1,$("#shorten-url").hide()):($("#c-output").show(),$("#shorten-url").text("Copy Keymap"),document.title="YDKB Dev"),-1!=window.location.href.indexOf("/dev")){is_dev=1;var e=$(".brand-logo").html();$(".brand-logo").html(e.replace("Builder","Builder (DEV)")),$("nav").removeClass("uicolor").addClass("red")}console.log(layouts_save)}function lang_init(){(new Lang).init({defaultLang:"zh_sc"})}function onLangChange(e){NOW_LANG=e,window.jslang.change(e);var a=".lang-en",t=".lang-zh_sc";"zh_cn"==e&&([a,t]=[t,a]),$(a).show(),$(t).hide(),"zh_cn"!=e&&"en"!=e||(LANG_JSON_CONTENT.token&&LANG_JSON_CONTENT.token["lang-name"]==e?manual_update_lang():fetch(`lang/${e}.json`).then((function(e){if(e.ok)return e.json()})).then((function(e){LANG_JSON_CONTENT=e,manual_update_lang()}))),setTimeout((function(){tooltip_init(),update_logo_desc(),$("#key-set-tabs .indicator").html($("#key-set-tabs").find(".active")[0].innerHTML),$("#key-set-tabs").tabs("updateTabIndicator")}),500)}function manual_update_lang(){$("#keyboard-outline").find(".kbd-led").each((function(){var e=$(this).attr("class").match(/.*led(\d)/);if(e&&e[1]>7){var a=LANG_JSON_CONTENT.token[$(this).attr("data-tooltip")];a&&$(this).attr("data-tooltip",a)}})),$("#fn-set").find("a").each((function(){if(this.id.match(/_dropdown-btn/)){var e=LANG_JSON_CONTENT.token[$(this).attr("data-tooltip")];e&&$(this).attr("data-tooltip",e)}})),$("body").find("[lang-id]").each((function(){var e=$(this).attr("lang-id");if(e){var a=LANG_JSON_CONTENT.token[e+" #html"];a&&$(this).html(a);var t=LANG_JSON_CONTENT.token[e+" #title"];t&&$(this).attr("title",t);var o=LANG_JSON_CONTENT.token[e+" #tooltip"];o&&$(this).attr("data-tooltip",o)}}))}function LangChange(e){NOW_LANG!=e&&($("#layer_set").tabs("select","layer_0"),onLangChange(e))}function lang_from_json(e){let a=LANG_JSON_CONTENT.token[e];return a||(console.log(`${e} not found in json`),e)}String.prototype.replaceAll=function(e,a){return this.replace(new RegExp(e,"gm"),a)},function(e){jQuery.fn.extend({prependClass:function(a){return this.each((function(){var t=e(this).prop("class");e(this).removeClass(t).addClass(a+" "+t)}))}})}(jQuery),LANG_JSON_CONTENT={},NOW_LANG="";