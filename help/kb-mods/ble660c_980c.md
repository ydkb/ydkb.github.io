# FC660C/FC980C BLE Mod (BLE660C/BLE980C)

<table_w30x70>

|PCB | YANG |
|:--- |:--- |
|Firmware | YANG |
|Keymap Editor | YANG |
|Solder | YANG / 兰某人|
|Test | YANG / 兰某人|
|Seller | YANG |

</table_w30x70>

在售：https://item.taobao.com/item.htm?id=590236576831 

两者的固件和硬件已经集成到一起了，所以将它们放在一起来说。

BLE部分参照本help文档前面的说明，这里主要再说一些BLE660C/BLE980C特殊的地方。 

注：本部分内容针对的是ydkb.io的最新版本固件。

固件的更新记录可见： [BLE660C / BLE980C 固件更新记录](changelog/ble660c_980c)

## 蓝牙配对

蓝牙配对主要参看，[BLE双模使用](ble-series)

简单说不需要单独启用配对模式，只要蓝牙处于未连接并且可发现状态，就可以配对。mac和ios的搜不到在上面文档里也有写处理方法，另外出现连接异常时，也有处理方法。

## 开关说明

在原来的dip开关位置，有一个按动开关。这也是该主控的惟一一个开关。
<html><div class="attention"> 
<subtitle>注意：</subtitle>
<ul><li>此开关在按下的时候是关，弹起来的时候才是开。</li>
<li>此开关的作用是关闭电池的对外供电，并不是关闭蓝牙。</li>
<li>因此，关闭时，如果插上USB线，因为还有USB供电，所以蓝牙依然可以工作。</li></ul>
</div></html>

![](/assets/ble660c-switch.jpg)

如果想要关闭蓝牙功能，请参看 [蓝牙开关和连接状态](ble-series/connection-status)。

<html><div class="hint">
<subtitle>提醒</subtitle>
<ul><li>此软件开关是给想要完全关闭蓝牙，仅使用或仅暂时使用有线模式而设计。建议同时把主控上的硬件电池开关也关掉。</li>
<li>它不是用来日常关闭蓝牙从而节能的，在 BLE660C / BLE980C 上，使用这个功能关闭蓝牙，待机时比正常的二级节能时耗电很多。</li>
</div></html>


## 充电注意：

USB数据线接口就是充电接口。

<html><div class="attention">
<subtitle>注意：建议使用电脑USB口或者正规的5v充电器来充电</subtitle>
<br>使用大功率充电器并不会提高充电速度的，默认充电电流大部分为400多ma。即，在USB供电充足的情况下，2500mAh电池充满电需要6小时左右。。如果使用支持快充或非合适充电器，充电电压过高或瞬时过高，可能损坏充电IC等。
</div></html>

充电指示灯在左边电源开关的下方。在亮起的时候透过电源开关能看到，指示灯为红色。

<table_w30x70>

| 充电指示灯状态 | 指示说明 |
|:--- |:--- |
| 低亮度或闪烁 | 表示电池异常（没接电池或电池有问题） |
| 较高亮度 | 表示充电中 |
| 熄灭或极低亮度 | 表示电池充满了，充满了会自动停止充电的 |

</table_w30x70>

一般不用刻意去注意这个指示灯，充一次电就能知道大概需要充多久了。

电量百分比显示，显示的是大概的水平，不是精确的，仅供参考（特别是充电时显示的误差会更大），每10%为一个等级。另外充电的过程中，电量显示为x1%，即比非充电时多显示1%。如下图是正在充电时显示的电量。  

<div style="width: 450px">

![](/assets/ble660c-charge.png?450)
</div>  

在电量达到90%以后，会进入涓流充电。充满之后，主控上本身的充电指示灯也会熄灭或者亮度降到极低，并且不再对电池进行充电。长期插着线使用是没有问题的。

Mac屏蔽了第三方蓝牙设备的电量显示，可以使用文字输出电量的功能，具体见： [充电与电量显示](ble-series/blebattery)。


## 固件设置和更新

打开网址https://ydkb.io ，选择好键盘 **BLE660C** 或 **BLE980C**，然后页面上就有刷的方式 [Mass Storage Device Bootloader（U盘模式）](bootloader/msd-bootloader)。按键编辑器的说明参看本文档的其他部分。

除了按住左上角键（一般是ESC）插线可以进入刷机模式，还可以使用**灯光和增强功能**里的<kbd>Reset</kbd>，为了防止误按，需要先按住<kbd>LCtrl</kbd>, 再按这个<kbd>Reset</kbd>，可以直接跳到刷机模式，不用拔线再重插。


## 指示灯说明以及节能
普通的功能可以通过 [LEDMAP](features/ledmap)] 定义两个指示灯的功能。指示灯仅在键盘未节能时亮起，建议不要设置需要经常常亮的指示，每颗指示灯一直亮起增加的耗电，会减少键盘的续航。


除了LEDMAP定义的功能外，还有其他指示一些操作和状态。

<table_w30x70>

| 状态或操作 | BLE660C LED指示方式 |
|:--- |:--- |
| 刷机模式（空闲） | 两个指示灯一起闪或者交替闪，一直不灭。静音版660C正面只有一个指示灯 |
| 刷机模式（数据写入） | 在上面基础上，Caps指示灯快速闪烁 |
| 启动时蓝牙 未连接 状态指示 | 两个指示灯闪烁，如果一直未连接，约15秒左右会停止闪烁 |
| 启动时蓝牙 已连接 状态指示 | 两个指示灯同时较慢闪。每次亮的时间明显长于灭的时间。 |
| 按键<key>LShift+RShift+s</key> | 按上面的方式指示蓝牙连接状态 |
| 手动进入Lock Mode | 两个灯同时亮起，然后再按Scroll指示灯 Caps指示灯的顺序依次熄灭 |
| 从二级节能或Lock Mode唤醒 | 两个灯同时亮起，然后开始指示蓝牙连接状态 |
| 低电量提示 | 用键盘时，两个灯同时闪；节能时不闪。依然还可以使用两三天。 |
| 极低电量提示 | 用键盘时，两个灯同时飞快闪；节能时不闪。此时建议尽快充电。 |

</table_w30x70>

BLE980C，为了方便说明，正面三个指示灯从左到右，标为LED1 LED2 LED3。

<table_w30x70>

| 状态或操作 | BLE980C LED指示方式 |
|:--- |:--- |
| 刷机模式（空闲） | 三个指示灯一起闪或者交替闪，一直不灭 |
| 刷机模式（数据写入） | 在上面基础上，LED3快速闪烁 |
| 启动时蓝牙 未连接 状态指示 | LED3闪烁，如果一直未连接，约15秒左右会停止闪烁 |
| 启动时蓝牙 已连接 状态指示 | LED2和LED3同时较慢闪。每次亮的时间明显长于灭的时间。 |
| 按键<key>LShift+RShift+s</key> | 按上面的方式指示蓝牙连接状态 |
| 手动进入Lock Mode | 三个灯同时亮起，然后再按LED3 LED2 LED1的顺序依次熄灭 |
| 从二级节能或Lock Mode唤醒 | 三个灯同时亮起，然后开始指示蓝牙连接状态 |
| 低电量提示 | 用键盘时，三个灯同时闪；节能时不闪。依然还可以使用两三天。 |
| 极低电量提示 | 用键盘时，三个灯同时飞快闪；节能时不闪。此时建议尽快充电。 |

</table_w30x70>

<html><div class="hint">
<subtitle>提醒</subtitle>
<ul><li>低电量提示的优先级最高，只要低电量时它会一直指示，同时覆盖其他的。</li> 
<li>静音版的FC660C没有Scroll指示灯，所以就只看Caps指示灯来判断。</li><ul>
</div></html>

然后关于节能模式的说明：
  1. 键盘闲置3秒没按任何按键后，进入一级节能，此时每30ms再重新检查一次矩阵有无按键，有按键就退出一级节能，这个唤醒过程很快。
  2. 键盘如果90秒蓝牙未连接，或者闲置时间超过2.5小时，这时蓝牙会关闭并断开，进入二级节能。长按任意键3到5秒可以唤醒。
  3. 使用Lock Mode，会直接进入二级节能，与2的区别是，这个模式下，只能同时长按F和J唤醒，不能长按任意键唤醒。

二级节能的功耗是很低的，如果不是特别长期的不用，比如只是第二天不用，可以直接让键盘自己进入二级节能或者直接手动进入Lock Mode（后者更适合放包里，防止意外唤醒）。

补充一个，下图为低电量提醒时的效果。  

![](/assets/ble660c-low-battery.gif)


## 异常处理
工作时如果出现什么异常，最快速的方法是重新插一下usb线或是重新开关一下键盘电源开关，且再次提醒，开关弹起是开，按下是关。

以及请先参看 [BLE系列排错指南](ble-series/troubleshooting)。

遇到bug可以通过群里联系等方式报给我。

## 硬件版本区别
记录一下售出过的硬件版本的区别，方便以后其他人查看

**v2.1:**
> 在v2.0的基础上，增加方便短接重置蓝牙的两个孔。以及，使用MCU的内置振荡器替代外置晶振。

**v2.0:**
> 同时支持FC660C和FC980C

**v1.0:**
> 第一个正式版本，硬件仅支持FC660C。