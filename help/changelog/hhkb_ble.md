# HHKB BLE 固件更新记录
「+」新增， 「-」删除， 「^」升级, 「#」修复, 『 』重要

> [!ydda] 注意
> - 不再区分HHKB BLE和HHKB BLE S，合并到一起，仅提供HHKB BLE一个选项，这已经是提高响应速度后的固件了。

##### 2024-05-24 (DO5O)
- 「+」增加支持 <key>Cmd </key> + <key>~` Esc</key>  触发为  <key>Cmd </key> + <key>`</key> 

##### 2024-05-15 (DO5F)
- 「#」改善在较新的macOS系统下，电脑睡眠后，10多秒后会再次被键盘唤醒的问题。
- 「+」LEDMAP里增加一个设置，可以启用或禁用外接灯带(默认未设置时是禁用)。
- 「-」从Lock Mode唤醒时不再三灯常亮一下，而是直接显示连接指示灯。

##### 2023-12-24 (DNCO)
- 「+」[修饰键组合键](edit-keymap/mods-key.md) 或 [修饰键 | 按键](edit-keymap/mods-tap-key.md)，其中的按键，可以设置为 音量键 或 鼠标键。即可将单个按键设置为例如: <kbd>Ctrl + 滚轮上</kbd>，<kbd>Shift + 音量加</kbd>。
- 「+」基于上一条，增加两个mac使用的按键，功能为音量增加或减少4分之1格。

##### 2023-09-28 (DN9S)
- 「+」增加支持 [修饰键 & 瞬时开启层](edit-keymap/layer-mods.md)，支持设置左或右修饰键，以及支持单按时触发一次瞬时开启层所在位置的按键。

##### 2023-09-27 (DN9R)
- 「+」增加支持 [按键(k) | 修饰键](app://obsidian.md/edit-keymap/mods-tap-key.md)，其作用就是按键优先，工作在非Interrupt模式下，具体见稍后文档补充说明。
 
##### 2023-05-03 (DN53)
- 「^」从二级节能(包括Lock Mode)恢复时，依然保持当前的一级节能开关状态。

##### 2023-01-23 (DN1N)
- 「^」主控与蓝牙模块之间的通讯，增加两重保险，提升可靠性。
- 「^」1: 每次主控传输命令到蓝牙前，检查之前的命令是否已经完成。
- 「^」2: 按键抬起时，会在发送后确认命令是否成功。如未成功会在下次循环再发，直至确认发送成功。

这次的蓝牙更新后，键盘这端应该不会出现按键后未弹起的情况了。

如果还遇到卡键按键未弹起现象，有可能是蓝牙命令由键盘发送后到电脑接收，这个过程中出了问题。

##### 2023-01-17 (DN1H)
-  「^」改进了判断v2.5B的硬件版本是用于HHKB JP还是HHKB Pro1的方法。

##### 2023-01-15 (DN1G) 
- 「+」增加 优先层 功能。使用瞬时开启的层，临时也被设为优先层，如果此层上有设置按键，则优先响应它，其次才根据所有的层状态从高往低查找。
-  「^」层的逻辑有些变化，把瞬间切换层和其他切换层分开来。现在逻辑上操作更直觉。

具体说明文档稍后补充。它不会破坏以往逻辑，但配合新的逻辑，符合更多人对于层切换的期望。例如：
1. 在使用瞬时开启L1时更期待触发的是层1按键。新逻辑下在高层处于开启状态时，也可触发低层的按键。
2. 可以使用例如 L1+T1 来开启或关闭层1了，而不会因为最后L1松开又将层1关闭。

注：用到瞬时开启层的，包括：瞬时开启层、修饰键 & 瞬时开启层、按键 | 瞬时开启层、 层开关 | 瞬时开启层。

##### 2023-01-05 (DN15) 
- 「#」修复问题：极少部分在 Lock Mode 后如果放置键盘太久，无法使用 F+J 唤醒。（之前修复过，但因为加了消抖后，这极少的版本的此问题还需要额外处理）

##### 2023-01-01 (DN11) 
- 「^」从这个固件开始，USB模式下默认开启NKRO全键无冲，蓝牙模式下依然是6KRO。现在应该很少人使用极老的系统不支持NKRO的了。

##### 2022-12-31 (DMCV) 
- 「^」加入按下按键时，防抖一次。这样可以避免有些使用加热取暖垫时对键盘干扰造成了按键自动点击问题。

##### 2022-12-13 (DMCN) 
- 「#」修复问题：极少部分在 Lock Mode 后如果放置键盘太久，无法使用 F+J 唤醒。(报告此问题的有2例，有此问题请更新此固件。)

##### 2022-06-08 (DM68) 
- 「#」修复问题：最新macOS下(截止当前是12.4)，键盘进入节能时电量未正确刷新，导致系统无显示。
- 「+」配合本固件，v2.5前版本增加一个电阻在蓝牙模块旁边(稍微飞线连接)，可实现不用短接硬件重置蓝牙。

##### 2022-05-29 (DM5T) 
- 「+」二合一按键功能，增加 LT (P)。具体说明见: [按键 | 瞬时开启层](/edit-keymap/layer-tap-key.md)

##### 2022-05-12 (DM5C) 
- 『 』 从这个固件开始，合并HHKB BLE和HHKB BLE S。
- 「#」修复DM58和HHKB Pro JP的兼容问题。
- 「^」对比DM4M固件，<u>DM5C在一级节能下大约省电20%</u>。这也是白天日常使用时，键盘比较多的时候所处的状态。

##### 2022-05-08 (DM58) 本次更新仅针对 HHKB BLE S
- 「#」修复节能状态下按下Macro相关的功能会无反应（比如启动快捷方式）。
- 「^」改进，休眠唤醒后，默认连接可能非USB的问题。原因是有的主板或系统启动后识别USB需要更长时间。
- 「+」USB连接时，电脑休眠后，支持用键盘唤醒电脑。

##### 2022-05-06 (DM56) 本次更新仅针对 HHKB BLE S
- 「^」重新基于非S的矩阵扫描方式，减少了一些延迟后，构建了新的s固件，增强了稳定性。
- 「^」简单量化了一下S与非S的差距。S因为检测按键速度快，在一级节能下比非S的省电20%左右，二级节能下区别不明显。
- 『 』若此固件兼容一切正常，下次更新可能将S与非S合并了。

##### 2022-04-22 (DM4M) 
- 『^』提升两个蓝牙设备间切换时的准确率。

##### 2022-04-13 (DM4D) 
- 『#』修复：当插着USB线时，切换到使用蓝牙，这时再拔掉USB线。此时在蓝牙连接下，键盘有可能不会再进入节能模式。

##### 2022-03-13 (DM3D) 本次更新仅针对 HHKB BLE S
- 『+』按键防抖升级为疾速防抖，最快可以在按下按键后0.1ms内触发。
- 「+」使用 LShift+RShift+LCtrl+B组合可以直接进入刷机模式。

##### 2022-02-20 (DM2K)
- 『+』 修饰键组合键的一点点增强，方便实现类似<kbd>Ctrl+H J K L</kbd>或<kbd>Ctrl+N B P F</kbd>为方向键的操作，具体见说明 [修饰键组合键](edit-keymap/mods-key.md)
- 「^」 节能模式下的watchdog逻辑稍微改进了一下。

##### 2021-09-22 (DL9M)
- 「^」 设置为 Tap二合一按键，如果其中是CapsLock，增加一个100ms的延时，让它在MacOS下可以正常切换大小写。
- 「^」 提高 [Esc 与 \`\~](/features/tricky-esc) 功能在单独按触发 Esc 时的响应速度。

##### 2021-04-25 (DL4P)
- 『^』 改进带S的固件兼容性，之前遇到此固件无法从Lock Mode唤醒的，现在应该有所改善。
- 「+」 <key>LShift+RShift+V</key>这个快捷键，如果同时还按了<key>LCtrl</key>，增加输出电池电压值。

##### 2021-01-20 (DL1K)
- 『^』 适配v2.5版主控，主要在v2.5上，软件重置蓝牙实际是执行硬件重置。
- 『^』 非S的固件，从DK5O开始的更新，除了按键扫描的部分，也已经包含。

##### 2020-11-28 (DKBS)
- 『#』 修复问题：上一版HHKB BLE S的固件，USB与蓝牙之间切换不可用。
- 『#』 修复问题：上一版HHKB BLE S的固件，插上USB然后再拔下，键盘无法进入节能模式。

##### 2020-11-14 (DKBE)
- 『^』 清除键盘端的蓝牙配对，由 <kbd>LShift+RShift+R</kbd> 改为 <kbd>LShift+RShift+LCtrl+R</kbd>，需要多按一个 <kbd>LCtrl</kbd>，防止误操作。
- 「+」 Shift+Esc输出\~的功能，更加的完善，具体看 [Esc 与 \`\~](/features/tricky-esc)
- 「^」 拔掉USB线时，不再重启键盘。

##### 2020-08-15 (DK8F)
- 「#」 修复：HHKB Pro JP版无法从Lock Mode唤醒的问题。
- 『 』 提醒：如果还有从Lock Mode唤醒有问题，可能部分批次兼容的原因，请先恢复使用DK5O的固件（键盘选择HHKB BLE，而不是HHKB BLE S）。

##### 2020-08-11 (DK8B) 
- 「^」 按键扫描的部分继续优化，提高了部分的效率，来提高速度。在HHKB Pro2上能达到接近1000Hz。
- 「#」 修复：修饰键 & 瞬时切换层 没有在按下时立即触发的问题。

##### 2020-07-27 (DK7R)
- 『^』 对按键扫描的部分进行了重写，不再采用遵从HHKB原主控的方式。将按键的扫描速度提升了10倍以上，按键的响应速度大大提升，真的用来玩游戏都不是短板了。
- 『^』 降低了一点一级节能时的耗电，这也是大部分时候键盘处于的节能状态。根据使用情况，综合续航会有所提升。
- 「+」 新增：当一个按键设置为**Shift+KEY**时，如果再和**Shift**用，就直接输出**KEY**。举例来说就是一个按键被设置成了直接输出 <kbd>{</kbd>， 那么 <kbd>Shift+{</kbd> 就会输出 <kbd>[ </kbd>。
- 「+」 左右Shift+N切换全键无冲时（仅有线下支持全键无冲），在可打字的地方会输出0或6，0代表全键无冲，6代表6键无冲。
- 「+」 左右Shift+P切换节能时，在可打字的地方会输出1或0，1代表节能开启，0代表节能关闭。
- 「-」 取消默认命令按键里的 <kbd>LShift+RShift+数字</kbd> 切换默认层，这个引起误操作时更多。一般默认层切换请自己设置按键。

##### 2020-05-24 (DK5O)
- 「+」 <kbd>LShift+RShift+V</kbd> 这组命令键，在按的时候，后面会多输出一个-0或-1，代表键盘蓝牙连接状态。

##### 2020-04-18 (DK4I)
- 『#』 因为有部分人误关掉蓝牙功能，本次更新调整开关蓝牙功能的切换方式，具体见 [蓝牙开关和连接状态](/ble-series/connection-status)

##### 2020-03-16 (DK3G)
- 「#」 修复：Mac下要使用键盘的有线模式，按键无法进入恢复模式等。具体进入方法见 [HHKB BLE Mod](/kb-mods/hhkb-ble) 的补充说明。

##### 2020-03-09 (DK39)
- 『^』 再优化键盘模拟鼠标功能的滚轮部分，之前滚轮速度起飞了。同时USB下移动流畅度再提升一点，速度减一点。
- 「#」 修复一个之前一个小问题：低电量指示会在键盘进入一级节能时，也低亮度闪。正常应该只在使用时闪。

##### 2020-03-07 (DK37)
- 『^』 大幅度提升键盘模拟鼠标功能的流畅和精准性。
- 「+」 宏功能的代码部分重写完成，不过正式推出待配置界面做好。

##### 2020-02-21 (DK2L)
- 「#」 修复：上一个固件 LEDMAP 的“工作模式”指示未正常工作。

##### 2020-02-14 (DK2E)
- 「^」 改进Win_Lock功能。之前只是禁用单独的设置的win键（即LWin或RWin），现在可以让所有与win相关的（包括组合键，二合一键等），都不触发win键本身。这样防止误按的效果更佳。

##### 2020-01-28 (DK1S)
- 「^」 上一个固件第2条会增加一点一级节能时的耗电(0.x ma)，优化一下其他的部分，把这点耗电再抢回来。

##### 2020-01-23 (DK1N)
- 「#」 修复：在使用软件重置或者清除修饰时，最新版win10里会触发启动商店版Office(它的默认快捷键是LCtrl+LShift+LAlt+LWin)问题。
- 「^」 改进对一些PCB有老化的HHKB的兼容
- 「^」 略微减少了扫描一次矩阵按键所用时间
- 「+」 增加一个极低电量提示，固件读取到电压低于3.42v时激活。此模式下低电量提醒灯快闪，一秒3下。建议这个模式提醒时就尽快充电了， 此时键盘用到完全没电大约1天多一点。

##### 2019-10-03 (DJA3)
- 「+」 增加蓝牙多设备切换。具体见  [多设备切换](/ble-series/device-switching)

##### 2019-09-17 (DJ9H)
- 「#」 修复问题：重置蓝牙后初始化时，偶尔重命名未成功。
- 「^」 一处节能优化，续航提升。
- 「^」 蓝牙连接指示灯：未连接时led3闪烁加快一点；已连接时led2和led3一起较慢闪，如果有led2的会显示更直观了。
- 「+」 电池服务如果不正常时，电量指示输出44或45。这个是用来辅助判断问题的。

##### 2019-09-12 (DJ9C)
- 「#」 修复问题：使用完全关闭蓝牙功能后，Mac下插USB无法使用（Win下正常）。

##### 2019-09-09 (DJ99)
- 『#』 修复问题： 左右Shift+R/I/O这三个功能，使用时可能导致蓝牙重新配置或出错。
- 「+」 插USB线识别的设备名，后面增加固件日期。比如今天的固件更新后，USB下识别的设备名就为 HHKB BLE (USB_DJ99),J99分别代表年月日。

##### 2019-08-25
- 「^」 使用 [蓝牙开关和连接状态](/ble-series/connection-status) 完全关闭蓝牙后，键盘的USB可以唤醒电脑了。
- 「^」 有线模式下，默认由NKRO改为6KRO。默认6KRO对各种系统和硬件的兼容更好一些。

##### 2019-08-24
- 「^」 取消启动的延时，然后把那个延时放在了重启键盘前。

##### 2019-08-19
- 『#』 修复问题：部分HHKB在节能状态时，不识别矩阵0行的按键(如JP的Ese Tab Ctrl，US的2 Q W)

##### 2019-08-17
- 『^』 之前版本的固件直接读取KEYMAP后，蓝牙功能相关的增强按键需要重新选择设置
- 「+」 增加蓝牙开关功能，可以完全关闭蓝牙。具体参看： [蓝牙开关和连接状态](/ble-series/connection-status)
- 「#」 修复问题：使用额外充电器(5V)充电时，这时蓝牙会重复的进入一级节能
- 「^」 蓝牙初始化时，HHKB US和JP使用不同的名称，前者HHKB BLE，后者HHKB JP BLE
- 「^」 Win10下插着线重启键盘，设置设备里可能没有刷新及时导致显示为“驱动程序错误”，但其实键盘使用正常。有部分用户误解为这是键盘问题，所以本次键盘启动时增加了一个1200ms的启动延迟。
- 「^」 这条不怎么重要，记录一下方便回查。减少了mouse, mouse debug, bootloader_jump的代码空间占用。

##### 2019-07-29
- 『#』 修复插着USB充电时，无线模式下会漏键的问题
- 「^」 提高US版的按键扫描速度
- 「^」 从二级节能(需长按唤醒)唤醒时也提示蓝牙连接状态。并且，减少每次提示的闪烁时间
- 「^」 Lock Mode因为仅在无线工作时生效，所以去除插线时按到Lock Mode键时的LED灯提醒


##### 2019-07-16
- 从这一版之后开始做更新记录